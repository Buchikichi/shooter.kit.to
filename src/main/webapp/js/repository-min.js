var $jscomp={scope:{},inherits:function(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b;a.prototype.constructor=a;for(var e in c)if(Object.defineProperties){var f=Object.getOwnPropertyDescriptor(c,e);f&&Object.defineProperty(a,e,f)}else a[e]=c[e]},getGlobal:function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a}};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.findInternal=function(a,c,b){a instanceof String&&(a=String(a));for(var e=a.length,f=0;f<e;f++){var d=a[f];if(c.call(b,d,f,a))return{i:f,v:d}}return{i:-1,v:void 0}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};
$jscomp.polyfill=function(a,c,b,e){if(c){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var f=a[e];f in b||(b[f]={});b=b[f]}a=a[a.length-1];e=b[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");var EntityBase=function(){};
EntityBase.prototype.list=function(a){return $.ajax({type:"post",url:"/"+this.base+"/list",dataType:"json",data:{keyword:a}})};EntityBase.prototype.select=function(a){var c=new FormData;c.append("id",a);return fetch("/"+this.base+"/select",{method:"post",body:c}).then(function(a){return a.json()})};EntityBase.prototype.save=function(a){a=new FormData(a);return $.ajax({type:"post",url:"/"+this.base+"/save",dataType:"json",data:a,processData:!1,contentType:!1})};
var ActorEntity=function(){EntityBase.call(this);this.base="actor"};$jscomp.inherits(ActorEntity,EntityBase);var AudioEntity=function(){EntityBase.call(this);this.base="audio"};$jscomp.inherits(AudioEntity,EntityBase);var Customer=function(){};Customer.prototype.check=function(){return $.ajax({type:"post",url:"/customer/check",dataType:"json",data:{}})};Customer.prototype.signIn=function(a,c){return $.ajax({type:"post",url:"/customer/signIn",dataType:"json",data:{userid:a,passwd:c}})};
var ImageEntity=function(){EntityBase.call(this);this.base="image"};$jscomp.inherits(ImageEntity,EntityBase);var Product=function(){EntityBase.call(this);this.base="product"};$jscomp.inherits(Product,EntityBase);Product.prototype.list=function(){return $.ajax({type:"post",url:"product/list",dataType:"json",data:{}})};var StageEntity=function(){EntityBase.call(this);this.base="stage"};$jscomp.inherits(StageEntity,EntityBase);var TitleBg=function(){this.x=0;this.width=1200;this.move()};
TitleBg.prototype.move=function(a){var c=this;document.querySelector("div[data-role=header]").style.backgroundPosition=-this.x+"px 0";this.x++;this.width<this.x&&(this.x=0);requestAnimationFrame(function(a){return c.move(a)})};document.addEventListener("DOMContentLoaded",function(){new AppMain;new TitleBg});
var AppMain=function(){this.customer=new Customer;this.stageManager=new StageManager;this.actorManager=new ActorManager;this.imageManager=new ImageManager;this.audioManager=new AudioManager;this.imageChooser=new ImageChooser;this.setupPanel();this.checkCustomer();AppMain.Instance=this};
AppMain.prototype.setupPanel=function(){var a=this;console.log("AppMain::setupPanel");var c=document.querySelector('[data-role="header"] a'),b=document.querySelector('[data-icon="star"]'),e=document.querySelector('[data-icon="bullets"]'),f=document.querySelector('[data-icon="heart"]'),d=document.querySelector('[data-icon="audio"]');b.addEventListener("click",function(){c.setAttribute("href","#stagePanel");a.manager=a.stageManager;a.manager.list()});e.addEventListener("click",function(){c.setAttribute("href",
"#actorPanel");a.manager=a.actorManager;a.manager.list()});f.addEventListener("click",function(){c.setAttribute("href","#imagePanel");a.manager=a.imageManager;a.manager.list()});d.addEventListener("click",function(){c.setAttribute("href","#audioPanel");a.manager=a.audioManager;a.manager.list()});c.addEventListener("click",function(){a.manager.resetPanel()});b.click()};AppMain.prototype.checkCustomer=function(){this.customer.check().then(function(a){})};
var RepositoryManager=function(){this.listView=document.getElementById("listView")};RepositoryManager.prototype.setupPanel=function(){var a=this;this.form.addEventListener("submit",function(c){c.preventDefault();a.entity.save(a.form).then(function(b){b.ok?$(a.panel).panel("close"):$(a.panel).find(".message").text("Saving failed.")});return!1})};
RepositoryManager.prototype.resetPanel=function(a){a=void 0===a?{}:a;$("#"+this.panelId+" :input").each(function(c,b){c=b.getAttribute("name");b=$(b);if(c){var e="";c in a&&(e=""+a[c]);b.is(":radio")?b.val([e]).checkboxradio("refresh"):b.val(e)}})};RepositoryManager.prototype.list=function(){var a=this;$(this.listView).empty();this.entity.list("").then(function(c){c.forEach(function(b){b=a.createRow(b);a.listView.append(b)});$(a.listView).listview("refresh")})};
$jscomp.global.Object.defineProperties(RepositoryManager.prototype,{panelId:{configurable:!0,enumerable:!0,get:function(){return this.panel.getAttribute("id")}}});var StageManager=function(){RepositoryManager.call(this);this.panel=document.getElementById("stagePanel");this.form=document.getElementById("stageForm");this.entity=new StageEntity;this.setupPanel()};$jscomp.inherits(StageManager,RepositoryManager);
StageManager.prototype.createRow=function(a){var c=this,b=document.createElement("img"),e=document.createElement("span"),f=document.createElement("p"),d=document.createElement("a"),g=document.createElement("li");b.setAttribute("src","img/icon.listview.png");e.innerText=a.name;f.innerText=a.description;d.append(b);d.append(e);d.append(f);d.setAttribute("href","#"+this.panelId);g.append(d);d.addEventListener("click",function(){c.resetPanel(a)});return g};
var ActorManager=function(){RepositoryManager.call(this);this.panel=document.getElementById("actorPanel");this.form=document.getElementById("actorForm");this.entity=new ActorEntity;this.setupPanel()};$jscomp.inherits(ActorManager,RepositoryManager);
ActorManager.prototype.createRow=function(a){var c=this,b=document.createElement("img"),e=document.createElement("span"),f=document.createElement("p"),d=document.createElement("a"),g=document.createElement("li");b.setAttribute("src","/image/src?id="+a.imageid);e.innerText=a.name;f.innerText=a.description;d.append(b);d.append(e);d.append(f);d.setAttribute("href","#"+this.panelId);g.append(d);$(d).click(function(){c.resetPanel(a)});return g};
var ImageManager=function(){RepositoryManager.call(this);this.panel=document.getElementById("imagePanel");this.form=document.getElementById("imageForm");this.entity=new ImageEntity;this.setupPanel()};$jscomp.inherits(ImageManager,RepositoryManager);
ImageManager.prototype.createRow=function(a){var c=this,b=document.createElement("img"),e=document.createElement("span"),f=document.createElement("p"),d=document.createElement("a"),g=document.createElement("li");b.setAttribute("src","/image/src?id="+a.id);e.innerText=a.name;f.innerText=a.description;d.append(b);d.append(e);d.append(f);d.setAttribute("href","#"+this.panelId);g.append(d);$(d).click(function(){c.resetPanel(a)});return g};
var AudioManager=function(){RepositoryManager.call(this);this.panel=document.getElementById("audioPanel");this.form=document.getElementById("audioForm");this.entity=new AudioEntity;this.setupPanel()};$jscomp.inherits(AudioManager,RepositoryManager);
AudioManager.prototype.createRow=function(a){var c=this,b=document.createElement("img"),e=document.createElement("span"),f=document.createElement("p"),d=document.createElement("a"),g=document.createElement("li");b.setAttribute("src","data:image/png;base64,"+a.image);e.innerText=a.name;f.innerText=a.description;d.append(b);d.append(e);d.append(f);d.setAttribute("href","#"+this.panelId);g.append(d);$(d).click(function(){c.resetPanel(a)});return g};
var ImageChooser=function(){var a=this;this.listView=document.querySelector("#imageChooser > ul");this.entity=new ImageEntity;$('[href="#imageChooser"]').click(function(){a.list()})};ImageChooser.prototype.list=function(){var a=this;$(this.listView).empty();this.entity.list("").then(function(c){c.forEach(function(b){b=a.createRow(b);a.listView.append(b)});$(a.listView).listview("refresh")})};
ImageChooser.prototype.createRow=function(a){var c=this,b=document.createElement("img"),e=document.createElement("span"),f=document.createElement("p"),d=document.createElement("a"),g=document.createElement("li");b.setAttribute("src","/image/src?id="+a.id);e.innerText=a.name;f.innerText=a.description;d.append(b);d.append(e);d.append(f);g.append(d);$(d).click(function(){c.embedId(a.id)});return g};ImageChooser.prototype.embedId=function(a){$('#actorPanel [name="imageid"]').val(a);$("#imageChooser").popup("close")};
