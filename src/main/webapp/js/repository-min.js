var $jscomp={scope:{},inherits:function(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b;a.prototype.constructor=a;for(var d in c)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(c,d);e&&Object.defineProperty(a,d,e)}else a[d]=c[d]},getGlobal:function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a}};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,d={next:function(){if(b<a.length){var e=b++;return{value:c(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
$jscomp.findInternal=function(a,c,b){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(c.call(b,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");var EntityBase=function(a){this.base=a};EntityBase.prototype.list=function(a){a=void 0===a?{}:a;return $.ajax({type:"post",url:"/"+this.base+"/list",dataType:"json",data:a})};
EntityBase.prototype.select=function(a){var c=new FormData;c.append("id",a);return fetch("/"+this.base+"/select",{method:"post",body:c}).then(function(a){return a.json()})};EntityBase.prototype.save=function(a){a=new FormData(a);return $.ajax({type:"post",url:"/"+this.base+"/save",dataType:"json",data:a,processData:!1,contentType:!1})};
var AccessibleRange=function(a,c){var b=document.createElement("legend");b.textContent="Access:";Object.keys(AccessibleRange.List).forEach(function(b){var d=c+b,f=document.createElement("input"),g=document.createElement("label");f.setAttribute("id",d);f.setAttribute("type","radio");f.setAttribute("name","access");f.setAttribute("value",b);g.setAttribute("for",d);g.textContent=AccessibleRange.List[b];a.append(f);a.append(g)});a.setAttribute("data-role","controlgroup");a.setAttribute("data-type","horizontal");
a.setAttribute("data-mini","true");a.append(b);$(a).parents("form").trigger("create")};AccessibleRange.List={0:"Private",1:"Protected",2:"Public"};var ActorEntity=function(){EntityBase.call(this,"actor")};$jscomp.inherits(ActorEntity,EntityBase);var AudioEntity=function(){EntityBase.call(this,"audio")};$jscomp.inherits(AudioEntity,EntityBase);var Customer=function(){};Customer.prototype.check=function(){return $.ajax({type:"post",url:"/customer/check",dataType:"json",data:{}})};
Customer.prototype.signIn=function(a,c){return $.ajax({type:"post",url:"/customer/signIn",dataType:"json",data:{userid:a,passwd:c}})};var ImageEntity=function(){EntityBase.call(this,"image")};$jscomp.inherits(ImageEntity,EntityBase);
var ImageSelectionButton=function(a,c){c=void 0===c?"other":c;var b=this,d=document.createElement("legend"),e=document.createElement("a"),f=document.createElement("input"),g=document.createElement("img"),h=document.createElement("fieldset"),k=a.toLowerCase();d.textContent=a+":";e.setAttribute("href","#imageChooser");e.setAttribute("data-target",k);e.setAttribute("data-filter",c);e.setAttribute("data-rel","popup");e.className="ui-btn ui-corner-all ui-shadow ui-icon-heart ui-btn-icon-left ui-btn-a";
e.textContent="Choose...";f.setAttribute("type","hidden");f.setAttribute("name",k);f.addEventListener("valueChanged",function(){b.resetImage()});h.append(d);h.append(e);h.append(f);h.append(g);this.fieldset=h;this.button=e;this.hidden=f;this.img=g};ImageSelectionButton.prototype.resetImage=function(){var a=this.hidden.value;a?(this.img.setAttribute("src","/image/src?id="+a),$(this.button).hide()):(this.img.removeAttribute("src"),$(this.button).show())};
var Product=function(){EntityBase.call(this,"product")};$jscomp.inherits(Product,EntityBase);var StageEntity=function(){EntityBase.call(this,"stage")};$jscomp.inherits(StageEntity,EntityBase);var TitleBg=function(){this.x=0;this.width=1200;this.move()};TitleBg.prototype.move=function(a){var c=this;document.querySelector("div[data-role=header]").style.backgroundPosition=-this.x+"px 0";this.x++;this.width<this.x&&(this.x=0);requestAnimationFrame(function(a){return c.move(a)})};
document.addEventListener("DOMContentLoaded",function(){new AppMain;new TitleBg});var AppMain=function(){this.customer=new Customer;this.stageManager=new StageManager;this.actorManager=new ActorManager;this.imageManager=new ImageManager;this.audioManager=new AudioManager;this.imageChooser=new ImageChooser;this.setupPanel();this.checkCustomer();AppMain.Instance=this};
AppMain.prototype.setupPanel=function(){var a=this,c=document.querySelector('[data-role="header"] a'),b=document.querySelector('[data-icon="star"]'),d=document.querySelector('[data-icon="bullets"]'),e=document.querySelector('[data-icon="heart"]'),f=document.querySelector('[data-icon="audio"]');b.addEventListener("click",function(){c.setAttribute("href","#stagePanel");a.manager=a.stageManager;a.manager.list()});d.addEventListener("click",function(){c.setAttribute("href","#actorPanel");a.manager=a.actorManager;
a.manager.list()});e.addEventListener("click",function(){c.setAttribute("href","#imagePanel");a.manager=a.imageManager;a.manager.list()});f.addEventListener("click",function(){c.setAttribute("href","#audioPanel");a.manager=a.audioManager;a.manager.list()});c.addEventListener("click",function(){a.manager.resetPanel()});b.click()};AppMain.prototype.checkCustomer=function(){this.customer.check().then(function(a){})};
var RepositoryManager=function(){this.listView=document.getElementById("listView");this.valueChangedevent=new Event("valueChanged")};RepositoryManager.prototype.setupPanel=function(){var a=this,c=this.form.querySelector(".access");c&&new AccessibleRange(c,this.panelId);this.form.addEventListener("submit",function(b){b.preventDefault();a.entity.save(a.form).then(function(b){b.ok?($(a.panel).panel("close"),a.list()):$(a.panel).find(".message").text("Saving failed.")});return!1})};
RepositoryManager.prototype.resetPanel=function(a){a=void 0===a?{}:a;var c=this;$("#"+this.panelId+" :input").each(function(b,e){b=e.getAttribute("name");var d=$(e);if(b){var g="";b in a&&null!=a[b]&&(g=""+a[b]);d.is(":radio")?d.val([g]).checkboxradio("refresh"):d.is("select")?d.val(g).selectmenu("refresh",!1):d.val(g);d.is(":hidden")&&e.dispatchEvent(c.valueChangedevent)}});var b=$(this.panel).find('[data-role="collapsible"]');0<Object.keys(a).length?b.collapsible("collapse"):b.collapsible("expand")};
RepositoryManager.prototype.list=function(){var a=this;this.listView.textContent="Loadling...";this.entity.list({keyword:""}).then(function(c){a.listView.textContent=null;c.forEach(function(b){var c=a.createRow(b);c.querySelector("a").addEventListener("click",function(){a.resetPanel(b)});a.listView.append(c)});$(a.listView).listview("refresh")})};
RepositoryManager.prototype.createRow=function(a){var c=document.createElement("img"),b=document.createElement("span"),d=document.createElement("p"),e=document.createElement("a"),f=document.createElement("li");b.textContent=a.name;d.textContent=a.description;e.append(c);e.append(b);e.append(d);e.setAttribute("href","#"+this.panelId);f.append(e);return f};$jscomp.global.Object.defineProperties(RepositoryManager.prototype,{panelId:{configurable:!0,enumerable:!0,get:function(){return this.panel.getAttribute("id")}}});
var StageManager=function(){RepositoryManager.call(this);this.panel=document.getElementById("stagePanel");this.form=document.getElementById("stageForm");this.entity=new StageEntity;this.setupPanel()};$jscomp.inherits(StageManager,RepositoryManager);
StageManager.prototype.setupPanel=function(){var a=this,c=this.form.querySelector(".imageButtons");RepositoryManager.prototype.setupPanel.call(this);this.buttonMap={};"BG1 BG2 BG3 FG1 FG2 FG3".split(" ").forEach(function(b){var d=-1!=b.indexOf("b")?"back":"fore";b=new ImageSelectionButton(b,d);d=b.hidden.getAttribute("name");a.buttonMap[d]=b;c.append(b.fieldset)})};
StageManager.prototype.createRow=function(a){var c=RepositoryManager.prototype.createRow.call(this,a),b=c.querySelector("img"),d=null;"bg1 bg2 bg3 fg1 fg2 fg3".split(" ").forEach(function(b){b=a[b];null==d&&null!=b&&0<b.length&&(d=b)});null==d?b.setAttribute("src","/img/icon.listview.png"):b.setAttribute("src","/image/src?id="+d);return c};
var ActorManager=function(){RepositoryManager.call(this);this.panel=document.getElementById("actorPanel");this.form=document.getElementById("actorForm");this.entity=new ActorEntity;this.setupPanel()};$jscomp.inherits(ActorManager,RepositoryManager);
ActorManager.prototype.setupPanel=function(){var a=this,c=this.form.querySelector(".imageButtons");RepositoryManager.prototype.setupPanel.call(this);this.buttonMap={};["ImageId"].forEach(function(b){b=new ImageSelectionButton(b,"act");var d=b.hidden.getAttribute("name");a.buttonMap[d]=b;c.append(b.fieldset)})};ActorManager.prototype.createRow=function(a){var c=RepositoryManager.prototype.createRow.call(this,a);c.querySelector("img").setAttribute("src","/image/src?id="+a.imageid);return c};
var ImageManager=function(){RepositoryManager.call(this);this.panel=document.getElementById("imagePanel");this.form=document.getElementById("imageForm");this.entity=new ImageEntity;this.setupPanel()};$jscomp.inherits(ImageManager,RepositoryManager);
ImageManager.prototype.createRow=function(a){var c=this,b=document.createElement("img"),d=document.createElement("span"),e=document.createElement("p"),f=document.createElement("a"),g=document.createElement("li");b.setAttribute("src","/image/src?id="+a.id);d.textContent=a.name;e.textContent=a.description;f.append(b);f.append(d);f.append(e);f.setAttribute("href","#"+this.panelId);g.append(f);$(f).click(function(){c.resetPanel(a)});return g};
ImageManager.prototype.resetPanel=function(a){a=void 0===a?{}:a;RepositoryManager.prototype.resetPanel.call(this,a);var c=document.getElementById("image.thumbnail");a.id?c.setAttribute("src","/image/src?id="+a.id):c.removeAttribute("src")};var AudioManager=function(){RepositoryManager.call(this);this.panel=document.getElementById("audioPanel");this.form=document.getElementById("audioForm");this.entity=new AudioEntity;this.setupPanel()};$jscomp.inherits(AudioManager,RepositoryManager);
AudioManager.prototype.createRow=function(a){var c=this,b=document.createElement("img"),d=document.createElement("span"),e=document.createElement("p"),f=document.createElement("a"),g=document.createElement("li");b.setAttribute("src","data:image/png;base64,"+a.image);d.textContent=a.name;e.textContent=a.description;f.append(b);f.append(d);f.append(e);f.setAttribute("href","#"+this.panelId);g.append(f);$(f).click(function(){c.resetPanel(a)});return g};
var ImageChooser=function(){var a=this;this.listView=document.querySelector("#imageChooser > ul");this.entity=new ImageEntity;var c={act:1,back:2,fore:3,other:0};document.querySelectorAll('[href="#imageChooser"]').forEach(function(b){b.addEventListener("click",function(){var d=b.getAttribute("data-target"),e=b.getAttribute("data-filter");a.list(a.manager.buttonMap[d],c[e])})})};
ImageChooser.prototype.list=function(a,c){var b=this;c={type:c};this.listView.textContent="Loadling...";this.entity.list(c).then(function(c){b.listView.textContent=null;c.forEach(function(c){var d=b.createRow(c),e=d.querySelector("a");b.listView.append(d);e.addEventListener("click",function(){b.embedId(a,c.id)})});$(b.listView).listview("refresh")})};
ImageChooser.prototype.createRow=function(a){var c=document.createElement("img"),b=document.createElement("span"),d=document.createElement("p"),e=document.createElement("a"),f=document.createElement("li");c.setAttribute("src","/image/src?id="+a.id);b.textContent=a.name;d.textContent=a.description;e.append(c);e.append(b);e.append(d);f.append(e);return f};ImageChooser.prototype.embedId=function(a,c){a=a.hidden;a.value=c;a.dispatchEvent(this.manager.valueChangedevent);$("#imageChooser").popup("close")};
$jscomp.global.Object.defineProperties(ImageChooser.prototype,{manager:{configurable:!0,enumerable:!0,get:function(){return AppMain.Instance.manager}}});
