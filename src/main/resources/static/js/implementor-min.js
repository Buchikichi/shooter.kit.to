var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(k){b.reject(k)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(k){this.reject_(k);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)g.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var g=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(r){f(r)}}:b}var d,f,g=new e(function(a,b){d=a;f=b});this.callWhenSettled_(c(a,d),c(b,f));return g};
e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?g.asyncExecute(c):this.onSettledCallbacks_.push(c)};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,d){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())c(f.value).callWhenSettled_(b,
d)})};e.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){g[b]=c;k--;0==k&&a(g)}}var g=[],k=0;do g.push(void 0),k++,c(d.value).callWhenSettled_(f(g.length-1),e),d=b.next();while(!d.done)})};return e},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};
$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};
$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var e=b.length,g=a.length;c=Math.max(0,Math.min(c|0,b.length));for(var f=0;f<g&&c<e;)if(b[c++]!=a[f++])return!1;return f>=g}},"es6","es3");var Repository=function(){this.loaded=this.max=0;this.dic={};this.reserved={};this.type="json"};Repository.prototype.isComplete=function(){return 0==this.max||0<this.max&&this.max==this.loaded};
Repository.prototype.reserve=function(a,b,c){null==a||0==a.length||a in this.reserved||(this.reserved[a]=!0,this.load(a,void 0===b?null:b,void 0===c?"":c))};Repository.prototype.makeName=function(a){return a};Repository.prototype.load=function(a,b,c){var d=this,e=new XMLHttpRequest;c=this.makeName(a);var g="json"==this.type;this.max++;e.open("GET",c,!0);g||(e.responseType=this.type);e.addEventListener("loadend",function(){var c=e.response;g&&(c=JSON.parse(c));d.onload(a,b,c)});e.send()};
Repository.prototype.onload=function(a,b,c){this.dic[a]=c;b&&(this.dic[b]=c);this.done()};Repository.prototype.done=function(){this.loaded++};Repository.prototype.checkLoading=function(a){var b=this;return new Promise(function(c){var d=function(){b.isComplete()?c():(a(),setTimeout(d,30))};d()})};var Matter=function(a,b,c){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c;this.dy=0;this.dir=null;this.gravity=this.radian=0;this.speed=1};
Matter.prototype.setRect=function(a,b){this.width=a;this.hW=a/2;this.height=b;this.hH=b/2};Matter.prototype.move=function(){};
var Actor=function(a,b,c){Matter.call(this,void 0===a?0:a,void 0===b?0:b,void 0===c?0:c);this.region=new Region(this);this.setRect(16,16);this.animList=[];this.chamberList=[];this.hasBounds=!0;this.reaction=0;this.effectV=this.effectH=!1;this.hitPoint=1;this.activityAreaType=Actor.ActivityAreaType.FREEDOM;this.collidingWallType=Actor.CollidingWallType.THROUGH;this.absorbed=!1;this.absorbedTarget=null;this.score=0;this.isInverse=this.walled=!1;this.recalculation();this.fillStyle=null;this.sfx="sfx-explosion";
this.sfxAbsorb="sfx-absorb";this.enter()};$jscomp.inherits(Actor,Matter);Actor.prototype.recalculation=function(){var a=Product.Instance,b=this.hasBounds?0:a.width;this.minX=-this.width-b;this.minY=-this.height-b;this.maxX=a.width+this.width+b;this.maxY=a.height+this.height+b};Actor.prototype.checkInverse=function(){};Actor.prototype.enter=function(){this.explosion=0;this.isGone=!1};Actor.prototype.eject=function(){this.isGone=!0};
Actor.prototype.aim=function(a){if(a){var b=this.calcDistance(a);this.speed<b&&(this.dir=Math.atan2(a.y-this.y,a.x-this.x))}else this.dir=null;return this};Actor.prototype.closeGap=function(a){a=Math.trim(this.radian-Math.atan2(a.y-this.y,a.x-this.x));return Math.abs(a)<=Actor.DEG_STEP?0:0<a?-Actor.DEG_STEP:Actor.DEG_STEP};Actor.prototype.reactX=function(a){this.dir=Math.trim(this.dir+Math.PI)};Actor.prototype.reactY=function(a){this.y=a;this.dy*=-this.reaction;this.radian=this._stage.map.getHorizontalAngle(this)};
Actor.prototype.trigger=function(a,b){var c=this;b=void 0===b?!1:b;var d=[];this.chamberList.forEach(function(a){return a.probe()});null!=a&&a.isGone||!this.triggered&&!b||(this.triggered=!1,this.chamberList.forEach(function(b){(b=b.fire(c,a))&&d.push(b)}));return d};
Actor.prototype.checkActivityArea=function(){if(this._stage){var a=this.x-this._stage.map.x,b=this.y-this._stage.map.y,c=this._stage.map.x,d=this._stage.map.y;if(this.activityAreaType==Actor.ActivityAreaType.RESTRICTION)a=c+this.hW,b=c+Product.Instance.width-this.hW,c=d+this.hH,d=d+Product.Instance.height-this.hH,this.x<a?this.x=a:b<this.x&&(this.x=b),this._stage.scroll!=Stage.SCROLL.LOOP&&(this.y<c?this.y=c:d<this.y&&(this.y=d));else if(this.activityAreaType==Actor.ActivityAreaType.EJECT)(a<-this.width||
Product.Instance.width+this.width<a)&&this.eject(),this._stage.scroll!=Stage.SCROLL.LOOP&&(b<-this.height||Product.Instance.height+this.height<b)&&this.eject();else{d=2*Product.Instance.width;c=-Product.Instance.height;var e=2*Product.Instance.height;(a<-Product.Instance.width||d<a)&&this.eject();this._stage.scroll!=Stage.SCROLL.LOOP&&(b<c||e<b)&&this.eject()}}};
Actor.prototype.move=function(a){var b=this;if(0<this.explosion&&(this.explosion--,0==this.explosion)){this.eject();return}this.svX=this.x;this.svY=this.y;null!=this.dir&&(this.x+=Math.cos(this.dir)*this.speed,this.y+=Math.sin(this.dir)*this.speed);if(0!=this.gravity){var c=this._stage.map.scanFloor(this),d=!1;0>this.gravity?(c+=this.hH,c<this.y?this.dy+=this.gravity:this.y<c&&(d=!0)):(c-=this.hH,this.y<c?this.dy+=this.gravity:c<this.y&&(d=!0));d&&(2*this._stage.map.brickSize<Math.abs(this.y-c)?this.reactX(c):
this.reactY(c))}this.y+=this.dy*this.speed;this.animList.forEach(function(a){a.next(b.dir)});this.checkActivityArea();return this.trigger(a)};Actor.prototype.drawCircle=function(a){a.save();a.beginPath();a.fillStyle=this.fillStyle;a.arc(0,0,this.radius,0,2*Math.PI,!1);a.fill();a.restore()};Actor.prototype.drawHitPoint=function(a){1E5>this.hitPoint&&(a.save(),a.fillStyle="white",a.fillText(this.hitPoint,0,20),a.restore())};
Actor.prototype.drawNormal=function(a){this.animList.forEach(function(b){b.draw(a)});0==this.animList.length&&this.fillStyle&&this.drawCircle(a)};Actor.prototype.drawAbsorb=function(a){a.fillStyle="rgba(255, 200, 0, 0.4)";a.save();a.translate(this.absorbedTarget.x,this.absorbedTarget.y);a.beginPath();a.arc(0,0,5,0,Math.PI2);a.fill();a.restore();this.absorbedTarget=null};
Actor.prototype.drawExplosion=function(a){var b=this.explosion;a.save();a.fillStyle="rgba(255, 0, 0, 0.7)";a.beginPath();a.arc(0,0,b,0,Math.PI2,!1);a.fill();a.restore()};Actor.prototype.draw=function(a){this.isGone||(a.save(),a.translate(this.x,this.y),0<this.explosion?this.drawExplosion(a):this.drawNormal(a),a.restore(),this.absorbedTarget&&this.drawAbsorb(a))};
Actor.prototype.isHit=function(a){return this.isGone||0<this.explosion||0<a.explosion?!1:this.region.isHit(a.region)?(this.fate(a),a.fate(this),!0):!1};Actor.prototype.calcDistance=function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)};
Actor.prototype.fate=function(a){a=void 0===a?null:a;null!=a&&a.isGone||this.isGone||this.explosion||(this.hitPoint--,0<this.hitPoint?this.absorb(a):(this.explosion=Actor.MAX_EXPLOSION,a=Product.Instance.calcPan(this),AudioMixer.INSTANCE.play(this.sfx,.2,!1,a)))};Actor.prototype.absorb=function(a){this.absorbed=!0;this.absorbedTarget=a;this.sfxAbsorb&&(a=Product.Instance.calcPan(this),AudioMixer.INSTANCE.play(this.sfxAbsorb,.3,!1,a))};
$jscomp.global.Object.defineProperties(Actor.prototype,{anim:{configurable:!0,enumerable:!0,set:function(a){var b=this;Array.isArray(a)?this.animList=a:this.animList=[a];var c=this.width,d=this.height;this.animList.forEach(function(a){a.actor=b;c=Math.max(c,a.width);d=Math.max(d,a.height)});this.setRect(c,d);this.recalculation()}}});Actor.MAX_EXPLOSION=12;Actor.DEG_STEP=Math.PI/180;Actor.Type={None:0,Ship:1,Shot:16,Missile:32,Capsule:48,Bullet:64,Material:80,Enemy:128,Formation:192,Boss:224};
Actor.TypeList="None Enemy Formation Boss Material Bullet Capsule Shot Missile Ship".split(" ");Actor.ActivityAreaType={FREEDOM:0,RESTRICTION:1,EJECT:2};Actor.CollidingWallType={THROUGH:0,SMASH:1,BOUNCE:2,EJECT:4,CRUSH:8,SMASH_CRUSH:9};var Animator=function(a,b,c,d){b=void 0===b?Animator.TYPE.ROTATION:b;c=void 0===c?1:c;d=void 0===d?1:d;Matter.call(this,0,0);this.type=b;this.numX=c;this.numY=d;this.patNum=0;this.setupImage(a)};$jscomp.inherits(Animator,Matter);
Animator.prototype.setupImage=function(a){this.img=VisualManager.Instance.dic[a];this.setRect(this.img.width/this.numX,this.img.height/this.numY)};
Animator.prototype.next=function(a){this.type&Animator.TYPE.V&&.1<Math.abs(this.patNum)&&(this.patNum=0>this.patNum?this.patNum+.1:this.patNum-.1);if(null!=a)if(this.type&Animator.TYPE.X)this.patNum+=.5*Math.cos(a),a=Math.floor(this.patNum),0>a?this.patNum=this.numX-.1:this.numX<=a&&(this.patNum=0);else if(this.type&Animator.TYPE.Y)this.patNum+=.5*Math.sin(a),a=Math.floor(this.patNum),0>a?this.patNum=this.numY-.1:this.numY<=a&&(this.patNum=0);else if(this.type&Animator.TYPE.V){var b=Math.floor(this.numY/
2);this.patNum+=Math.sin(a)/3;this.patNum<-b?this.patNum=-b:b<this.patNum&&(this.patNum=b)}this.patNum*=1E3;this.patNum=Math.round(this.patNum)/1E3};
Animator.prototype.draw=function(a){var b=this.actor,c=this.width,d=this.height,e=0,g=0;this.type&Animator.TYPE.X?e=c*Math.floor(this.patNum):this.type&Animator.TYPE.Y?g=d*Math.floor(this.patNum):this.type&Animator.TYPE.V&&(g=d*(parseInt(this.patNum)+(this.numY?parseInt(this.numY/2):0)));a.save();this.type==Animator.TYPE.NONE&&b.isInverse&&a.rotate(Math.PI);this.type&Animator.TYPE.ROTATION&&a.rotate(b.radian);b.scale&&a.scale(b.scale,b.scale);a.drawImage(this.img,e,g,c,d,-this.hW,-this.hH,c,d);a.restore()};
Animator.TYPE={NONE:0,ROTATION:1,X:2,Y:4,XY:6,H:8,V:16};var AudioMixer=function(){Repository.call(this);this.type="arraybuffer";this.ctx=null;if(window.AudioContext||window.webkitAudioContext)this.ctx=new (window.AudioContext||window.webkitAudioContext);this.dic=[];this.bgm=[];this.lastTime=this.lastKey=null};$jscomp.inherits(AudioMixer,Repository);
AudioMixer.prototype.makeName=function(a){var b=navigator.userAgent.toLowerCase(),c=36==a.length;return-1!==b.indexOf("edge")||-1!==b.indexOf("safari")?c?"/audio/audio/"+a:"/audio/audioName/"+a:c?"/audio/webm/"+a:"/audio/webmName/"+a};AudioMixer.prototype.onload=function(a,b,c){var d=this;null===this.ctx?this.done():this.ctx.decodeAudioData(c,function(c){d.dic[a]=c;b&&(d.dic[b]=c);d.done()})};
AudioMixer.prototype.play=function(a){if(null!==this.ctx&&this.dic[a]){var b=arguments.length,c=1<b?arguments[1]:1,d=2<b?arguments[2]:!1,e=3<b?arguments[3]:0;b=4<b?arguments[4]:0;var g=this.dic[a],f=new AudioElement(this.ctx,g,b);d&&(f.source.loopEnd=g.duration,f.source.loop=!0,this.bgm.push(f),this.lastKey=a);f.gainNode.gain.value=c;f.setPan(e);this.lastTime=this.ctx.currentTime-b}};AudioMixer.prototype.setPan=function(a){this.bgm.forEach(function(b){b.setPan(a)})};AudioMixer.prototype.fade=function(){this.bgm.forEach(function(a){a.fade()})};
AudioMixer.prototype.stop=function(){this.bgm.forEach(function(a){a.stop()})};AudioMixer.prototype.getCurrentTime=function(){if(0<this.bgm.length){var a=[];this.bgm.forEach(function(b){b.done||a.push(b)});this.bgm=a}return this.bgm.length?this.ctx.currentTime-this.lastTime:null};AudioMixer.prototype.setCurrentTime=function(a){this.bgm.length&&(this.stop(),this.play(this.lastKey,1,!0,0,a))};AudioMixer.INSTANCE=new AudioMixer;
function AudioElement(a,b,c){var d=this;this.done=!1;this.source=a.createBufferSource();this.gainNode=a.createGain();this.gainNode.connect(a.destination);"function"==typeof a.createStereoPanner?(this.panNode=a.createStereoPanner(),this.panNode.connect(this.gainNode),this.source.connect(this.panNode)):(this.panNode=null,this.source.connect(this.gainNode));this.source.buffer=b;this.source.start(0,c);this.source.onended=function(){d.done=!0}}
AudioElement.prototype.setPan=function(a){this.panNode&&(this.panNode.pan.value=a)};AudioElement.prototype.fade=function(){var a=this,b=this.gainNode.gain,c=b.value,d=function(){0==Math.floor(100*c)?a.stop():(c*=.9,b.value=c,setTimeout(d,600))};d()};AudioElement.prototype.stop=function(){this.done||this.source.stop()};
var Bricks=function(a){var b=this;this.bricks=null;if(a.map){var c=new Image;c.onload=function(){var a=document.createElement("canvas"),e=a.getContext("2d");a.width=c.width;a.height=c.height;e.drawImage(c,0,0);b.bricks=e.getImageData(0,0,c.width,c.height)};c.src=a.map}else this.reset(a);this.fieldMap=a};
Bricks.prototype.reset=function(a){var b=this;(new Promise(function(b){var c=function(){a._mainVisual.image?b(a._mainVisual.image):setTimeout(c,30)};c()})).then(function(c){var d=c.width/a.brickSize;c=c.height/a.brickSize;var e=d*c*4;b.bricks=new ImageData(d,c);b.bricks.data=Array(e)})};
Bricks.prototype.getIndex=function(a){if(!this.bricks)return-1;var b=this.fieldMap.brickSize,c=parseInt(a.x/b);b=parseInt(a.y/b);a._stage&&a._stage.isLoop&&(0>b&&(b+=this.bricks.height),this.bricks.height<b&&(b-=this.bricks.height));return 0>c||this.bricks.width<c||0>b||this.bricks.height<b?-1:4*(b*this.bricks.width+c)};Bricks.prototype.getBrick=function(a){a=this.getIndex(a);return-1==a?0:this.bricks.data[a+2]};
Bricks.prototype.putBrick=function(a,b){this.bricks.data[a+2]=b;this.bricks.data[a+3]=b?255:0};
Bricks.prototype.scanFloor=function(a){if(this.bricks){var b=this.fieldMap.brickSize,c,d=this.getBrick(a),e=0>a.gravity?-1:1;if(0<d){for(c=Math.floor(a.y/b)*b;0<d;)c-=b*e,d=this.getBrick({x:a.x,y:c});c+=b*e}else if(c=Math.floor(a.y/b)*b,0>e){for(;0<c&&!d;)c-=b,d=this.getBrick({x:a.x,y:c});d||(c=-a.height-b)}else{for(;c<a._stage.height&&!d;)c+=b,d=this.getBrick({x:a.x,y:c});d||(c=a._stage.height+a.height+b)}return c}};
Bricks.prototype.getHorizontalAngle=function(a){var b=this.fieldMap.brickSize,c=a.y-2*b,d=Object.assign({},a,{x:a.x-b,y:c});b=Object.assign({},a,{x:a.x+b,y:c});d=this.scanFloor(d);b=this.scanFloor(b);return Math.atan2(b-d,a.width)};
Bricks.prototype.isHit=function(a){if(!this.bricks)return!1;var b=this.getIndex(a);if(-1==b)return!1;var c=this.bricks.data[b+2];0<c&&(a.collidingWallType&Actor.CollidingWallType.EJECT&&a.eject(),a.collidingWallType&Actor.CollidingWallType.CRUSH&&a.fate());c==Bricks.BRICK_TYPE.BRITTLE&&a.collidingWallType&Actor.CollidingWallType.SMASH&&(this.bricks.data[b+2]=0,this.fieldMap._mainVisual.smash(a));return c};
Bricks.prototype.draw=function(a){var b=4*this.bricks.width,c=this.bricks.data,d=this.fieldMap.brickSize,e=.9*d,g=d/2,f=this.fieldMap.progress/this.fieldMap.scale-d;a.save();a.strokeStyle="rgba(255, 255, 255, .3)";a.fillStyle="rgba(0, 0, 0, .3)";for(var h=0;h<this.bricks.height;h++)for(var k=h*b,l=h*d,q=!0,p=0;p<b;p++,k+=4){var m=p*d,n=c[k+2];m<f||(q?(a.fillStyle="rgba(0, 0, 0, .8)",q=!1):a.fillStyle="rgba(0, 0, 0, .3)",n==Bricks.BRICK_TYPE.BRITTLE?(m+=g,n=l+g,a.beginPath(),a.arc(m,n,e/2,0,Math.PI2,
!1),a.fill(),a.stroke()):0<n&&(a.fillRect(m,l,e,e),a.strokeRect(m,l,e,e)))}a.restore()};Bricks.BRICK_TYPE={WALL:255,BRITTLE:254};var Bullet=function(a,b){Actor.call(this,a,b);this.region=new Region(this,2);this.radius=3;this.speed=2;this.anim=new Animator("bullet");this.activityAreaType=Actor.ActivityAreaType.EJECT;this.collidingWallType=Actor.CollidingWallType.EJECT;this.recalculation()};$jscomp.inherits(Bullet,Actor);Bullet.CollidingWallType=Actor.CollidingWallType;Bullet.ActivityAreaType=Actor.ActivityAreaType;
Bullet.TypeList=Actor.TypeList;Bullet.Type=Actor.Type;Bullet.DEG_STEP=Actor.DEG_STEP;Bullet.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Bullet.prototype.move=function(a){Actor.prototype.move.call(this,a);this.radian+=Bullet.RAD_STEP};Bullet.RAD_STEP=Math.PI/180;var Capsule=function(a){Actor.call(this,a.x,a.y,-1);this.region=new Region(this,8);this.speed=0};$jscomp.inherits(Capsule,Actor);Capsule.CollidingWallType=Actor.CollidingWallType;Capsule.ActivityAreaType=Actor.ActivityAreaType;Capsule.TypeList=Actor.TypeList;
Capsule.Type=Actor.Type;Capsule.DEG_STEP=Actor.DEG_STEP;Capsule.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Capsule.prototype.move=function(a){Actor.prototype.move.call(this,a);this.region.isHit(a.region)&&this.fate(a)};Capsule.RANGE=20;var Chamber=function(a,b,c,d){c=void 0===c?Number.MAX_SAFE_INTEGER:c;d=void 0===d?{}:d;this.type=a;this.cycle=b;this.max=c;this.opt=d;this.reset()};Chamber.prototype.reset=function(){this.tick=0;this.hands=[]};
Chamber.prototype.probe=function(){var a=[];this.hands.forEach(function(b){b.isGone||a.push(b)});this.hands=a;this.tick++};Chamber.prototype.fire=function(a,b){b=void 0===b?null:b;if(this.tick<this.cycle||this.max<=this.hands.length)return null;var c=new this.type(a.x,a.y,this.opt);if(b){var d=0;Product.Instance.stage.isMoving&&(d=a.calcDistance(b)/c.speed*Product.Instance.stage.fg.speed);c.dir=Math.atan2(b.y-a.y,b.x-a.x+d)}this.tick=0;this.hands.push(c);return c};
var Controller=function(a){this.keys={};this.point={};this.touch=!1;this.init(void 0===a?!1:a);Controller.Instance=this};Controller.prototype.init=function(a){a||window.addEventListener("contextmenu",function(a){a.preventDefault()});this.initKeys();this.initPointingDevice()};
Controller.prototype.initKeys=function(){var a=this;window.addEventListener("keydown",function(b){b.key?a.keys[b.key]=!0:a.keys["k"+b.keyCode]=!0});window.addEventListener("keyup",function(b){b.key?delete a.keys[b.key]:delete a.keys["k"+b.keyCode]})};
Controller.prototype.initPointingDevice=function(){var a=this,b=document.getElementById("canvas"),c=function(){a.touch=!1;a.point=null;a.prev=null;a.move=null;a.delta=null};b.addEventListener("mousedown",function(b){a.touch=!0;a.point=FlexibleView.Instance.convert(b.clientX,b.clientY);a.prev=a.point;a.move=a.point;a.delta={x:0,y:0}});b.addEventListener("mousemove",function(b){a.move=FlexibleView.Instance.convert(b.clientX,b.clientY);a.touch&&(a.point=a.move,a.delta={x:a.point.x-a.prev.x,y:a.point.y-
a.prev.y})});b.addEventListener("mouseup",function(){return c()});b.addEventListener("mouseleave",function(){return c()});b.addEventListener("touchstart",function(b){var c=b.touches[0];a.touch=!0;a.point=FlexibleView.Instance.convert(c.pageX,c.pageY);b.preventDefault()});b.addEventListener("touchmove",function(b){b=b.touches[0];a.touch=!0;a.point=FlexibleView.Instance.convert(b.pageX,b.pageY)});b.addEventListener("touchend",function(){return c()})};
Controller.prototype.decPoint=function(a,b){this.prev.x+=a;this.prev.y+=b};var Enemy=function(a,b,c){Actor.call(this,a,b,void 0===c?0:c);this.radian=Math.PI;this.routine=null;this.routineCnt=this.routineIx=0;this.chamberList=[new Chamber(Bullet,Enemy.TRIGGER_CYCLE)]};$jscomp.inherits(Enemy,Actor);Enemy.CollidingWallType=Actor.CollidingWallType;Enemy.ActivityAreaType=Actor.ActivityAreaType;Enemy.TypeList=Actor.TypeList;Enemy.Type=Actor.Type;Enemy.DEG_STEP=Actor.DEG_STEP;Enemy.MAX_EXPLOSION=Actor.MAX_EXPLOSION;
Enemy.prototype.checkInverse=function(){var a=Product.Instance.stage.map,b=Object.assign({},this,{y:this.y+this.hH+a.brickSize/2});this.isInverse=!a.bricks.isHit(b)};Enemy.prototype.move=function(a){this.routine&&this.routine[this.routineIx].tick(this,a);var b=Actor.prototype.move.call(this,a);!(a instanceof Enemy)&&this.calcDistance(a)<Enemy.TRIGGER_ALLOWANCE&&(b=[]);return b};Enemy.assign=function(a,b,c){a=Enemy.LIST[a%Enemy.LIST.length];if(!a)return null;a=Object.assign({},a);a.x=b;a.y=c;return a};
Enemy.TRIGGER_CYCLE=50;Enemy.TRIGGER_ALLOWANCE=100;Enemy.MAX_TYPE=127;Enemy.LIST=[];var Chain=function(a,b){Enemy.call(this,a,b);this.next=this.prev=null};$jscomp.inherits(Chain,Enemy);Chain.CollidingWallType=Enemy.CollidingWallType;Chain.ActivityAreaType=Enemy.ActivityAreaType;Chain.TypeList=Enemy.TypeList;Chain.Type=Enemy.Type;Chain.DEG_STEP=Enemy.DEG_STEP;Chain.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Chain.LIST=Enemy.LIST;Chain.MAX_TYPE=Enemy.MAX_TYPE;Chain.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;
Chain.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Chain.assign=Enemy.assign;Chain.prototype.unshift=function(a){a.next=this;if(a.prev=this.prev)this.prev.next=a;this.prev=a;return this};Chain.prototype.push=function(a){a.prev=this;if(a.next=this.next)this.next.prev=a;this.next=a;return this};Chain.prototype.remove=function(){this.prev.next=this.next;this.next.prev=this.prev;return this.next};var Field=function(a){Matter.call(this);this.setRect(a.width,a.height);this.setupLandform(a);Field.Instance=this};
$jscomp.inherits(Field,Matter);Field.prototype.setupLandform=function(a){this.landform=new Landform(a.canvas)};Field.MAX_ENEMIES=100;Field.ENEMY_CYCLE=10;var FieldMap=function(){Matter.call(this);this.progressH=0;this._mainVisual=null};$jscomp.inherits(FieldMap,Matter);FieldMap.prototype.reset=function(){this.progressH=0;this.mapVisualList.forEach(function(a){return a.reset()});this.bricks=new Bricks(this)};FieldMap.prototype.scanFloor=function(a){return this.bricks.scanFloor(a)};
FieldMap.prototype.getHorizontalAngle=function(a){return this.bricks.getHorizontalAngle(a)};FieldMap.prototype.checkHit=function(a){a.walled=this.bricks.isHit(a)};FieldMap.prototype.setProgress=function(a){this.mapVisualList.forEach(function(b){return b.setProgress(a)})};
FieldMap.prototype.addProgressH=function(a){var b=this._stage;this.progressH+=a;if(b.scroll==Stage.SCROLL.ON){a=-this._mainVisual.image.height+Product.Instance.height;if(0<this.progressH)return this.progressH=0,!1;if(this.progressH<a)return this.progressH=a,!1}return!0};FieldMap.prototype.draw=function(a){this.mapVisualList.forEach(function(b){return b.draw(a)})};
FieldMap.prototype.migrate=function(){var a=this;if(!(0<this.mapVisualList.length)){console.log("FieldMap#migrate");var b=0;[{id:this.bg1,radian:this.bg1dir,speed:this.bg1speed,blink:this.bg1blink},{id:this.bg2,radian:this.bg2dir,speed:this.bg2speed,blink:this.bg2blink},{id:this.bg3,radian:this.bg3dir,speed:this.bg3speed,blink:this.bg3blink},{id:this.fg1,radian:this.fg1dir,speed:this.fg1speed,blink:this.fg1blink},{id:this.fg2,radian:this.fg2dir,speed:this.fg2speed,blink:this.fg2blink},{id:this.fg3,
radian:this.fg3dir,speed:this.fg3speed,blink:this.fg3blink}].forEach(function(c){if(null!=c.id&&0<c.id.length){var d=Mediaset.Instance.getVisual(c.id);c.id==a.fg1&&(a.mainSeq=b);a.mapVisualList.push(Object.assign(c,d,{seq:b++}))}});console.log("this.mapVisualList:"+this.mapVisualList.length);console.log("this.mainSeq:"+this.mainSeq)}};
FieldMap.prototype.init=function(){var a=this,b=[];this.migrate();console.log("mainSeq:"+this.mainSeq);this.mapVisualList.forEach(function(c){c._fieldMap=a;c.isMain=c.seq==a.mainSeq;c.z=1E4*c.seq-1;var d=MapVisual.create(c);c.isMain&&(a._mainVisual=d);b.push(d)});this.mapVisualList=b;this.reset();return this};FieldMap.create=function(a){return"string"==typeof a?(new MapEntity).select(a).then(function(a){return FieldMap.create(a)}):Object.assign(new FieldMap,a).init()};
$jscomp.global.Object.defineProperties(FieldMap.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return-this._mainVisual.x}},y:{configurable:!0,enumerable:!0,get:function(){return-this._mainVisual.y}}});var MapVisual=function(){Matter.call(this);this._imgName=this._img=null;this.isMain=!1;this.pattern=this.canvas=null;this.alpha=1;this.blinkDir=-1;this.effectV=this.effectH=0};$jscomp.inherits(MapVisual,Matter);MapVisual.prototype.reset=function(){this.pattern=this.canvas=null};
MapVisual.prototype.setProgress=function(a){var b=this.image.height,c=this._fieldMap._stage;this.x=a*Math.cos(this.radian)*this.speed;this.y=(a*Math.sin(this.radian)*this.speed+this._fieldMap.progressH)%b;c&&(c.scroll==Stage.SCROLL.LOOP&&0<this.y&&(this.y-=b),c.scroll==Stage.SCROLL.OFF|c.scroll==Stage.SCROLL.TOP&&0<this.y&&(this.y=0))};
MapVisual.prototype.getPattern=function(a){var b=this.image;null==this.canvas&&(this.canvas=document.createElement("canvas"),this.canvas.width=b.width,this.canvas.height=b.height,this.canvas.getContext("2d").drawImage(b,0,0));null==this.pattern&&(this.pattern=a.createPattern(this.canvas,"repeat"));return this.pattern};MapVisual.prototype.smash=function(a){var b=this.canvas.getContext("2d"),c=this._fieldMap.brickSize,d=parseInt(a.x/c)*c;a=parseInt(a.y/c)*c;b.clearRect(d,a,c,c);this.pattern=null};
MapVisual.prototype.draw=function(a){a.save();a.translate(this.x+this._fieldMap.x,this.y+this._fieldMap.y);a.globalAlpha=this.alpha;a.beginPath();a.fillStyle=this.getPattern(a);a.rect(-this.x,-this.y,a.canvas.width,a.canvas.height);a.fill();a.restore();this.blink&&(this.alpha+=this.blinkDir*this.blink,.3>=this.alpha||1<=this.alpha)&&(this.blinkDir*=-1)};
MapVisual.prototype.drawForDebug=function(a){var b=-this.x,c=10*this.seq;a.fillStyle="orange";a.beginPath();a.arc(b,c,5,0,Math.PI2);a.fill();a.fillStyle="pink";a.beginPath();a.arc(b+a.canvas.width,c,5,0,Math.PI2);a.fill()};MapVisual.create=function(a){return Object.assign(new MapVisual,a)};
$jscomp.global.Object.defineProperties(MapVisual.prototype,{image:{configurable:!0,enumerable:!0,get:function(){this._img||(this._img=Mediaset.Instance.getImage(this));return this._img}},imageName:{configurable:!0,enumerable:!0,get:function(){this._imgName||(this._imgName=Mediaset.Instance.getImageName(this));return this._imgName}}});
var FlexibleView=function(a,b){this.view=document.getElementById("view");this.canvas=document.getElementById("canvas");this.ctx=this.canvas.getContext("2d");this.scale=1;this.init();this.setSize(a,b);FlexibleView.Instance=this};FlexibleView.prototype.setSize=function(a,b){this.width=a;this.height=b;this.canvas.width=a;this.canvas.height=b;this.resize()};
FlexibleView.prototype.init=function(){var a=this,b=document.querySelector('[data-role="header"]'),c=document.querySelector('[data-role="footer"]');this.headerHeight=b?b.offsetHeight:0;this.footerHeight=c?c.offsetHeight:0;this.margin=this.headerHeight+this.footerHeight;window.addEventListener("resize",function(){a.resize()});window.addEventListener("keydown",function(){view.classList.contains("addicting")||view.classList.add("addicting")});window.addEventListener("mousemove",function(){view.classList.remove("addicting")})};
FlexibleView.prototype.resize=function(){var a=document.body.clientWidth/this.width,b=(window.innerHeight-this.margin)/this.height;this.scale=b<a?b:a;this.view.setAttribute("style",["width:"+this.width+"px","height:"+this.height+"px","transform: scale("+this.scale+")"].join(";"))};FlexibleView.prototype.convert=function(a,b){return{x:a/this.scale,y:(b-this.headerHeight)/this.scale}};FlexibleView.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)};
var Formation=function(a,b){Actor.call(this,a,b);this.count=this.steps=0;this.enemies=[]};$jscomp.inherits(Formation,Actor);Formation.CollidingWallType=Actor.CollidingWallType;Formation.ActivityAreaType=Actor.ActivityAreaType;Formation.TypeList=Actor.TypeList;Formation.Type=Actor.Type;Formation.DEG_STEP=Actor.DEG_STEP;Formation.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Formation.prototype.setup=function(a,b){for(var c=0;c<b;c++){var d=new a(this.x,this.y);this.bonus||(this.bonus=this.score=10*d.score);this.enemies.push(d)}return this};
Formation.prototype.isDestroyed=function(){var a=this,b=[];this.enemies.forEach(function(c){0!=c.hitPoint&&(b.push(c),a.x=c.x,a.y=c.y)});this.enemies=b;return 0==b.length&&0==this.explosion?(this.explosion=4*Actor.MAX_EXPLOSION,!0):!1};
Formation.prototype.move=function(a){Actor.prototype.move.call(this,a);this.isGone=0==this.enemies.filter(function(a){return!a.isGone}).length;if(this.enemies.length<=this.count){if(!this.isGone&&this.isDestroyed())return a=[SpeedupCapsule,MissileCapsule],[new (a[Math.floor(Math.random()*a.length)])(this)]}else if(0==this.steps++%Formation.STEP)return[this.enemies[this.count++]]};Formation.prototype.drawExplosion=function(a){a.fillStyle="rgba(240, 240, 255, .8)";a.fillText(this.bonus,0,0)};
Formation.STEP=10;var Landform=function(a){this.canvas=a;this.ctx=a.getContext("2d");this.effectH=0;this.next=Landform.NEXT.NONE;this.col=0;this.colDir=1;this.target=null;this.ty=this.tx=0;this.selection="b0";this.brickVal=this.brick=this.which=null;this.touch=!1;this.reverse=new Image;this.reverse.src="/img/reverse.png";this.touch=!1;this.scenarioList=[]};
Landform.prototype.loadStage=function(a){console.log("Landform#loadStage");var b=Field.Instance,c=a.fg.image;this.stage=a;a.mapData&&this.loadMapData(a.mapData);this.width=c.width;this.height=c.height;this.bw=this.width/Landform.BRICK_WIDTH;this.bh=this.height/Landform.BRICK_WIDTH;this.viewX=this.width-1.5*b.hW;this.arrivX=this.width-b.width;this.noticeX=this.arrivX-b.hW;this.reset()};
Landform.prototype.loadMapData=function(a){var b=this,c=new Image;c.onload=function(){var a=document.createElement("canvas"),e=a.getContext("2d");a.width=c.width;a.height=c.height;e.drawImage(c,0,0);b.brick=e.getImageData(0,0,c.width,c.height);b.loadScenario();b.touch=!0};c.src=a};Landform.prototype.loadScenario=function(){};Landform.prototype.reset=function(){this.next=Landform.NEXT.NONE;Product.Instance.stage&&Product.Instance.stage.reset()};
Landform.prototype.retry=function(){this.next=Landform.NEXT.NONE;Product.Instance.stage&&this.loadMapData(Product.Instance.stage.mapData)};Landform.prototype.getBrickIndex=function(a){var b=Product.Instance.stage.fg,c=Math.round((b.x+a.x-Landform.BRICK_HALF)/Landform.BRICK_WIDTH);if(0>c||this.bw<c)return-1;a=Math.round((b.y+a.y-Landform.BRICK_HALF)/Landform.BRICK_WIDTH);a%=this.bh;return a*this.bw*4+4*c};
Landform.prototype.getBrick=function(a,b){b=void 0===b?Landform.BRICK_LAYER.BRICK:b;if(!this.brick)return null;a=this.getBrickIndex(a);return 0>a?null:this.brick.data[a+b]};Landform.prototype.getAttr=function(a){return this.getBrick(a,Landform.BRICK_LAYER.ATTR)};Landform.prototype.getActor=function(a){return this.getBrick(a,Landform.BRICK_LAYER.ACTOR)};
Landform.prototype.putBrick=function(a,b,c){c=void 0===c?Landform.BRICK_LAYER.BRICK:c;a=this.getBrickIndex(a);0>a||(this.brick.data[a+c]=b,this.brick.data[a+3]=b?255:0)};$jscomp.global.Object.defineProperties(Landform.prototype,{mapImage:{configurable:!0,enumerable:!0,get:function(){var a=document.createElement("canvas"),b=a.getContext("2d");a.width=this.brick.width;a.height=this.brick.height;b.putImageData(this.brick,0,0);return a.toDataURL("image/png")}}});Landform.BRICK_WIDTH=8;
Landform.BRICK_HALF=Landform.BRICK_WIDTH/2;Landform.BRICK_LAYER={ATTR:0,ACTOR:1,BRICK:2};Landform.BRICK_TYPE={WALL:255,BRITTLE:254};Landform.ATTR={NONE:0,REVERSE:1};Landform.COL_MAX=512;Landform.NEXT={NONE:0,NOTICE:1,ARRIV:2,IDLE:3,PAST:4};
Landform.prototype.effect=function(a){var b=Math.max(Product.Instance.width+a.width,a.maxX);a.effectH&&(a.x-=this.effectH);a.effectV&&this.next==Landform.NEXT.NONE&&(a.y+=Product.Instance.stage.effectV*Product.Instance.stage.fg.speed);(a.x<a.minX||b<a.x)&&a.eject();Product.Instance.stage.scroll==Stage.SCROLL.OFF?(a.y<a.minY||a.maxY<a.y)&&a.eject():Product.Instance.stage.scroll==Stage.SCROLL.ON?(a.y<-this.height||this.height+a.maxY<a.y)&&a.eject():a.gravity&&Landform.BRICK_WIDTH+Landform.BRICK_HALF<
Math.abs(a.dy*a.speed)?a.eject():0>a.y?a.y+=this.height:this.height<a.y&&(a.y-=this.height)};
Landform.prototype.forward=function(a){var b=Product.Instance.stage.map;this.next!=Landform.NEXT.ARRIV&&Product.Instance.stage.scrollV(a);if(this.viewX<=b.x)return this.effectH=0,this.next!=Landform.NEXT.PAST?this.next=Landform.NEXT.PAST:Landform.NEXT.NONE;Product.Instance.stage.forward();if(this.arrivX<=b.x){if(this.next==Landform.NEXT.NOTICE)return this.effectH=0,this.next=Landform.NEXT.ARRIV;if(this.arrivX<b.x)return this.next=Landform.NEXT.IDLE}else if(this.noticeX<=b.x&&this.next!=Landform.NEXT.NOTICE)return this.next=
Landform.NEXT.NOTICE;return Landform.NEXT.NONE};Math.PI2=Math.PI2||2*Math.PI;Math.SQ=Math.SQ||Math.PI/2;Math.trim=Math.trim||function(a){for(;Math.PI<a;)a-=Math.PI2;for(;a<-Math.PI;)a+=Math.PI2;return a};Math.close=Math.close||function(a,b,c){b=Math.trim(a-b);return Math.abs(b)<=c?a:0<b?a-c:a+c};function Matrix(a){this.mat=a}Matrix.NO_EFFECT=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];
Matrix.rotateX=function(a){return new Matrix([[1,0,0,0],[0,Math.cos(a),-Math.sin(a),0],[0,Math.sin(a),Math.cos(a),0],[0,0,0,1]])};Matrix.rotateY=function(a){return new Matrix([[Math.cos(a),0,Math.sin(a),0],[0,1,0,0],[-Math.sin(a),0,Math.cos(a),0],[0,0,0,1]])};Matrix.rotateZ=function(a){return new Matrix([[Math.cos(a),-Math.sin(a),0,0],[Math.sin(a),Math.cos(a),0,0],[0,0,1,0],[0,0,0,1]])};
Matrix.prototype.multiply=function(a){var b=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],c=a.mat;this.mat.forEach(function(a,e){a.forEach(function(d,f){for(var g=d=0;4>g;g++)d+=a[g]*c[g][f];b[e][f]=d})});return new Matrix(b)};Matrix.prototype.affine=function(a,b,c){var d=this.mat;return{x:d[0][0]*a+d[0][1]*b+d[0][2]*c+d[0][3],y:d[1][0]*a+d[1][1]*b+d[1][2]*c+d[1][3],z:d[2][0]*a+d[2][1]*b+d[2][2]*c+d[2][3]}};var Mediaset=function(){this.audioDic={};this.visualDic={}};
Mediaset.prototype.loadAudio=function(){var a=this;this.audioList.forEach(function(b){a.audioDic[b.audioType+":"+b.audioSeq]=b;AudioMixer.INSTANCE.reserve(b.id,b.name)});return this};Mediaset.prototype.loadVisual=function(){var a=this;this.visualList.forEach(function(b){a.visualDic[b.visualType+":"+b.visualSeq]=b;VisualManager.Instance.reserve(b.id,b.name,b.contentType)});return this};Mediaset.prototype.load=function(){return this.loadAudio().loadVisual()};
Mediaset.prototype.checkLoading=function(a){var b=[VisualManager.Instance,AudioMixer.INSTANCE],c=b.reduce(function(a,b){return a.max+b.max}),d=function(){var d=b.reduce(function(a,b){return a.loaded+b.loaded});a(d,c)};return Promise.all([VisualManager.Instance.checkLoading(d),AudioMixer.INSTANCE.checkLoading(d)])};Mediaset.prototype.getVisual=function(a){var b=null;this.visualList.forEach(function(c){c.id==a&&(b=c)});return b};
Mediaset.prototype.getImage=function(a){return VisualManager.Instance.dic[this.visualDic[a.visualType+":"+a.visualSeq].id]};Mediaset.prototype.getImageName=function(a){return this.visualDic[a.visualType+":"+a.visualSeq].name};Mediaset.create=function(a){if("string"==typeof a)return(new MediasetEntity).select(a).then(function(a){return Mediaset.create(a)});Mediaset.Instance=Object.assign(new Mediaset,a);return Mediaset.Instance};Mediaset.Instance=null;var Visual=function(){};
Visual.TYPE={Player:0,Shot:1,Item:2,Aerial:3,Subaerial:4,Boss:5,Ornament:6,Explosion:7,Background:8,Foreground:9,Other:10};var Missile=function(a,b,c){Actor.call(this,a,b);this.dir=c.dir;this.radius=2;this.speed=3;this.gravity=c.gravity;this.activityAreaType=Actor.ActivityAreaType.EJECT;this.recalculation();this.shuttle=3;this.fillStyle="rgba(200, 200, 255, 0.6)"};$jscomp.inherits(Missile,Actor);Missile.CollidingWallType=Actor.CollidingWallType;Missile.ActivityAreaType=Actor.ActivityAreaType;
Missile.TypeList=Actor.TypeList;Missile.Type=Actor.Type;Missile.DEG_STEP=Actor.DEG_STEP;Missile.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Missile.prototype.reactX=function(a){Actor.prototype.reactX.call(this,a);this.shuttle--;0>this.shuttle&&this.fate()};Missile.prototype.fate=function(){this.eject()};function Gizmo(a,b,c){this.type=a;this.destination=b;this.param=void 0===c?null:c}Gizmo.TYPE={FIXED:0,OWN:1,AIM:2,CHASE:3};Gizmo.DEST={TO:0,TO_X:1,TO_Y:2,ROTATE:3,ROTATE_L:4,ROTATE_R:5,LEFT:6,RIGHT:7};
Gizmo.prototype.tick=function(a,b){if(this.type==Gizmo.TYPE.FIXED)this.destination==Gizmo.DEST.ROTATE?a.radian=a.dir:a.dir=null;else if(this.type==Gizmo.TYPE.OWN)this.destination==Gizmo.DEST.ROTATE_L?a.dir-=a.step:this.destination==Gizmo.DEST.ROTATE_R?a.dir+=a.step:this.destination==Gizmo.DEST.LEFT?a.dir=Math.PI:this.destination==Gizmo.DEST.RIGHT&&(a.dir=0);else{var c=b.x-a.x,d=b.y-a.y;Math.abs(c)<=a.speed&&(c=0);Math.abs(d)<=a.speed&&(d=0);this.type==Gizmo.TYPE.AIM?this.destination==Gizmo.DEST.TO_X?
a.radian=0>c?Math.PI:0:this.destination==Gizmo.DEST.TO_Y?a.radian=0>c?-Math.SQ:Math.SQ:this.destination==Gizmo.DEST.ROTATE&&(b=a.calcDistance(b),a.speed<b&&(a.radian=Math.close(a.radian,Math.atan2(d,c),this.param?this.param:Math.PI/30),a.radian=Math.trim(a.radian))):this.type==Gizmo.TYPE.CHASE&&(this.destination==Gizmo.DEST.TO?a.dir=Math.atan2(d,c):this.destination==Gizmo.DEST.TO_X&&c?a.dir=Math.atan2(0,c):this.destination==Gizmo.DEST.TO_Y&&d?a.dir=Math.atan2(d,0):this.destination==Gizmo.DEST.ROTATE&&
(a.dir=Math.close(a.dir,Math.atan2(d,c),this.param?this.param:Math.PI/60),a.radian=a.dir))}};function Movement(a){var b=parseInt(a);this.cond=a;this.count=b==a?b:null;this.list=[]}Movement.COND={X:"x",Y:"y"};Movement.prototype.add=function(a,b,c){this.list.push(new Gizmo(a,b,c));return this};
Movement.prototype.isValid=function(a,b){if(this.cond){if(this.count){if(a.routineCnt++<this.count)return!0;a.routineCnt=0;return!1}var c=b.x-a.x;b=b.y-a.y;return this.cond==Movement.COND.X&&Math.abs(c)<=a.speed||this.cond==Movement.COND.Y&&Math.abs(b)<=a.speed?!1:!0}};Movement.prototype.tick=function(a,b){this.list.forEach(function(c){c.tick(a,b)});this.isValid(a,b)||(a.routineIx++,a.routine.length<=a.routineIx&&(a.routineIx=0))};
var Product=function(){Matter.call(this);this.maxShip=7;this.maxHibernate=60;this.stageNum=this.hiscore=this.score=this.shipRemain=0;this.stage=null;this.performersList=[]};$jscomp.inherits(Product,Matter);Product.prototype.calcPan=function(a){return(a.x-this.hW)/this.hW};Product.prototype.startGame=function(){this.increase();this.loosingRate=Product.MAX_LOOSING_RATE;this.score=0;this.shipRemain=this.maxShip;this.stageNum=0;this.nextStage();this._reset()};
Product.prototype.increase=function(){(new ProductEntity).increase(this.id).then(function(a){console.log("Product#increase:"+a.ok)})};
Product.prototype.nextStage=function(){var a=this;console.log("Product#nextStage:"+this.stageNum);this.ship&&console.log("ship_"+this.ship.x+"/"+this.ship.y);var b=this.detailList[this.stageNum];this.performersList=this.performersList.filter(function(a){return!(a instanceof MapVisual)});this.performersList.forEach(function(a){a.x-=a._stage.map.x;a.y-=a._stage.map.y});this.ship&&(console.log("map:"+this.stage.map.x+"/"+this.stage.map.y),console.log("ship:"+this.ship.x+"/"+this.ship.y));this.stage=
Object.assign(b);Field.Instance.landform.loadStage(this.stage);this.stageNum++;this.detailList.length<=this.stageNum&&(this.stageNum=0);this.performersList.forEach(function(b){b.x+=a.stage.map.x;b.y+=a.stage.map.y;b._stage=a.stage});this.stage.map.mapVisualList.forEach(function(b){return a.performersList.push(b)})};Product.prototype.selectStage=function(a){var b=this;this.detailList.forEach(function(c){c.id==a&&(b.stage=StageEditor.create(c))});this.stage.map.mapVisualList.forEach(function(a){return b.performersList.push(a)})};
Product.prototype._reset=function(){var a=this;this.ship=new Ship(-400,100);this.ship._stage=this.stage;this.ship.reset();this.ship.enter();this.performersList=[this.ship];this.stage.map.mapVisualList.forEach(function(b){return a.performersList.push(b)})};Product.prototype.retry=function(){Field.Instance.landform.retry();this.stage.retry();this._reset()};
Product.prototype.move=function(){var a=this;if(this.stage&&this.stage.phase!=Stage.PHASE.BOSS){this.stage.scanEvent().forEach(function(b){return a.performersList.push(b)});var b=Field.Instance.landform.forward(this.ship);this.isGameOver||(b==Landform.NEXT.NOTICE?(AudioMixer.INSTANCE.fade(),this.stage.notice()):b==Landform.NEXT.ARRIV?this.stage.toBossMode():b==Landform.NEXT.PAST&&this.nextStage(),Product.MIN_LOOSING_RATE<this.loosingRate&&(this.loosingRate-=this.loosingRate/1E4))}};
Product.prototype.draw=function(a){var b=this;if(this.stage){var c=this.performersList.filter(function(a){return a instanceof Ship}),d=0<c.length?c[0]:new Actor,e=[],g=[],f=[],h=0;this.performersList.sort(function(a,b){return a.z-b.z});this.performersList.forEach(function(a){if(!a.isGone){a instanceof Bullet?c.forEach(function(b){return a.isHit(b)}):a instanceof Enemy?g.push(a):(a instanceof Shot||a instanceof Missile)&&e.push(a);var k=a.move(d);k instanceof Array&&k.forEach(function(a){a._stage=
b.stage;f.push(a)});b.stage.effect(a);f.push(a);a.explosion&&a.score&&(h+=a.score,a.score=0)}});this.stage.effectMap(d);g.forEach(function(a){a.triggered=0==parseInt(Math.random()*b.loosingRate/10);c.forEach(function(b){return a.isHit(b)});e.forEach(function(b){return a.isHit(b)})});this.stage.phase==Stage.PHASE.BOSS&&0==g.length&&(this.stage.phase=Stage.PHASE.NORMAL,AudioMixer.INSTANCE.fade());this.performersList=f;this.score+=h;!this.isGameOver&&c.every(function(a){return a.isGone})&&(AudioMixer.INSTANCE.stop(),
0>=--this.stage.hibernate&&0<--this.shipRemain&&this.retry());a.save();a.translate(this.stage.fg.x,this.stage.fg.y);this.performersList.forEach(function(b){return b.draw(a)});this.stage.draw(a);a.restore();this.drawForDebug(a)}};
Product.prototype.drawForDebug=function(a){var b=20,c=this.performersList.filter(function(a){return!(a instanceof MapVisual)}),d=this.stage.map._mainVisual;a.save();a.strokeStyle="white";a.strokeText("actors:"+c.length+(0<c.length?"|"+c[c.length-1].constructor.name:""),2,b+=20);a.strokeText("progress:"+parseInt(this.stage.progress)+"/"+parseInt(d.progressH),2,b+=20);a.strokeText("map:"+parseInt(d.x)+"/"+d.y,2,b+=20);this.ship&&(c=parseInt(this.ship.x),d=parseInt(this.ship.y+d.y),a.strokeText("ship:"+
c+"/"+d,2,b+=20));a.restore()};Product.prototype.registerScore=function(){var a=new FormData;a.append("productId",this.id);a.append("score",this.score);a.append("name","");(new ScoreEntity).register(a).then(function(a){console.log("registerScore:"+a.ok)})};Product.prototype.init=function(){var a=this,b=[];this.setRect(this.width,this.height);this.detailList.forEach(function(c){c.product=a;b.push(Stage.create(c))});this.detailList=b;0<this.scoreList.length&&(this.hiscore=this.scoreList[0].score);return this};
Product.create=function(a){return(new ProductEntity).select(a).then(function(a){Mediaset.create(a.mediaset).load();Product.Instance=Object.assign(new Product,a);return Product.Instance.init()})};$jscomp.global.Object.defineProperties(Product.prototype,{isGameOver:{configurable:!0,enumerable:!0,get:function(){return 0>=this.shipRemain}}});Product.Instance=null;Product.MIN_LOOSING_RATE=1;Product.MAX_LOOSING_RATE=2E4;
var Region=function(a,b,c){b=void 0===b?Region.DefaultSize:b;c=void 0===c?Region.Type.CIRCLE:c;this.matter=a;this.size=b;this.type=c;this.width=2*b};Region.prototype.isHit=function(a){if(this.type==Region.Type.CIRCLE&&a.type==Region.Type.CIRCLE){var b=this.matter.x-a.matter.x,c=this.matter.y-a.matter.y;return Math.sqrt(b*b+c*c)<this.size+a.size}console.log("*Not implement*")};
Region.prototype.draw=function(a){a.save();a.strokeStyle="rgba(80, 255, 80, 0.6)";this.type==Region.Type.RECTANGLE?a.strokeRect(-this.size,-this.size,this.width,this.width):(a.beginPath(),a.arc(0,0,this.size,0,Math.PI2,!1),a.stroke());a.restore()};Region.DefaultSize=4;Region.Type={CIRCLE:1,RECTANGLE:2};var Ship=function(a,b){Actor.call(this,a,b);this.activityAreaType=Actor.ActivityAreaType.RESTRICTION;this.effectH=!0;this.anim=new Animator("prototype.ship",Animator.TYPE.V,1,2*Ship.PATTERNS+1);this.reset()};
$jscomp.inherits(Ship,Actor);Ship.CollidingWallType=Actor.CollidingWallType;Ship.ActivityAreaType=Actor.ActivityAreaType;Ship.TypeList=Actor.TypeList;Ship.Type=Actor.Type;Ship.DEG_STEP=Actor.DEG_STEP;Ship.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Ship.prototype.recalculation=function(){var a=Product.Instance;Actor.prototype.recalculation.call(this);a&&(this.right=a.width-2*this.width,this.bottom=a.height-this.hH)};
Ship.prototype.reset=function(){this.speed=Ship.MIN_SPEED;this.triggered=!1;this.chamberList=[new Chamber(Shot,4,Ship.MAX_SHOTS)];this.chamberList.forEach(function(a){return a.reset()});this.missileLevel=0};Ship.prototype.speedup=function(){this.speed*=1.25;Ship.MAX_SPEED<this.speed&&(this.speed=Ship.MAX_SPEED)};
Ship.prototype.powerUpMissile=function(){this.missileLevel++;1==this.missileLevel?this.chamberList.push(new Chamber(Missile,16,2,{gravity:.05,dir:0})):2==this.missileLevel?this.chamberList.push(new Chamber(Missile,16,2,{gravity:-.05,dir:0})):3==this.missileLevel&&(this.chamberList.push(new Chamber(Missile,16,2,{gravity:.05,dir:Math.PI})),this.chamberList.push(new Chamber(Missile,16,2,{gravity:-.05,dir:Math.PI})))};
Ship.prototype.inkey=function(a){var b=!1,c=0;if(a.ArrowLeft||a.Left||a.k37)c=1,b=!0;else if(a.ArrowRight||a.Right||a.k39)c=-1,b=!0;if(a.ArrowUp||a.Up||a.k38)c=2-.5*c,b=!0;else if(a.ArrowDown||a.Down||a.k40)c*=.5,b=!0;b&&(this.dir=(c+1)*Math.SQ);if(a.Control||a.Shift||a.k16||a.k17)this.triggered=!0};
Ship.prototype.move=function(){this.dir=null;this.aim(Controller.Instance.point);this.inkey(Controller.Instance.keys);Controller.Instance.touch&&(this.triggered=!0);var a=Actor.prototype.move.call(this);if(!this.isGone)if(this.walled)this.fate();else return a};Ship.MIN_SPEED=1.5;Ship.MAX_SPEED=5;Ship.MAX_SHOTS=7;Ship.PATTERNS=2;
var Shot=function(a,b){Actor.call(this,a,b);this.dir=0;this.radius=2;this.speed=6;this.size=2;this.activityAreaType=Actor.ActivityAreaType.EJECT;this.collidingWallType=Actor.CollidingWallType.SMASH_CRUSH;this.fillStyle="rgba(255, 255, 0, 0.7)";a=Product.Instance.calcPan(this);AudioMixer.INSTANCE.play("sfx-fire",.4,!1,a)};$jscomp.inherits(Shot,Actor);Shot.CollidingWallType=Actor.CollidingWallType;Shot.ActivityAreaType=Actor.ActivityAreaType;Shot.TypeList=Actor.TypeList;Shot.Type=Actor.Type;
Shot.DEG_STEP=Actor.DEG_STEP;Shot.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Shot.prototype.fate=function(){this.eject()};var Stage=function(){this.boss=this.bgm=this.foreground=null;this.checkPoint=Stage.CHECK_POINT[0];this.viewDic={};this.progress=this.effectV=this.effectH=0;this.eventList=[];this.lastScan=null};Stage.prototype.setBgm=function(a,b){this.bgm=a;this.boss=void 0===b?null:b;return this};Stage.prototype.playBgm=function(){this.bgm&&AudioMixer.INSTANCE.play(this.bgm,.7,!0)};
Stage.prototype.getGround=function(a){return this.viewDic[a]};Stage.prototype.reset=function(){this.checkPoint=Stage.CHECK_POINT[0];this.retry()};
Stage.prototype.retry=function(){var a=this;this.phase=Stage.PHASE.NORMAL;this.progress=-this.product.width/this.map._mainVisual.speed;this.hibernate=this.product.maxHibernate;this.scroll=this.scrollSv;this.effectV=this.effectH=0;this.map.reset();this.map.setProgress(this.progress);this.view.forEach(function(b){b.reset(a.checkPoint)});this.eventList=this.scenarioList.concat();this.playBgm()};
Stage.prototype.scrollV=function(a){this.effectV=0;if(this.scroll!=Stage.SCROLL.OFF){var b=this.product.hH-a.y;a=this.fg;if(this.scroll==Stage.SCROLL.TOP)b=5*a.speed;else if(this.scroll==Stage.SCROLL.BOTTOM)b=5*-a.speed;else if(Math.abs(b)<a.speed)return;b/=3;var c=a.y-b,d=a.image.height-this.product.height;if(this.scroll!=Stage.SCROLL.ON||!(0>c||d<c))if(this.scroll==Stage.SCROLL.TOP&&0>c)this.scroll=Stage.SCROLL.OFF;else{if(this.scroll==Stage.SCROLL.BOTTOM&&(console.log("nextY:"+c+"/"+a.image.height),
d<c)){this.scroll=Stage.SCROLL.OFF;return}this.effectV=b}}};Stage.prototype.effect=function(a){var b=this.map._mainVisual;if(!(a instanceof MapVisual)&&this.isMoving){if(this.isLoop){var c=b.y+a.y;0>c&&(a.y+=this.height);this.height<c&&(a.y-=this.height)}a.effectH&&(a.x-=Math.cos(b.radian)*b.speed);a.effectV&&(a.y-=Math.sin(b.radian)*b.speed);this.map.checkHit(a)}};
Stage.prototype.effectMap=function(a){var b=this.map._mainVisual,c=b.image.height;b=(a.y+b.y+c)%c;c=this.product.hH/2;var d=this.product.height-c;this.scroll&(Stage.SCROLL.ON|Stage.SCROLL.LOOP)&&(b<c&&this.map.addProgressH(a.speed)&&(a.y+=a.speed),d<b&&this.map.addProgressH(-a.speed)&&(a.y-=a.speed))};
Stage.prototype.scanEvent=function(){var a=this,b=[],c=-this.fg.x,d=Math.round(c/this.map.brickSize);if(d==this.lastScan)return b;var e=Math.round((c+this.product.width)/this.map.brickSize),g=[];this.eventList.forEach(function(f){var h=!1,k="spawn"==f.op;if(k){if(f.v<e)return;f.v==e&&(h=!0)}else if("reverse"==f.op){if(f.v<d)return;f.v==d&&(h=!0)}h?(f=Enemy.assign(f.number,c+(k?a.product.width+1.5*a.map.brickSize:0),(f.h+1)*a.map.brickSize),null!=f&&(f=f.formation?(new Formation(f.x,f.y)).setup(f.type,
8):new f.type(f.x,f.y),f._stage=a,b.push(f))):g.push(f)});this.eventList=g;this.lastScan=d;return b};Stage.prototype.forward=function(){var a=this;this.map.setProgress(this.progress++);var b=this.fg.x;Stage.CHECK_POINT.forEach(function(c){c.x<=b&&a.checkPoint.x<b&&(a.checkPoint=c)})};Stage.prototype.notice=function(){if(this.scroll==Stage.SCROLL.ON||this.scroll==Stage.SCROLL.LOOP){var a=this.fg;this.scroll=a.y<a.image.height/2?Stage.SCROLL.TOP:Stage.SCROLL.BOTTOM}};
Stage.prototype.toBossMode=function(){this.phase=Stage.PHASE.BOSS;this.boss&&AudioMixer.INSTANCE.play(this.boss,.7,!0)};Stage.prototype.draw=function(a){};Stage.createViewList=function(a){var b=[];Stage.VIEWS.forEach(function(c){var d=a[c];if(d&&0!=d.length){var e=a[c+"speed"],g=a[c+"dir"],f=a[c+"blink"];d=c.startsWith("b")?new StageBg(d,e,g,f):new StageFg(d,e,g,f);d.viewId=c;b.push(d)}});return b};
Stage.prototype.init=function(){var a=this;this.map=FieldMap.create(this.map);this.map._stage=this;this.view=[];this.view.forEach(function(b){b.stage=a;a.viewDic[b.viewId]=b});this.scrollSv=this.scroll=this.roll;this.setBgm(this.map.theme,this.map.boss);return this};Stage.create=function(a){return Object.assign(new Stage,a).init()};
$jscomp.global.Object.defineProperties(Stage.prototype,{isMoving:{configurable:!0,enumerable:!0,get:function(){return this.phase==Stage.PHASE.NORMAL}},fg:{configurable:!0,enumerable:!0,get:function(){this.foreground||(this.foreground=this.map._mainVisual);return this.foreground}},width:{configurable:!0,enumerable:!0,get:function(){return this.map._mainVisual.image.width}},height:{configurable:!0,enumerable:!0,get:function(){return this.map._mainVisual.image.height}},isLoop:{configurable:!0,enumerable:!0,
get:function(){return this.scroll==Stage.SCROLL.LOOP}}});Stage.SCROLL={OFF:0,ON:1,LOOP:2,TOP:4,BOTTOM:8};Stage.PHASE={NORMAL:0,BOSS:1};Stage.VIEWS="bg1 bg2 bg3 fg1 fg2 fg3".split(" ");Stage.CHECK_POINT=[{x:0,y:0},{x:660,y:0},{x:1440,y:0}];var StageView=function(a,b,c,d){this.imageId=a;this.speed=b;this.dir=c;this.blink=d;this.pattern=null;this.repeatY=this.repeatX=2};
StageView.prototype.reset=function(a){if(!this.width){var b=this.img;this.width=b.width;this.height=b.height;this.w2=b.width*this.repeatX;this.h2=b.height*this.repeatY}this.x=a.x%this.width;this.effectV=this.effectH=this.y=0;this.alpha=1;this.blinkDir=-1};
StageView.prototype.forward=function(){var a=this.stage.effectV;this.effectH=Math.cos(this.dir)*this.speed;this.effectV=Math.sin(this.dir)*this.speed;this.x+=this.effectH;this.y+=this.effectV;this.y-=a*this.speed;this.width<this.x&&(this.x-=this.width);0>this.y&&(this.y+=this.height);this.height<this.y&&(this.y-=this.height)};StageView.prototype.getPattern=function(a){this.pattern||(this.pattern=a.createPattern(this.img,"repeat"));return this.pattern};
StageView.prototype.draw=function(a){this.blink&&(this.alpha+=this.blinkDir*this.blink,.3>=this.alpha||1<=this.alpha)&&(this.blinkDir*=-1);a.save();a.globalAlpha=this.alpha;a.translate(-this.x,-this.y);a.beginPath();a.fillStyle=this.getPattern(a);a.rect(0,0,this.w2,this.h2);a.fill();a.restore()};$jscomp.global.Object.defineProperties(StageView.prototype,{img:{configurable:!0,enumerable:!0,get:function(){return VisualManager.Instance.dic[this.imageId]}}});
var StageFg=function(a,b,c,d){StageView.call(this,a,void 0===b?.5:b,void 0===c?0:c,void 0===d?0:d);this.repeatX=1};$jscomp.inherits(StageFg,StageView);StageFg.prototype.createCanvas=function(){var a=document.createElement("canvas"),b=a.getContext("2d");a.width=this.width;a.height=this.height;b.clearRect(0,0,this.width,this.height);b.drawImage(this.img,0,0);return a};
StageFg.prototype.reset=function(a){StageView.prototype.reset.call(this,a);0==a.x&&(this.x=-this.product.width);this.canvas=this.createCanvas();this.pattern=canvas.getContext("2d").createPattern(this.canvas,"repeat")};var StageBg=function(a,b,c,d){StageView.call(this,a,void 0===b?.5:b,void 0===c?0:c,void 0===d?0:d)};$jscomp.inherits(StageBg,StageView);var VisualManager=function(){Repository.call(this)};$jscomp.inherits(VisualManager,Repository);
VisualManager.prototype.makeName=function(a){return"/visual/src/"+a};VisualManager.prototype.load=function(a,b,c){var d=this;if(c.startsWith("image")){var e=new Image;this.max++;e.onload=function(){d.onload(a,b,e)};e.src=this.makeName(a)}else Repository.prototype.load.call(this,a,b,c)};VisualManager.Instance=new VisualManager;var EntityBase=function(a){this.base=a};EntityBase.prototype.list=function(a){a=void 0===a?{}:a;return AjaxUtils.post("/"+this.base+"/list",a)};
EntityBase.prototype.select=function(a){var b=new FormData;b.append("id",a);return AjaxUtils.post("/"+this.base+"/select",b)};EntityBase.prototype.save=function(a){var b=[];return fetch("/"+this.base+"/save",{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify(a,function(a,d){if(!a.startsWith("_")){if(null!=d&&"object"==typeof d){if(0<=b.indexOf(d))return;b.push(d)}return d}}),credentials:"include"}).then(function(a){return a.json()})};
EntityBase.prototype.saveResource=function(a){return fetch("/"+this.base+"/save",{method:"post",body:a,credentials:"include"}).then(function(a){return a.json()})};var ActorEntity=function(){EntityBase.call(this,"actor")};$jscomp.inherits(ActorEntity,EntityBase);var AudioEntity=function(){EntityBase.call(this,"audio")};$jscomp.inherits(AudioEntity,EntityBase);AudioEntity.Type={OTHER:0,FX:1,BGM:2};var AudioSetEntity=function(){EntityBase.call(this,"audioSet")};$jscomp.inherits(AudioSetEntity,EntityBase);
var MapEntity=function(){EntityBase.call(this,"map")};$jscomp.inherits(MapEntity,EntityBase);var MediasetEntity=function(){EntityBase.call(this,"mediaset")};$jscomp.inherits(MediasetEntity,EntityBase);var ProductEntity=function(){EntityBase.call(this,"product")};$jscomp.inherits(ProductEntity,EntityBase);ProductEntity.prototype.listActors=function(a){var b=new FormData;b.append("id",a);return AjaxUtils.post("/product/listActors",b)};
ProductEntity.prototype.saveMap=function(a){return AjaxUtils.post("/detail/save",a)};ProductEntity.prototype.increase=function(a){var b=new FormData;b.append("id",a);return AjaxUtils.post("/product/increase",b)};var ScoreEntity=function(){EntityBase.call(this,"score")};$jscomp.inherits(ScoreEntity,EntityBase);ScoreEntity.prototype.register=function(a){return AjaxUtils.post("/score/register",a)};var VisualEntity=function(){EntityBase.call(this,"visual")};$jscomp.inherits(VisualEntity,EntityBase);
VisualEntity.Type={OTHER:0,ACT:1,BACK:2,FORE:3};var Battery=function(a,b){Enemy.call(this,a,b);this.speed=0;this.hitPoint=1;this.score=10;this.anim=[new Animator("enemy.battery"),new Animator("enemy.batteryBase",Animator.TYPE.NONE)];this.routine=[(new Movement).add(Gizmo.TYPE.AIM,Gizmo.DEST.ROTATE).add(Gizmo.TYPE.FIXED,Gizmo.DEST.TO)];this.activityAreaType=Actor.ActivityAreaType.EJECT;this.checkInverse()};$jscomp.inherits(Battery,Enemy);Battery.CollidingWallType=Enemy.CollidingWallType;
Battery.ActivityAreaType=Enemy.ActivityAreaType;Battery.TypeList=Enemy.TypeList;Battery.Type=Enemy.Type;Battery.DEG_STEP=Enemy.DEG_STEP;Battery.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Battery.LIST=Enemy.LIST;Battery.MAX_TYPE=Enemy.MAX_TYPE;Battery.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Battery.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Battery.assign=Enemy.assign;
Battery.prototype.drawNormal=function(a){this.isInverse?this.radian<-Math.SQ?this.radian=Math.PI:0>this.radian&&(this.radian=0):Math.SQ<this.radian?this.radian=Math.PI:0<this.radian&&(this.radian=0);Enemy.prototype.drawNormal.call(this,a)};var Bouncer=function(a,b){Enemy.call(this,a,b);this.dir=0>=this.x?0:Math.PI;this.speed=2;this.gravity=.1;this.reaction=.95;this.hitPoint=3;this.score=500;this.shuttle=2;this.anim=new Animator("enemy.bouncer",Animator.TYPE.NONE)};$jscomp.inherits(Bouncer,Enemy);
Bouncer.CollidingWallType=Enemy.CollidingWallType;Bouncer.ActivityAreaType=Enemy.ActivityAreaType;Bouncer.TypeList=Enemy.TypeList;Bouncer.Type=Enemy.Type;Bouncer.DEG_STEP=Enemy.DEG_STEP;Bouncer.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Bouncer.LIST=Enemy.LIST;Bouncer.MAX_TYPE=Enemy.MAX_TYPE;Bouncer.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Bouncer.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Bouncer.assign=Enemy.assign;
Bouncer.prototype.move=function(a){a=Enemy.prototype.move.call(this,a);var b=this.x-this._stage.map.x;this.shuttle&&(0>b||Product.Instance.width+this.width<b)&&(this.dir=Math.trim(this.dir+Math.PI),this.x=this.svX,this.shuttle--);this.walled&&(this.x=this.svX,this.y=this.svY);return a};
var Charger=function(a,b){Enemy.call(this,a,b);this.speed=2.5;this.hitPoint=1;this.score=10;this.activityAreaType=Actor.ActivityAreaType.EJECT;this.anim=new Animator("enemy.charger");this.routine=[(new Movement(Movement.COND.Y)).add(Gizmo.TYPE.AIM,Gizmo.DEST.TO_Y).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO_Y),(new Movement(10)).add(Gizmo.TYPE.AIM,Gizmo.DEST.TO_X).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO_X),(new Movement(1E3)).add(Gizmo.TYPE.OWN,Gizmo.DEST.TO)]};$jscomp.inherits(Charger,Enemy);
Charger.CollidingWallType=Enemy.CollidingWallType;Charger.ActivityAreaType=Enemy.ActivityAreaType;Charger.TypeList=Enemy.TypeList;Charger.Type=Enemy.Type;Charger.DEG_STEP=Enemy.DEG_STEP;Charger.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Charger.LIST=Enemy.LIST;Charger.MAX_TYPE=Enemy.MAX_TYPE;Charger.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Charger.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Charger.assign=Enemy.assign;
var Crab=function(a,b){Enemy.call(this,a,b);this.hasBounds=!1;this.gravity=.3;this.reaction=.4;this.speed=2;this.hitPoint=1;this.score=90;this.anim=new Animator("enemy.crab",Animator.TYPE.X|Animator.TYPE.ROTATION,8,1);this.routine=[(new Movement(Movement.COND.X)).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO_X),(new Movement(Crab.WALK)).add(Gizmo.TYPE.OWN,Gizmo.DEST.RIGHT),(new Movement(Movement.COND.X)).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO_X),(new Movement(Crab.WALK)).add(Gizmo.TYPE.CHASE,Gizmo.DEST.LEFT)]};
$jscomp.inherits(Crab,Enemy);Crab.CollidingWallType=Enemy.CollidingWallType;Crab.ActivityAreaType=Enemy.ActivityAreaType;Crab.TypeList=Enemy.TypeList;Crab.Type=Enemy.Type;Crab.DEG_STEP=Enemy.DEG_STEP;Crab.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Crab.LIST=Enemy.LIST;Crab.MAX_TYPE=Enemy.MAX_TYPE;Crab.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Crab.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Crab.assign=Enemy.assign;Crab.WALK=20;
var DragonBody=function(a,b){Enemy.call(this,a,b);this.region=new Region(this,16);this.hasBounds=!1;this.hitPoint=Number.MAX_SAFE_INTEGER;this.score=0;this.anim=new Animator("enemy.dragonBody")};$jscomp.inherits(DragonBody,Enemy);DragonBody.CollidingWallType=Enemy.CollidingWallType;DragonBody.ActivityAreaType=Enemy.ActivityAreaType;DragonBody.TypeList=Enemy.TypeList;DragonBody.Type=Enemy.Type;DragonBody.DEG_STEP=Enemy.DEG_STEP;DragonBody.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;DragonBody.LIST=Enemy.LIST;
DragonBody.MAX_TYPE=Enemy.MAX_TYPE;DragonBody.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;DragonBody.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;DragonBody.assign=Enemy.assign;$jscomp.global.Object.defineProperties(DragonBody.prototype,{triggered:{configurable:!0,enumerable:!0,get:function(){return!1}}});
var DragonHead=function(a,b){Enemy.call(this,a,b);this.region=new Region(this,16);this.x=0<this.x?this.x+50:this.x-50;this.hasBounds=!1;this.speed=.9;this.hitPoint=200;this.score=1E4;this.radian=Math.PI;this.appears=!1;this.anim=new Animator("enemy.dragonHead");this.locus=[];this.body=[];for(a=0;a<DragonHead.CNT_OF_BODY*DragonHead.STP_OF_BODY;a++)this.locus.push({x:this.x,y:this.y,radian:this.radian}),0==a%DragonHead.STP_OF_BODY&&(b=new DragonBody(this.x,this.y),this.body.push(b));this.chamberList=
[new Chamber(TitanShot,80,1)]};$jscomp.inherits(DragonHead,Enemy);DragonHead.CollidingWallType=Enemy.CollidingWallType;DragonHead.ActivityAreaType=Enemy.ActivityAreaType;DragonHead.TypeList=Enemy.TypeList;DragonHead.Type=Enemy.Type;DragonHead.DEG_STEP=Enemy.DEG_STEP;DragonHead.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;DragonHead.LIST=Enemy.LIST;DragonHead.MAX_TYPE=Enemy.MAX_TYPE;DragonHead.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;DragonHead.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;DragonHead.assign=Enemy.assign;
DragonHead.prototype.eject=function(){Enemy.prototype.eject.call(this);this.body.forEach(function(a){a.hitPoint=0;a.explosion=Actor.MAX_EXPLOSION})};
DragonHead.prototype.move=function(a){var b=this,c=Math.trim(this.radian+.9*this.closeGap(a));this.radian=this.dir=c;Enemy.prototype.move.call(this,a);this.chamberList.forEach(function(a){a.probe()});for(a=0;a<DragonHead.CNT_OF_BODY;a++){c=this.body[a];var d=this.locus[(a+1)*DragonHead.STP_OF_BODY-1];c.x=d.x;c.y=d.y;c.radian=d.radian}this.locus.unshift({x:this.x,y:this.y,radian:this.radian});this.locus.pop();if(this.appears){var e=[];this.chamberList.forEach(function(a){if(a=a.fire(b))a.dir=b.dir,
a.radian=b.dir,e.push(a)});return e}this.appears=!0;return this.body};DragonHead.CNT_OF_BODY=10;DragonHead.STP_OF_BODY=32;var Hanker=function(a,b){Enemy.call(this,a,b);this.speed=.7;this.hitPoint=2;this.score=50;this.anim=new Animator("enemy.hanker");this.routine=[(new Movement).add(Gizmo.TYPE.AIM,Gizmo.DEST.ROTATE).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO)]};$jscomp.inherits(Hanker,Enemy);Hanker.CollidingWallType=Enemy.CollidingWallType;Hanker.ActivityAreaType=Enemy.ActivityAreaType;Hanker.TypeList=Enemy.TypeList;
Hanker.Type=Enemy.Type;Hanker.DEG_STEP=Enemy.DEG_STEP;Hanker.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Hanker.LIST=Enemy.LIST;Hanker.MAX_TYPE=Enemy.MAX_TYPE;Hanker.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Hanker.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Hanker.assign=Enemy.assign;
var Hatch=function(a,b){Enemy.call(this,a,b);this.region=new Region(this,12);this.speed=0;this.hitPoint=10;this.score=200;this.children=this.count=0;this.activityAreaType=Actor.ActivityAreaType.EJECT;this.anim=new Animator("enemy.hatch",Animator.TYPE.Y,1,2);this.checkInverse()};$jscomp.inherits(Hatch,Enemy);Hatch.CollidingWallType=Enemy.CollidingWallType;Hatch.ActivityAreaType=Enemy.ActivityAreaType;Hatch.TypeList=Enemy.TypeList;Hatch.Type=Enemy.Type;Hatch.DEG_STEP=Enemy.DEG_STEP;
Hatch.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Hatch.LIST=Enemy.LIST;Hatch.MAX_TYPE=Enemy.MAX_TYPE;Hatch.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Hatch.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Hatch.assign=Enemy.assign;Hatch.prototype.move=function(a){Enemy.prototype.move.call(this,a);if(!(this.count++<Hatch.IDLE||0!=this.count%Hatch.INTERVAL||Hatch.CHILDREN<=this.children++||0<this.explosion))return[new Charger(this.x,this.y)]};Hatch.IDLE=80;Hatch.INTERVAL=12;Hatch.CHILDREN=20;
var Jerky=function(a,b){Enemy.call(this,a,b);this.hitPoint=this.speed=1;this.score=10;this.anim=new Animator("enemy.jerky");this.routine=[(new Movement(Movement.COND.X)).add(Gizmo.TYPE.AIM,Gizmo.DEST.TO_X).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO_X),(new Movement(Movement.COND.Y)).add(Gizmo.TYPE.AIM,Gizmo.DEST.TO_Y).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO_Y)]};$jscomp.inherits(Jerky,Enemy);Jerky.CollidingWallType=Enemy.CollidingWallType;Jerky.ActivityAreaType=Enemy.ActivityAreaType;Jerky.TypeList=Enemy.TypeList;
Jerky.Type=Enemy.Type;Jerky.DEG_STEP=Enemy.DEG_STEP;Jerky.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Jerky.LIST=Enemy.LIST;Jerky.MAX_TYPE=Enemy.MAX_TYPE;Jerky.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Jerky.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Jerky.assign=Enemy.assign;
var Juno=function(a,b){Enemy.call(this,a,b);this.hasBounds=!1;this.dir=Math.PI;this.speed=1;this.hitPoint=16;this.score=7500;this.anim=new Animator("enemy.juno");this.routine=[(new Movement(200)).add(Gizmo.TYPE.FIXED,Gizmo.DEST.TO),(new Movement(Number.MAX_VALUE)).add(Gizmo.TYPE.CHASE,Gizmo.DEST.ROTATE)]};$jscomp.inherits(Juno,Enemy);Juno.CollidingWallType=Enemy.CollidingWallType;Juno.ActivityAreaType=Enemy.ActivityAreaType;Juno.TypeList=Enemy.TypeList;Juno.Type=Enemy.Type;Juno.DEG_STEP=Enemy.DEG_STEP;
Juno.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Juno.LIST=Enemy.LIST;Juno.MAX_TYPE=Enemy.MAX_TYPE;Juno.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Juno.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Juno.assign=Enemy.assign;
var Slur=function(a,b){Enemy.call(this,a,b);this.hasBounds=!1;this.dir=0>=this.x?0:Math.PI;this.step=Math.PI/8;this.speed=2;this.hitPoint=3;this.score=300;this.anim=new Animator("enemy.slur");this.routine=[(new Movement(Slur.RANGE)).add(Gizmo.TYPE.OWN,Gizmo.DEST.ROTATE_L).add(Gizmo.TYPE.FIXED,Gizmo.DEST.ROTATE),(new Movement(4*Slur.RANGE)).add(Gizmo.TYPE.CHASE,Gizmo.DEST.ROTATE),(new Movement(Slur.RANGE)).add(Gizmo.TYPE.OWN,Gizmo.DEST.ROTATE_R).add(Gizmo.TYPE.FIXED,Gizmo.DEST.ROTATE),(new Movement(4*
Slur.RANGE)).add(Gizmo.TYPE.CHASE,Gizmo.DEST.ROTATE)]};$jscomp.inherits(Slur,Enemy);Slur.CollidingWallType=Enemy.CollidingWallType;Slur.ActivityAreaType=Enemy.ActivityAreaType;Slur.TypeList=Enemy.TypeList;Slur.Type=Enemy.Type;Slur.DEG_STEP=Enemy.DEG_STEP;Slur.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Slur.LIST=Enemy.LIST;Slur.MAX_TYPE=Enemy.MAX_TYPE;Slur.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Slur.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Slur.assign=Enemy.assign;Slur.RANGE=4;
var Tentacle=function(a,b){Chain.call(this,a,b);this.hasBounds=!1;this.speed=.1;this.hitPoint=16;this.appears=!1;this.anim=new Animator("enemy.tentacle");this.routine=[(new Movement).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO).add(Gizmo.TYPE.AIM,Gizmo.DEST.ROTATE,Tentacle.DEG_STEP)];this.push(new TentacleHead(0));for(a=0;a<Tentacle.MAX_JOINT;a++)b=Tentacle.MAX_JOINT-a,this.push(new TentacleJoint(b*b));this.score=150};$jscomp.inherits(Tentacle,Chain);Tentacle.CollidingWallType=Chain.CollidingWallType;
Tentacle.ActivityAreaType=Chain.ActivityAreaType;Tentacle.TypeList=Chain.TypeList;Tentacle.Type=Chain.Type;Tentacle.MAX_EXPLOSION=Chain.MAX_EXPLOSION;Tentacle.LIST=Chain.LIST;Tentacle.MAX_TYPE=Chain.MAX_TYPE;Tentacle.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;Tentacle.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;Tentacle.assign=Chain.assign;Tentacle.prototype.eject=function(){for(var a=this.next;a;)a.eject(),a=a.next;this.isGone=!0;this.x=-this.width};Tentacle.prototype.calcRadian=function(){return this.radian};
Tentacle.prototype.calcRelative=function(){return this.radian};Tentacle.prototype.move=function(a){this.radius=this.hitPoint/2+8;this.scale=this.radius/Tentacle.MAX_RADIUS;this.region=new Region(this,this.radius);Chain.prototype.move.call(this,a);if(!this.appears){this.appears=!0;a=[];for(var b=this.next;b;)a.push(b),b=b.next;return a}};Tentacle.MAX_JOINT=8;Tentacle.MAX_RADIUS=16;Tentacle.DEG_STEP=Math.PI/900;
var TentacleJoint=function(a){Chain.call(this,0,0);this.hasBounds=!1;this.radius=4;this.radian=0;this.speed=a;this.anim=new Animator("enemy.tentacleJoint")};$jscomp.inherits(TentacleJoint,Chain);TentacleJoint.CollidingWallType=Chain.CollidingWallType;TentacleJoint.ActivityAreaType=Chain.ActivityAreaType;TentacleJoint.TypeList=Chain.TypeList;TentacleJoint.Type=Chain.Type;TentacleJoint.MAX_EXPLOSION=Chain.MAX_EXPLOSION;TentacleJoint.LIST=Chain.LIST;TentacleJoint.MAX_TYPE=Chain.MAX_TYPE;
TentacleJoint.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;TentacleJoint.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;TentacleJoint.assign=Chain.assign;TentacleJoint.prototype.calcRadian=function(){return Math.trim(this.prev.calcRadian()+this.radian)};TentacleJoint.prototype.calcRelative=function(){return Math.trim(this.radian-this.prev.calcRadian())};
TentacleJoint.prototype.rotate=function(a){var b=this.calcRadian();this.radian=Math.close(b,Math.atan2(a.y-this.y,a.x-this.x),TentacleJoint.DEG_STEP*this.speed);this.radian=this.calcRelative();this.radian<-TentacleJoint.MAX_RAD&&(this.radian=-TentacleJoint.MAX_RAD);TentacleJoint.MAX_RAD<this.radian&&(this.radian=TentacleJoint.MAX_RAD)};TentacleJoint.prototype.move=function(a){var b=this.prev,c=b.calcRadian(),d=b.radius+this.radius;this.x=b.x+Math.cos(c)*d;this.y=b.y+Math.sin(c)*d;return this.rotate(a)};
TentacleJoint.prototype.fate=function(){};TentacleJoint.DEG_STEP=Math.PI/18E3;TentacleJoint.MAX_RAD=Math.PI/6;var TentacleBullet=function(a,b){Bullet.call(this,a,b);this.region=new Region(this,1);this.radius=2;this.speed=.5;this.anim=[];this.fillStyle="rgba(255, 200, 200, 0.7)"};$jscomp.inherits(TentacleBullet,Bullet);TentacleBullet.CollidingWallType=Bullet.CollidingWallType;TentacleBullet.ActivityAreaType=Bullet.ActivityAreaType;TentacleBullet.TypeList=Bullet.TypeList;TentacleBullet.Type=Bullet.Type;
TentacleBullet.DEG_STEP=Bullet.DEG_STEP;TentacleBullet.MAX_EXPLOSION=Bullet.MAX_EXPLOSION;TentacleBullet.RAD_STEP=Bullet.RAD_STEP;var TentacleHead=function(a){TentacleJoint.call(this,a);this.anim=new Animator("enemy.tentacleHead");this.chamberList=[new Chamber(TentacleBullet,TentacleHead.TRIGGER_CYCLE)]};$jscomp.inherits(TentacleHead,TentacleJoint);TentacleHead.CollidingWallType=TentacleJoint.CollidingWallType;TentacleHead.ActivityAreaType=TentacleJoint.ActivityAreaType;TentacleHead.TypeList=TentacleJoint.TypeList;
TentacleHead.Type=TentacleJoint.Type;TentacleHead.MAX_EXPLOSION=TentacleJoint.MAX_EXPLOSION;TentacleHead.LIST=TentacleJoint.LIST;TentacleHead.MAX_TYPE=TentacleJoint.MAX_TYPE;TentacleHead.TRIGGER_ALLOWANCE=TentacleJoint.TRIGGER_ALLOWANCE;TentacleHead.assign=TentacleJoint.assign;TentacleHead.MAX_RAD=TentacleJoint.MAX_RAD;TentacleHead.prototype.rotate=function(a){this.radian=Math.close(this.radian,Math.atan2(a.y-this.y,a.x-this.x),TentacleHead.DEG_STEP);return this.trigger(a,!0)};
TentacleHead.TRIGGER_CYCLE=120;TentacleHead.DEG_STEP=Math.PI/100;
var Twister=function(a,b){Enemy.call(this,a,b);this.hasBounds=!1;this.dir=0>=this.x?0:Math.PI;this.step=Math.PI/23;this.speed=3;this.score=100;this.activityAreaType=Actor.ActivityAreaType.EJECT;this.anim=new Animator("enemy.twister");this.routine=[(new Movement(Twister.RANGE)).add(Gizmo.TYPE.OWN,Gizmo.DEST.ROTATE_L).add(Gizmo.TYPE.FIXED,Gizmo.DEST.ROTATE),(new Movement(Twister.RANGE)).add(Gizmo.TYPE.OWN,Gizmo.DEST.ROTATE_R).add(Gizmo.TYPE.FIXED,Gizmo.DEST.ROTATE),(new Movement(Twister.RANGE)).add(Gizmo.TYPE.OWN,
Gizmo.DEST.ROTATE_R).add(Gizmo.TYPE.FIXED,Gizmo.DEST.ROTATE),(new Movement(Twister.RANGE)).add(Gizmo.TYPE.OWN,Gizmo.DEST.ROTATE_L).add(Gizmo.TYPE.FIXED,Gizmo.DEST.ROTATE)]};$jscomp.inherits(Twister,Enemy);Twister.CollidingWallType=Enemy.CollidingWallType;Twister.ActivityAreaType=Enemy.ActivityAreaType;Twister.TypeList=Enemy.TypeList;Twister.Type=Enemy.Type;Twister.DEG_STEP=Enemy.DEG_STEP;Twister.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Twister.LIST=Enemy.LIST;Twister.MAX_TYPE=Enemy.MAX_TYPE;
Twister.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Twister.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Twister.assign=Enemy.assign;Twister.RANGE=13;
var Waver=function(a,b){Enemy.call(this,a,b);this.dir=0>=this.x?0:Math.PI;this.step=Math.PI/60;this.speed=2.5;this.score=100;this.activityAreaType=Actor.ActivityAreaType.EJECT;this.anim=new Animator("enemy.waver",Animator.TYPE.Y,1,8);this.routine=[(new Movement(Waver.RANGE)).add(Gizmo.TYPE.OWN,Gizmo.DEST.ROTATE_L),(new Movement(Waver.RANGE)).add(Gizmo.TYPE.OWN,Gizmo.DEST.ROTATE_R),(new Movement(Waver.RANGE)).add(Gizmo.TYPE.OWN,Gizmo.DEST.ROTATE_R),(new Movement(Waver.RANGE)).add(Gizmo.TYPE.OWN,Gizmo.DEST.ROTATE_L)]};
$jscomp.inherits(Waver,Enemy);Waver.CollidingWallType=Enemy.CollidingWallType;Waver.ActivityAreaType=Enemy.ActivityAreaType;Waver.TypeList=Enemy.TypeList;Waver.Type=Enemy.Type;Waver.DEG_STEP=Enemy.DEG_STEP;Waver.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Waver.LIST=Enemy.LIST;Waver.MAX_TYPE=Enemy.MAX_TYPE;Waver.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Waver.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Waver.assign=Enemy.assign;Waver.RANGE=18;
var MissileCapsule=function(a){Capsule.call(this,a);this.anim=new Animator("capsule.missileCapsule",Animator.TYPE.Y)};$jscomp.inherits(MissileCapsule,Capsule);MissileCapsule.CollidingWallType=Capsule.CollidingWallType;MissileCapsule.ActivityAreaType=Capsule.ActivityAreaType;MissileCapsule.TypeList=Capsule.TypeList;MissileCapsule.Type=Capsule.Type;MissileCapsule.DEG_STEP=Capsule.DEG_STEP;MissileCapsule.MAX_EXPLOSION=Capsule.MAX_EXPLOSION;MissileCapsule.RANGE=Capsule.RANGE;
MissileCapsule.prototype.fate=function(a){a.powerUpMissile();this.eject()};var SpeedupCapsule=function(a){Capsule.call(this,a);this.anim=new Animator("capsule.speedupCapsule",Animator.TYPE.Y)};$jscomp.inherits(SpeedupCapsule,Capsule);SpeedupCapsule.CollidingWallType=Capsule.CollidingWallType;SpeedupCapsule.ActivityAreaType=Capsule.ActivityAreaType;SpeedupCapsule.TypeList=Capsule.TypeList;SpeedupCapsule.Type=Capsule.Type;SpeedupCapsule.DEG_STEP=Capsule.DEG_STEP;SpeedupCapsule.MAX_EXPLOSION=Capsule.MAX_EXPLOSION;
SpeedupCapsule.RANGE=Capsule.RANGE;SpeedupCapsule.prototype.fate=function(a){a.speedup();this.eject()};var Molten=function(a,b){Enemy.call(this,a,b);this.region=new Region(this,14);this.hasBounds=!1;this.dir=0;this.speed=.4;this.hitPoint=Number.MAX_SAFE_INTEGER;this.cycle=0;this.phase=Molten.PHASE.TARGET;this.rock=[];this.appears=!1;this.anim=new Animator("boss.molten");this.routine=[(new Movement).add(Gizmo.TYPE.CHASE,Gizmo.DEST.ROTATE)]};$jscomp.inherits(Molten,Enemy);Molten.CollidingWallType=Enemy.CollidingWallType;
Molten.ActivityAreaType=Enemy.ActivityAreaType;Molten.TypeList=Enemy.TypeList;Molten.Type=Enemy.Type;Molten.DEG_STEP=Enemy.DEG_STEP;Molten.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Molten.LIST=Enemy.LIST;Molten.MAX_TYPE=Enemy.MAX_TYPE;Molten.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Molten.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Molten.assign=Enemy.assign;
Molten.prototype.move=function(a){Enemy.prototype.move.call(this,a);Molten.MAX_CYCLE<this.cycle++&&(this.cycle=0,this.phase++,this.phase%=Molten.PHASE.length);if(this.appears)return this.checkDestroy(a),[];this.appears=!0;a=new MoltenRock(this,this.x,this.y);this.rock=[a];return[a]};Molten.prototype.checkDestroy=function(a){var b=[];this.rock.forEach(function(a){a.isGone||b.push(a)});0==b.length&&(this.hitPoint=0,this.fate(a));this.rock=b};Molten.MAX_CYCLE=700;Molten.PHASE={OWN:0,TARGET:1,length:2};
var MoltenRock=function(a,b,c){Enemy.call(this,b,c);this.hasBounds=!1;this.parent=a;this.dir=0;this.speed=.6;this.hitPoint=5;this.score=10;this.anim=new Animator("boss.moltenRock");this.routine=[(new Movement).add(Gizmo.TYPE.CHASE,Gizmo.DEST.ROTATE)]};$jscomp.inherits(MoltenRock,Enemy);MoltenRock.CollidingWallType=Enemy.CollidingWallType;MoltenRock.ActivityAreaType=Enemy.ActivityAreaType;MoltenRock.TypeList=Enemy.TypeList;MoltenRock.Type=Enemy.Type;MoltenRock.DEG_STEP=Enemy.DEG_STEP;
MoltenRock.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;MoltenRock.LIST=Enemy.LIST;MoltenRock.MAX_TYPE=Enemy.MAX_TYPE;MoltenRock.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;MoltenRock.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;MoltenRock.assign=Enemy.assign;
MoltenRock.prototype.move=function(a){var b=[],c=this.parent;c.phase==Molten.PHASE.OWN?b=Enemy.prototype.move.call(this,c):Enemy.prototype.move.call(this,a);if(this.absorbed&&this.hitPoint){a=Math.trim(this.dir+Math.SQ);for(var d=0;3>d;d++){var e=new MoltenRock(c,this.x,this.y);e.dir=a;e.speed=1.2*this.speed;e.hitPoint=this.hitPoint;b.push(e);c.rock.push(e);a=Math.trim(a+Math.SQ)}}this.absorbed=!1;return b};
var Motion=function(a,b,c,d){this.type=a;this.key=b;this.speed=c;this.h=d;this.y=this.x=this.v=0;this.triggerMax=this.triggerMin=Number.NaN;this.filling=this.reserve=null;this.batter=0};Motion.prototype.rotateV=function(a){this.v=a;return this};Motion.prototype.offsetX=function(a){this.x=a;return this};Motion.prototype.offsetY=function(a){this.y=a;return this};
Motion.prototype.shot=function(a,b,c){this.reserve={type:a,id:b};isFinite(c)?(this.triggerMin=c,this.triggerMax=c+this.speed):(this.triggerMin=c.min,this.triggerMax=c.max);return this};Motion.prototype.reset=function(){this.mot=VisualManager.Instance.dic[this.key];this.max=this.mot.length-1;this.ix=0;this.dir=1;return this};
Motion.prototype.next=function(){var a=this.ix+this.speed*this.dir;if(this.max<=a){if(this.type!=Motion.TYPE.REWIND)return null;this.ix=this.max;this.dir*=-1;return[this.mot[this.ix]]}if(0>a)return null;for(var b=[];this.ix!=a;)this.ix+=this.dir,b.push(this.mot[this.ix]);this.checkTrigger();return b};Motion.prototype.checkTrigger=function(){this.filling||(0<this.batter?this.batter=0:this.triggerMin<=this.ix&&this.ix<=this.triggerMax&&(this.filling=this.reserve,this.batter=1))};
Motion.prototype.fire=function(){if(this.filling){var a=this.filling;this.filling=null;return a}};Motion.TYPE={NORMAL:0,ONLY_ONE:1,REWIND:2};var MotionRoutine=function(a){this.routine=a;this.ix=0;this.max=this.routine.length-1;this.loop=0;this.current=this.routine[this.ix]};MotionRoutine.prototype.reset=function(){this.loop=this.ix=0;this.current=this.routine[this.ix].reset()};
MotionRoutine.prototype.next=function(a){var b=this.current.ix,c=this.current.next();null==c&&(this.ix++,this.max<this.ix&&(this.ix=0,this.loop++),this.current=this.routine[this.ix].reset(),0<this.loop&&this.current.type==Motion.TYPE.ONLY_ONE&&(this.ix++,this.current=this.routine[this.ix].reset()),c=this.current.next());var d=this.current.ix<b?-1:1;b=this.current.fire();a.rotationH=this.current.h;a.rotationV=this.current.v;a.offsetX=this.current.x;a.offsetY=this.current.y;a.calcRotationMatrix();c.forEach(function(b){a.shift(b,
d);a.calculate()});return b};var Skeleton=function(a){this.data=a;this.map={};this.offsetY=this.offsetX=0;this.rotationH=Math.PI/4;this.rotationV=Math.PI/8;this.rotationMatrix=new Matrix(Matrix.NO_EFFECT);this.init()};Skeleton.prototype.init=function(){var a=Object.assign(new Bone,this.data.root);this.data.root=a;this.prepare(a);this.calcRotationMatrix()};
Skeleton.prototype.prepare=function(a){var b=this,c=[];a.prepare();a.joint.forEach(function(b){b.parent=a;c.push(Object.assign(new Bone,b))});a.joint=c;a.joint.forEach(function(a){b.prepare(a)});a.skeleton=this;this.map[a.name]=a};Skeleton.prototype.calcRotationMatrix=function(){var a=Matrix.rotateY(this.rotationH);this.rotationMatrix=Matrix.rotateX(this.rotationV).multiply(a)};Skeleton.prototype.rotateH=function(a){this.rotationH+=Math.PI/720*a;this.rotationH=Math.trim(this.rotationH);this.calcRotationMatrix()};
Skeleton.prototype.rotateV=function(a){this.rotationV+=Math.PI/720*a;this.rotationV=Math.trim(this.rotationV);this.calcRotationMatrix()};Skeleton.prototype.shift=function(a,b){var c=this;a.forEach(function(a){var d=a.r,g=c.map[a.name],f=Matrix.rotateX(d.x),h=Matrix.rotateY(d.y);d=Matrix.rotateZ(d.z);g.motionMatrix=d.multiply(h).multiply(f);a.p&&(a=a.p,f=g.pt,g.translateMatrix=new Matrix([[1,0,0,c.offsetX+f.x+a.x*b],[0,1,0,c.offsetY+f.y+a.y*b],[0,0,1,f.z+a.z*b],[0,0,0,1]]))})};
Skeleton.prototype.calculate=function(a){this.data.root.calculate(a)};Skeleton.prototype.draw=function(a){this.data.root.draw(a)};var Bone=function(){this.pt={x:0,y:0,z:0}};
Bone.prototype.prepare=function(){var a=this.translate,b=Matrix.rotateX(this.axis.x),c=Matrix.rotateY(this.axis.y);b=Matrix.rotateZ(this.axis.z).multiply(c).multiply(b);this.translateMatrix=new Matrix([[1,0,0,a.x],[0,1,0,a.y],[0,0,1,a.z],[0,0,0,1]]);if(this.parent){var d=this.parent;a=Matrix.rotateX(-d.axis.x);c=Matrix.rotateY(-d.axis.y);d=Matrix.rotateZ(-d.axis.z);this.axisMatrix=a.multiply(c).multiply(d).multiply(b)}else this.axisMatrix=b;this.motionMatrix=new Matrix(Matrix.NO_EFFECT)};
Bone.prototype.getAccum=function(){if(this.parent){var a=this.axisMatrix.multiply(this.motionMatrix).multiply(this.translateMatrix);return this.parent.getAccum().multiply(a)}return this.translateMatrix.multiply(this.motionMatrix)};Bone.prototype.calculate=function(a){this.pt=this.getAccum().affine(0,0,0);a||this.joint.forEach(function(a){a.calculate(!1)})};
Bone.prototype.drawLine=function(a){var b=this.parent.pt,c=this.pt,d=this.skeleton.rotationMatrix;b=d.affine(b.x,b.y,b.z);c=d.affine(c.x,c.y,c.z);d=c.x;var e=-c.y,g=b.x;b=-b.y;var f=d-g,h=e-b;this.cx=g+f/2;this.cy=b+h/2;this.cz=c.z;this.radian=Math.atan2(h,f);a.beginPath();a.moveTo(g,b);a.lineTo(d,e);a.stroke()};Bone.prototype.draw=function(a){this.calculate();this.parent&&this.drawLine(a);this.joint.forEach(function(b){b.draw(a)})};
var Titan=function(a,b){Enemy.call(this,a,b);this.scale=7;this.hitPoint=Number.MAX_SAFE_INTEGER;this.motionRoutine=Titan.ROUTINE;this.motionRoutine.reset();a=Object.assign({},VisualManager.Instance.dic["asf.json"]);this.skeleton=new Skeleton(a);this.setupBone()};$jscomp.inherits(Titan,Enemy);Titan.CollidingWallType=Enemy.CollidingWallType;Titan.ActivityAreaType=Enemy.ActivityAreaType;Titan.TypeList=Enemy.TypeList;Titan.Type=Enemy.Type;Titan.DEG_STEP=Enemy.DEG_STEP;Titan.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;
Titan.LIST=Enemy.LIST;Titan.MAX_TYPE=Enemy.MAX_TYPE;Titan.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Titan.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Titan.assign=Enemy.assign;Titan.prototype.setupBone=function(){var a={};Object.keys(this.skeleton.map).forEach(function(b){if("root"!=b){var c=new TitanBone(b,0,0);b==Titan.CORE&&(c.hitPoint=Titan.HIT_POINT);a[b]=c}});this.boneMap=a;this.appears=!1};
Titan.prototype.eject=function(){var a=this;Enemy.prototype.eject.call(this);Object.keys(this.boneMap).forEach(function(b){b=a.boneMap[b];b.hitPoint=0;b.explosion=2*Actor.MAX_EXPLOSION})};
Titan.prototype.move=function(a){var b=this,c=[],d=this.motionRoutine.next(this.skeleton);Enemy.prototype.move.call(this,a);if(!this.appears)return Object.keys(this.boneMap).forEach(function(a){c.push(b.boneMap[a])}),this.appears=!0,c.reverse();var e=this.skeleton.map,g=!1;d&&d.id.forEach(function(a){a=b.boneMap[a];var e=new d.type(a.x,a.y);e.dir=a.radian;c.push(e)});Object.keys(this.boneMap).forEach(function(a){var c=e[a],d=c.cy*b.scale+b.y;a=b.boneMap[a];a.x=c.cx*b.scale+b.x;a.y=d;a.z=c.cz;a.radian=
c.radian;0==a.hitPoint&&(g=!0)});g&&this.eject();return c};Titan.prototype.drawInfo=function(a){var b=this.motionRoutine.current,c=this.boneMap[Titan.CORE];a.save();a.translate(this.x,this.y);a.strokeStyle="rgba(255, 255, 255, 0.8)";a.strokeText("ix:"+b.ix,0,0);a.strokeText("hp:"+c.hitPoint,0,10);a.restore()};Titan.prototype.drawNormal=function(a){a.save();a.translate(this.x,this.y);this.skeleton&&(a.scale(this.scale,this.scale),a.strokeStyle="rgba(203, 152, 135, 0.2)",this.skeleton.draw(a));a.restore()};
Titan.prototype.isHit=function(a){return!1};Titan.HIT_POINT=292;Titan.CORE="lowerback";var TitanBone=function(a,b,c){Enemy.call(this,b,c);this.id=a;this.hasBounds=!1;this.hitPoint=Number.MAX_SAFE_INTEGER;this.filling=null;this.anim=new Animator("boss.titan."+a)};$jscomp.inherits(TitanBone,Enemy);TitanBone.CollidingWallType=Enemy.CollidingWallType;TitanBone.ActivityAreaType=Enemy.ActivityAreaType;TitanBone.TypeList=Enemy.TypeList;TitanBone.Type=Enemy.Type;TitanBone.DEG_STEP=Enemy.DEG_STEP;
TitanBone.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;TitanBone.LIST=Enemy.LIST;TitanBone.MAX_TYPE=Enemy.MAX_TYPE;TitanBone.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;TitanBone.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;TitanBone.assign=Enemy.assign;TitanBone.prototype.drawNormal=function(a){Enemy.prototype.drawNormal.call(this,a)};$jscomp.global.Object.defineProperties(TitanBone.prototype,{triggered:{configurable:!0,enumerable:!0,get:function(){return!1}}});
var TitanBall=function(a,b){Enemy.call(this,a,b);this.hasBounds=!1;this.speed=1.5+4*Math.random();this.gravity=.03;this.hitPoint=4;this.anim=new Animator("boss.titan.titan.ball")};$jscomp.inherits(TitanBall,Enemy);TitanBall.CollidingWallType=Enemy.CollidingWallType;TitanBall.ActivityAreaType=Enemy.ActivityAreaType;TitanBall.TypeList=Enemy.TypeList;TitanBall.Type=Enemy.Type;TitanBall.DEG_STEP=Enemy.DEG_STEP;TitanBall.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;TitanBall.LIST=Enemy.LIST;TitanBall.MAX_TYPE=Enemy.MAX_TYPE;
TitanBall.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;TitanBall.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;TitanBall.assign=Enemy.assign;TitanBall.prototype.reactY=function(a){Enemy.prototype.reactY.call(this,a);this.fate(this)};$jscomp.global.Object.defineProperties(TitanBall.prototype,{triggered:{configurable:!0,enumerable:!0,get:function(){return!1}}});var TitanBullet=function(a,b){Enemy.call(this,a,b);this.radian=this.dir=-Math.PI+Math.SQ/2;this.speed=4;this.hitPoint=Number.MAX_SAFE_INTEGER;this.anim=new Animator("boss.titan.titan.bullet")};
$jscomp.inherits(TitanBullet,Enemy);TitanBullet.CollidingWallType=Enemy.CollidingWallType;TitanBullet.ActivityAreaType=Enemy.ActivityAreaType;TitanBullet.TypeList=Enemy.TypeList;TitanBullet.Type=Enemy.Type;TitanBullet.DEG_STEP=Enemy.DEG_STEP;TitanBullet.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;TitanBullet.LIST=Enemy.LIST;TitanBullet.MAX_TYPE=Enemy.MAX_TYPE;TitanBullet.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;TitanBullet.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;TitanBullet.assign=Enemy.assign;
$jscomp.global.Object.defineProperties(TitanBullet.prototype,{triggered:{configurable:!0,enumerable:!0,get:function(){return!1}}});var TitanShot=function(a,b){Enemy.call(this,a,b);this.radian=this.dir=Math.PI;this.speed=7;this.hitPoint=Number.MAX_SAFE_INTEGER;this.anim=new Animator("boss.titan.titan.shot")};$jscomp.inherits(TitanShot,Enemy);TitanShot.CollidingWallType=Enemy.CollidingWallType;TitanShot.ActivityAreaType=Enemy.ActivityAreaType;TitanShot.TypeList=Enemy.TypeList;TitanShot.Type=Enemy.Type;
TitanShot.DEG_STEP=Enemy.DEG_STEP;TitanShot.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;TitanShot.LIST=Enemy.LIST;TitanShot.MAX_TYPE=Enemy.MAX_TYPE;TitanShot.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;TitanShot.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;TitanShot.assign=Enemy.assign;
Titan.ROUTINE=new MotionRoutine([(new Motion(Motion.TYPE.ONLY_ONE,"111_7.amc.json",2,Math.PI/4)).offsetX(0).offsetY(0),(new Motion(Motion.TYPE.NORMAL,"79_96.amc.json",1,.4*-Math.PI)).shot(TitanShot,["lradius","lwrist","lhand","lthumb","lfingers"],200),(new Motion(Motion.TYPE.REWIND,"133_01.amc.json",2,Math.PI)).shot(TitanBullet,["thorax","upperneck"],{min:200,max:550}),(new Motion(Motion.TYPE.NORMAL,"79_91.amc.json",1,.4*-Math.PI)).shot(TitanBall,["rhumerus","rradius","rwrist","rhand"],{min:175,max:200}),
(new Motion(Motion.TYPE.NORMAL,"86_01b.amc.json",2,Math.PI)).shot(Bullet,["lfingers","rfingers"],{min:0,max:1E3})]);
var Winding=function(a,b){Chain.call(this,a,b);this.region=new Region(this,12);this.dir=-Math.PI;this.step=Math.SQ/100;this.radius=Winding.RADIUS;this.speed=.5;this.hitPoint=100;this.hasBounds=!1;this.ratio=Winding.RATIO_MAX;this.delta=-1;this.uncoil=!1;this.anim=new Animator("boss.winding");this.routine=[(new Movement(200)).add(Gizmo.TYPE.CHASE,Gizmo.DEST.ROTATE,Math.PI/180),(new Movement(20)).add(Gizmo.TYPE.OWN,Gizmo.DEST.ROTATE_R)];this.chamberList=[new Chamber(Slur,Winding.TRIGGER_CYCLE)];this.init()};
$jscomp.inherits(Winding,Chain);Winding.CollidingWallType=Chain.CollidingWallType;Winding.ActivityAreaType=Chain.ActivityAreaType;Winding.TypeList=Chain.TypeList;Winding.Type=Chain.Type;Winding.DEG_STEP=Chain.DEG_STEP;Winding.MAX_EXPLOSION=Chain.MAX_EXPLOSION;Winding.LIST=Chain.LIST;Winding.MAX_TYPE=Chain.MAX_TYPE;Winding.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;Winding.assign=Chain.assign;
Winding.prototype.init=function(){this.appears=!1;for(var a=0;a<Winding.MAX_JOINT;a++)this.push(new WindingChild(this.x,this.y))};
Winding.prototype.move=function(a){var b=Chain.prototype.move.call(this,a),c=Math.trim(this.dir-Math.SQ/2);this.rad=Math.trim(this.dir+Math.SQ);if(this.appears){for(var d=this.next;d;)c+=Winding.RADIAN_STEP*this.ratio/100,d.radian=Math.trim(c),d=d.next;this.uncoil&&(this.ratio+=this.delta,1>=this.ratio?this.delta*=-1:Winding.RATIO_MAX<=this.ratio&&(this.uncoil=!1,this.delta*=-1,b=this.trigger(a,!0),b.forEach(function(b){b.aim(a);b.dir=Math.trim(b.dir+Math.PI)})));return b}this.appears=!0;for(c=this.next;c;)b.push(c),
c=c.next;return b};Winding.prototype.fate=function(a){Chain.prototype.fate.call(this,a);this.uncoil=!0};Winding.RADIUS=16;Winding.RADIAN_STEP=Math.SQ;Winding.RATIO_MAX=50;Winding.MAX_JOINT=20;Winding.TRIGGER_CYCLE=20;var WindingChild=function(a,b){Chain.call(this,a,b);this.hasBounds=!1;this.radius=WindingChild.RADIUS;this.anim=new Animator("boss.winding.joint")};$jscomp.inherits(WindingChild,Chain);WindingChild.CollidingWallType=Chain.CollidingWallType;WindingChild.ActivityAreaType=Chain.ActivityAreaType;
WindingChild.TypeList=Chain.TypeList;WindingChild.Type=Chain.Type;WindingChild.DEG_STEP=Chain.DEG_STEP;WindingChild.MAX_EXPLOSION=Chain.MAX_EXPLOSION;WindingChild.LIST=Chain.LIST;WindingChild.MAX_TYPE=Chain.MAX_TYPE;WindingChild.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;WindingChild.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;WindingChild.assign=Chain.assign;WindingChild.prototype.move=function(a){a=this.prev;var b=this.radius+a.radius;this.x=a.x+Math.cos(this.radian)*b;this.y=a.y+Math.sin(this.radian)*b};
WindingChild.prototype.fate=function(){};WindingChild.RADIUS=4;var Cascade=function(a,b){Chain.call(this,a,b);this.anim=new Animator("material.cascade");this.radian=Math.SQ;this.radius=Cascade.RADIUS;this.appears=!1;for(var c=0;c<Cascade.MAX_JOINT;c++)this.push(new CascadeChild(a,b,3*(Cascade.MAX_JOINT-c)))};$jscomp.inherits(Cascade,Chain);Cascade.CollidingWallType=Chain.CollidingWallType;Cascade.ActivityAreaType=Chain.ActivityAreaType;Cascade.TypeList=Chain.TypeList;Cascade.Type=Chain.Type;
Cascade.DEG_STEP=Chain.DEG_STEP;Cascade.MAX_EXPLOSION=Chain.MAX_EXPLOSION;Cascade.LIST=Chain.LIST;Cascade.MAX_TYPE=Chain.MAX_TYPE;Cascade.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;Cascade.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;Cascade.assign=Chain.assign;Cascade.prototype.move=function(a){Chain.prototype.move.call(this,a);if(!this.appears){this.appears=!0;a=[];for(var b=this.next;b;)a.push(b),b=b.next;return a}};Cascade.prototype.fate=function(){};Cascade.RADIUS=4;Cascade.MAX_JOINT=12;
var CascadeChild=function(a,b,c){Chain.call(this,a,b);this.weight=c;this.radian=.9*Math.SQ;this.radius=Cascade.RADIUS;this.step=0;Product.Instance&&(this.maxX=Product.Instance.width+100)};$jscomp.inherits(CascadeChild,Chain);CascadeChild.CollidingWallType=Chain.CollidingWallType;CascadeChild.ActivityAreaType=Chain.ActivityAreaType;CascadeChild.TypeList=Chain.TypeList;CascadeChild.Type=Chain.Type;CascadeChild.DEG_STEP=Chain.DEG_STEP;CascadeChild.MAX_EXPLOSION=Chain.MAX_EXPLOSION;
CascadeChild.LIST=Chain.LIST;CascadeChild.MAX_TYPE=Chain.MAX_TYPE;CascadeChild.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;CascadeChild.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;CascadeChild.assign=Chain.assign;CascadeChild.prototype.addRadian=function(a){return this.radian=Math.trim(this.radian+a)};
CascadeChild.prototype.move=function(a){a=this.prev;var b=Math.trim(Math.SQ-this.radian)/(300+10*this.weight);this.step+=b;0==parseInt(1E3*b)&&(this.step*=.98);b=Math.trim(this.radian+this.step);var c=this.radius+a.radius;0>b&&(b=0);this.radian=b;this.x=a.x+Math.cos(b)*c;this.y=a.y+Math.sin(b)*c};CascadeChild.prototype.draw=function(a){a.save();a.fillStyle="rgba(60, 200, 0, 0.8)";a.translate(this.x,this.y);a.beginPath();a.arc(0,0,this.radius,0,Math.PI2,!1);a.fill();a.restore()};
CascadeChild.prototype.fate=function(a){a=Math.PI/200;this.step-=a;for(var b=this.next;b;)b.step-=.8*a,b=b.next};
var Rewinder=function(a,b){Chain.call(this,a,b);this.step=Math.SQ/100;this.radius=Rewinder.RADIUS;this.speed=1.1;this.hitPoint=Number.MAX_SAFE_INTEGER;this.hasBounds=!1;this.ratio=Rewinder.RATIO_MAX;this.delta=-.55;this.anim=new Animator("material.cascade");this.routine=[(new Movement).add(Gizmo.TYPE.AIM,Gizmo.DEST.ROTATE).add(Gizmo.TYPE.FIXED,Gizmo.DEST.TO)];this.appears=!1;for(var c=0;c<Rewinder.MAX_JOINT;c++)this.push(new RewinderChild(a,b))};$jscomp.inherits(Rewinder,Chain);
Rewinder.CollidingWallType=Chain.CollidingWallType;Rewinder.ActivityAreaType=Chain.ActivityAreaType;Rewinder.TypeList=Chain.TypeList;Rewinder.Type=Chain.Type;Rewinder.DEG_STEP=Chain.DEG_STEP;Rewinder.MAX_EXPLOSION=Chain.MAX_EXPLOSION;Rewinder.LIST=Chain.LIST;Rewinder.MAX_TYPE=Chain.MAX_TYPE;Rewinder.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;Rewinder.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;Rewinder.assign=Chain.assign;
Rewinder.prototype.move=function(a){var b=[],c=Math.trim(this.radian+Math.SQ/2);Chain.prototype.move.call(this,a);if(this.appears){for(a=this.next;a;)c-=Rewinder.RADIAN_STEP*this.ratio/100,a.radian=Math.trim(c),a=a.next;this.ratio+=this.delta;1>=this.ratio?this.delta*=-1:Rewinder.RATIO_MAX<=this.ratio&&(this.delta*=-1);return b}this.appears=!0;for(c=this.next;c;)b.push(c),c=c.next;return b};Rewinder.prototype.fate=function(){};Rewinder.RADIUS=4;Rewinder.RADIAN_STEP=Math.SQ;Rewinder.RATIO_MAX=100;
Rewinder.MAX_JOINT=16;var RewinderChild=function(a,b){Chain.call(this,a,b);this.radian=0;this.hasBounds=!1;this.radius=RewinderChild.RADIUS;this.anim=new Animator("boss.winding.joint")};$jscomp.inherits(RewinderChild,Chain);RewinderChild.CollidingWallType=Chain.CollidingWallType;RewinderChild.ActivityAreaType=Chain.ActivityAreaType;RewinderChild.TypeList=Chain.TypeList;RewinderChild.Type=Chain.Type;RewinderChild.DEG_STEP=Chain.DEG_STEP;RewinderChild.MAX_EXPLOSION=Chain.MAX_EXPLOSION;
RewinderChild.LIST=Chain.LIST;RewinderChild.MAX_TYPE=Chain.MAX_TYPE;RewinderChild.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;RewinderChild.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;RewinderChild.assign=Chain.assign;RewinderChild.prototype.move=function(a){a=this.prev;var b=this.radius+a.radius;this.x=a.x+Math.cos(this.radian)*b;this.y=a.y+Math.sin(this.radian)*b};RewinderChild.prototype.fate=function(){};RewinderChild.RADIUS=4;
