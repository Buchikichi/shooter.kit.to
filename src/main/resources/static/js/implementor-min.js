GeneratorFunction = Object.getPrototypeOf(function*(){}).constructor;
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var e=b.length,f=a.length;c=Math.max(0,Math.min(c|0,b.length));for(var g=0;g<f&&c<e;)if(b[c++]!=a[g++])return!1;return g>=f}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(k){b.reject(k)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(k){this.reject_(k);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)f.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(q){f(q)}}:b}var d,f,g=new e(function(a,b){d=a;f=b});this.callWhenSettled_(c(a,d),c(b,f));return g};
e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(c)};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,d){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())c(f.value).callWhenSettled_(b,
d)})};e.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){g[b]=c;h--;0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,c(d.value).callWhenSettled_(f(g.length-1),e),d=b.next();while(!d.done)})};return e},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};
$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};
$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");var EntityBase=function(a){this.base=a?a:this.constructor.name.slice(0,-6).toLowerCase()};
EntityBase.prototype.fetch=function(a,b,c){b=void 0===b?"{}":b;c=void 0===c?{"Content-Type":"application/json;charset=UTF-8"}:c;var d=document.querySelector("[name*=CSRF]");c[d.name]=d.value;return fetch("/"+this.base+a,{method:"POST",headers:c,body:b,credentials:"include"})};EntityBase.prototype.list=function(a){a=void 0===a?{}:a;return this.fetch("/list",JSON.stringify(a)).then(function(a){return a.text()}).then(function(a){return(new DOMParser).parseFromString(a,"text/html")})};
EntityBase.prototype.select=function(a){return this.fetch("/select/"+a).then(function(a){return a.json()})};EntityBase.prototype.save=function(a){var b=[];a=JSON.stringify(a,function(a,d){if(!a.startsWith("_")){if(null!=d&&"object"==typeof d){if(0<=b.indexOf(d))return;b.push(d)}return d}});return this.fetch("/save",a).then(function(a){return a.json()})};EntityBase.prototype.saveResource=function(a){return this.fetch("/save",a,{}).then(function(a){return a.json()})};
var ActorEntity=function(){EntityBase.call(this,"actor")};$jscomp.inherits(ActorEntity,EntityBase);var AudioEntity=function(){EntityBase.call(this,"audio")};$jscomp.inherits(AudioEntity,EntityBase);AudioEntity.Type={OTHER:0,FX:1,BGM:2};var MapEntity=function(){EntityBase.call(this,"map")};$jscomp.inherits(MapEntity,EntityBase);var MediasetEntity=function(){EntityBase.call(this,"mediaset")};$jscomp.inherits(MediasetEntity,EntityBase);var ProductEntity=function(){EntityBase.call(this,"product")};
$jscomp.inherits(ProductEntity,EntityBase);ProductEntity.prototype.increase=function(a){return this.fetch("/increase/"+a).then(function(a){return a.json()})};var ScoreEntity=function(){EntityBase.call(this,"score")};$jscomp.inherits(ScoreEntity,EntityBase);var StageEntity=function(){EntityBase.call(this,"stage")};$jscomp.inherits(StageEntity,EntityBase);var UtilsEntity=function(){EntityBase.call(this,"utils")};$jscomp.inherits(UtilsEntity,EntityBase);UtilsEntity.prototype.uuid=function(){return this.fetch("/uuid/").then(function(a){return a.json()}).then(function(a){return a.result})};
var VisualEntity=function(){EntityBase.call(this,"visual")};$jscomp.inherits(VisualEntity,EntityBase);VisualEntity.Type={Player:0,Shot:1,Item:2,Aerial:3,Subaerial:4,Boss:5,Ornament:6,Explosion:7,Background:8,Foreground:9,Other:10};var Repository=function(){this.loaded=this.max=0;this.dic={};this.reserved={};this.type="json"};Repository.prototype.isComplete=function(){return 0==this.max||0<this.max&&this.max==this.loaded};
Repository.prototype.reserve=function(a,b,c){null==a||0==a.length||a in this.reserved||(this.reserved[a]=!0,this.load(a,void 0===b?null:b,void 0===c?"":c))};Repository.prototype.makeName=function(a){return a};Repository.prototype.load=function(a,b,c){var d=this,e=new XMLHttpRequest;c=this.makeName(a);var f="json"==this.type;this.max++;e.open("GET",c,!0);f||(e.responseType=this.type);e.addEventListener("loadend",function(){var c=e.response;f&&(c=JSON.parse(c));d.onload(a,b,c)});e.send()};
Repository.prototype.onload=function(a,b,c){this.dic[a]=c;b&&(this.dic[b]=c);this.done()};Repository.prototype.done=function(){this.loaded++};Repository.prototype.checkLoading=function(a){var b=this;return new Promise(function(c){var d=function(){b.isComplete()?c():(a(),setTimeout(d,30))};d()})};var Matter=function(a,b,c){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c;this.dy=0;this.dir=null;this.speed=this.gravity=this.radian=0};
Matter.prototype.setRect=function(a,b){this.width=a;this.hW=a/2;this.height=b;this.hH=b/2};Matter.prototype.move=function(){};
var Actor=function(a,b,c){Matter.call(this,void 0===a?0:a,void 0===b?0:b,void 0===c?0:c);this.region=new Region(this);this.setRect(16,16);this.animList=[];this.chamberList=[];this.hasBounds=!0;this.reaction=0;this.effectV=this.effectH=!1;this.hitPoint=1;this.activityAreaType=Actor.ActivityAreaType.FREEDOM;this.collidingWallType=Actor.CollidingWallType.THROUGH;this.absorbed=!1;this.absorbedTarget=null;this.score=0;this.isInverse=this.walled=!1;this.fillStyle=null;this.sfx="sfx-explosion";this.sfxAbsorb=
"sfx-absorb";this.spawn=[];this.actorVisualList=[];this.enter()};$jscomp.inherits(Actor,Matter);Actor.prototype.checkInverse=function(){};Actor.prototype.enter=function(){this.explosion=0;this.isGone=!1};Actor.prototype.eject=function(){this.isGone=!0};Actor.prototype.aim=function(a){if(a){var b=this.calcDistance(a);this.speed<b&&(this.dir=Math.atan2(a.y-this.y,a.x-this.x))}else this.dir=null;return this};
Actor.prototype.closeGap=function(a){a=Math.trim(this.radian-Math.atan2(a.y-this.y,a.x-this.x));return Math.abs(a)<=Actor.DEG_STEP?0:0<a?-Actor.DEG_STEP:Actor.DEG_STEP};Actor.prototype.reactX=function(a){this.dir=Math.trim(this.dir+Math.PI)};Actor.prototype.reactY=function(a){this.y=a;this.dy*=-this.reaction;this.radian=this._stage.map.getHorizontalAngle(this);this.reacted=!0};
Actor.prototype.trigger=function(a,b){var c=this;b=void 0===b?!1:b;this.chamberList.forEach(function(a){return a.probe()});null!=a&&a.isGone||!this.triggered&&!b||(this.triggered=!1,this.chamberList.forEach(function(b){(b=b.fire(c,a))&&c.spawn.push(b)}))};
Actor.prototype.checkActivityArea=function(){if(this._stage){var a=this.x-this._stage.map.x,b=this.y-this._stage.map.y,c=this._stage.map.x,d=this._stage.map.y,e=this._stage.map._mainVisual.image.height;this.activityAreaType==Actor.ActivityAreaType.RESTRICTION?(a=c+this.hW,b=c+Product.Instance.width-this.hW,e=d+this.hH,d=d+Product.Instance.height-this.hH,this.x<a?this.x=a:b<this.x&&(this.x=b),this._stage.scroll!=Stage.SCROLL.LOOP&&(this.y<e?this.y=e:d<this.y&&(this.y=d))):this.activityAreaType==Actor.ActivityAreaType.EJECT?
((a<-this.width||Product.Instance.width+this.width<a)&&this.eject(),this._stage.scroll!=Stage.SCROLL.LOOP&&(b<-this.height||e+this.height<b)&&this.eject()):(d=2*Product.Instance.width,c=-Product.Instance.height,e+=Product.Instance.height,(a<-Product.Instance.width||d<a)&&this.eject(),this._stage.scroll!=Stage.SCROLL.LOOP&&(b<c||e<b)&&this.eject())}};
Actor.prototype.processDirType=function(a){if(a){var b=a.x-this.x;a=a.y-this.y;this.dirType==Actor.DirType.Aim?this.dir=Math.atan2(a,b):this.dirType==Actor.DirType.Chase&&(this.dir=Math.close(this.dir,Math.atan2(a,b),Math.PI/180*this.dirSpeed))}};Actor.prototype.processExplosion=function(){0>=this.explosion||(this.explosion--,0==this.explosion&&(this.eject(),this.belongings instanceof Actor&&(this.belongings.x=this.x,this.belongings.y=this.y,this.spawn.push(this.belongings))))};
Actor.prototype.move=function(a){var b=this;a&&(this.target=a);this.processExplosion();this.reacted=!1;this.processDirType(a);this.svX=this.x;this.svY=this.y;null!=this.dir&&(this.x+=Math.cos(this.dir)*this.speed,this.y+=Math.sin(this.dir)*this.speed);if(0!=this.gravity){var c=this._stage.map.scanFloor(this),d=!1;0>this.gravity?(c+=this.hH,c<this.y?this.dy+=this.gravity:this.y<c&&(d=!0)):(c-=this.hH,this.y<c?this.dy+=this.gravity:c<this.y&&(d=!0));d&&(2*this._stage.map.brickSize<Math.abs(this.y-c)?
this.reactX(c):this.reactY(c))}this.y+=this.dy*this.speed;this.animList.forEach(function(a){a.next(b.dir)});this.checkActivityArea();this.actorVisualList.forEach(function(b){return b.move(a)});this.behaviorIterator&&this.behaviorIterator.next();this.trigger(a)};Actor.prototype.drawCircle=function(a){a.save();a.beginPath();a.fillStyle=this.fillStyle;a.arc(0,0,this.radius,0,2*Math.PI,!1);a.fill();a.restore()};
Actor.prototype.drawHitPoint=function(a){1E5>this.hitPoint&&(a.save(),a.fillStyle="white",a.fillText(this.hitPoint,0,20),a.restore())};Actor.prototype.drawNormal=function(a){this.actorVisualList.forEach(function(b){return b.draw(a)});this.animList.forEach(function(b){b.draw(a)});0==this.animList.length&&this.fillStyle&&this.drawCircle(a)};
Actor.prototype.drawAbsorb=function(a){a.fillStyle="rgba(255, 200, 0, 0.4)";a.save();a.translate(this.absorbedTarget.x,this.absorbedTarget.y);a.beginPath();a.arc(0,0,5,0,Math.PI2);a.fill();a.restore();this.absorbedTarget=null};Actor.prototype.drawExplosion=function(a){var b=this.explosion;a.save();a.fillStyle="rgba(255, 0, 0, 0.7)";a.beginPath();a.arc(0,0,b,0,Math.PI2,!1);a.fill();a.restore()};
Actor.prototype.draw=function(a){this.isGone||(a.save(),a.translate(this.x,this.y),0<this.explosion?this.drawExplosion(a):this.drawNormal(a),a.restore(),this.absorbedTarget&&this.drawAbsorb(a))};Actor.prototype.isHit=function(a){return this.isGone||0<this.explosion||0<a.explosion?!1:this.region.isHit(a.region)?(this.fate(a),a.fate(this),!0):!1};Actor.prototype.calcDistance=function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)};
Actor.prototype.fate=function(a){a=void 0===a?null:a;null!=a&&a.isGone||this.isGone||this.explosion||(this.hitPoint--,0<this.hitPoint?this.absorb(a):(this.explosion=Actor.MAX_EXPLOSION,this.playAudio(ActorAudio.AudioType.Explosion)||(a=Product.Instance.calcPan(this),AudioMixer.INSTANCE.play(this.sfx,.2,!1,a))))};Actor.prototype.absorb=function(a){this.absorbed=!0;this.absorbedTarget=a;this.sfxAbsorb&&(a=Product.Instance.calcPan(this),AudioMixer.INSTANCE.play(this.sfxAbsorb,.3,!1,a))};
Actor.prototype.playAudio=function(a){return this._audioMap?(a=this._audioMap[a])?(a.play(),!0):!1:!1};Actor.prototype.initBehavior=function(){if(this.behavior){var a="{ while(true) {"+this.behavior.trim()+";yield;}}";try{this.func=new GeneratorFunction("actor",a),this.behaviorIterator=this.func(this)}catch(b){console.log("Actor#initBehavior:"),console.log(b.name+": "+b.message)}}};
Actor.prototype.init=function(){var a=this;this.region=new Region(this);this.setRect(this.width,this.height);this.dir=this.deg/180*Math.PI;this._audioMap={};this.actorAudioList.forEach(function(b){return a._audioMap[b.audioType]=ActorAudio.create(b,a)});this.actorVisualList=this.actorVisualList.map(function(b){return ActorVisual.create(b,a)});this.checkInverse();this.initBehavior();return this};Actor.create=function(a,b){b=void 0===b?{}:b;return Object.assign(new Actor,a,b).init()};
$jscomp.global.Object.defineProperties(Actor.prototype,{anim:{configurable:!0,enumerable:!0,set:function(a){var b=this;Array.isArray(a)?this.animList=a:this.animList=[a];this.animList.forEach(function(a){a._actor=b})}}});Actor.MAX_EXPLOSION=12;Actor.DEG_STEP=Math.PI/180;Actor.Type={Player:0,Shot:1,Item:2,Aerial:3,Subaerial:4,Boss:5,Ornament:6,Explosion:7,Background:8,Foreground:9,Other:10};Actor.TypeList="None Enemy Formation Boss Material Bullet Capsule Shot Missile Ship".split(" ");
Actor.ActivityAreaType={FREEDOM:0,RESTRICTION:1,EJECT:2};Actor.CollidingWallType={THROUGH:0,SMASH:1,BOUNCE:2,EJECT:4,CRUSH:8,SMASH_CRUSH:9};Actor.DirType={Manual:0,Spin:1,Aim:2,Chase:3,Fit:4};var ActorAudio=function(){};ActorAudio.prototype.play=function(){var a=Product.Instance.calcPan(this._actor);AudioMixer.INSTANCE.play(this._audio.id,this._volume,!1,a)};ActorAudio.prototype.init=function(){this._audio=Mediaset.Instance.getAudio(this.audioSeq);this._volume=this.volume/100;return this};
ActorAudio.create=function(a,b){return Object.assign(new ActorAudio,a,{_actor:b}).init()};ActorAudio.AudioType={Action:0,Reaction:1,Explosion:2,Notice:3,Introduction:4,Theme:5,Boss:6,Ending:7};var ActorGroup=function(){Actor.call(this);this.list=[];this.ready=!1;this.score=0};$jscomp.inherits(ActorGroup,Actor);ActorGroup.DirType=Actor.DirType;ActorGroup.CollidingWallType=Actor.CollidingWallType;ActorGroup.ActivityAreaType=Actor.ActivityAreaType;ActorGroup.TypeList=Actor.TypeList;ActorGroup.Type=Actor.Type;
ActorGroup.DEG_STEP=Actor.DEG_STEP;ActorGroup.prototype.add=function(a){this.x=a.x;this.y=a.y;this.list.push(a);this.ready=this.list.length==this.count;this.text=this.score+=a.score};ActorGroup.prototype.isDestroyed=function(){return 0==this.list.filter(function(a){return 0<a.hitPoint}).length&&0==this.explosion?(this.explosion=ActorGroup.MAX_EXPLOSION,!0):!1};
ActorGroup.prototype.move=function(a){var b=this;Actor.prototype.move.call(this,a);this.ready&&(this.list.forEach(function(a){a.isGone||0!=b.explosion||(b.x=a.x,b.y=a.y,b.z=a.z)}),!this.isGone&&this.isDestroyed()&&(a=[SpeedupCapsule,MissileCapsule],a=new (a[Math.floor(Math.random()*a.length)]),a.x=this.x,a.y=this.y,this.spawn.push(a)))};ActorGroup.prototype.drawExplosion=function(a){a.fillStyle="rgba(240, 240, 255, .8)";a.fillText(this.text,0,0)};ActorGroup.prototype.init=function(){this.y=0;return this};
ActorGroup.create=function(a){return Object.assign(new ActorGroup,a).init()};ActorGroup.MAX_EXPLOSION=150;var ActorVisual=function(){Matter.call(this);this.dir=0;this.dirType=Actor.DirType.Manual;this.dirSpeed=0};$jscomp.inherits(ActorVisual,Matter);
ActorVisual.prototype.move=function(a){if(a){var b=Math.PI/180*this.dirSpeed,c=a.x-this._actor.x;a=a.y-this._actor.y;this.dirType==Actor.DirType.Spin?this.dir+=b:this.dirType==Actor.DirType.Chase?this.dir=Math.close(this.dir,Math.atan2(a,c),b):this.dirType==Actor.DirType.Fit&&(this.dir=this._actor.dir)}};
ActorVisual.prototype.draw=function(a){var b=-this.hW,c=-this.hH,d=this.width,e=this.height;a.save();this._actor.isInverse&&this.dirType==Actor.DirType.Manual&&a.rotate(Math.PI);a.rotate(this.dir);this.img&&a.drawImage(this.img,0,0,d,e,b,c,d,e);a.restore()};ActorVisual.prototype.init=function(){this.setRect(this._actor.width,this._actor.height);if(this.visual=Mediaset.Instance.getVisualBySeq(this))this.img=VisualManager.Instance.dic[this.visual.id];return this};
ActorVisual.create=function(a,b){return Object.assign(new ActorVisual,a,{_actor:b}).init()};var Animator=function(a,b,c,d){b=void 0===b?Animator.TYPE.ROTATION:b;c=void 0===c?1:c;d=void 0===d?1:d;Matter.call(this,0,0);this.type=b;this.numX=c;this.numY=d;this.patNum=0;this.setupImage(a)};$jscomp.inherits(Animator,Matter);Animator.prototype.setupImage=function(a){this.img=VisualManager.Instance.dic[a];this.setRect(this.img.width/this.numX,this.img.height/this.numY)};
Animator.prototype.next=function(a){this.type&Animator.TYPE.V&&.1<Math.abs(this.patNum)&&(this.patNum=0>this.patNum?this.patNum+.1:this.patNum-.1);if(null!=a)if(this.type&Animator.TYPE.X)this.patNum+=.5*Math.cos(a),a=Math.floor(this.patNum),0>a?this.patNum=this.numX-.1:this.numX<=a&&(this.patNum=0);else if(this.type&Animator.TYPE.Y)this.patNum+=.5*Math.sin(a),a=Math.floor(this.patNum),0>a?this.patNum=this.numY-.1:this.numY<=a&&(this.patNum=0);else if(this.type&Animator.TYPE.V){var b=Math.floor(this.numY/
2);this.patNum+=Math.sin(a)/3;this.patNum<-b?this.patNum=-b:b<this.patNum&&(this.patNum=b)}this.patNum*=1E3;this.patNum=Math.round(this.patNum)/1E3};
Animator.prototype.draw=function(a){var b=this._actor,c=this.width,d=this.height,e=0,f=0;this.type&Animator.TYPE.X?e=c*Math.floor(this.patNum):this.type&Animator.TYPE.Y?f=d*Math.floor(this.patNum):this.type&Animator.TYPE.V&&(f=d*(parseInt(this.patNum)+(this.numY?parseInt(this.numY/2):0)));a.save();this.type==Animator.TYPE.NONE&&b.isInverse&&a.rotate(Math.PI);this.type&Animator.TYPE.ROTATION&&a.rotate(b.radian);b.scale&&a.scale(b.scale,b.scale);a.drawImage(this.img,e,f,c,d,-this.hW,-this.hH,c,d);a.restore()};
Animator.TYPE={NONE:0,ROTATION:1,X:2,Y:4,XY:6,H:8,V:16};var AudioMixer=function(){Repository.call(this);this.type="arraybuffer";this.ctx=null;if(window.AudioContext||window.webkitAudioContext)this.ctx=new (window.AudioContext||window.webkitAudioContext);this.dic=[];this.bgm=[];this.lastTime=this.lastKey=null};$jscomp.inherits(AudioMixer,Repository);
AudioMixer.prototype.makeName=function(a){var b=navigator.userAgent.toLowerCase(),c=36==a.length;return-1!==b.indexOf("edge")||-1!==b.indexOf("safari")?c?"/audio/audio/"+a:"/audio/audioName/"+a:c?"/audio/webm/"+a:"/audio/webmName/"+a};AudioMixer.prototype.onload=function(a,b,c){var d=this;null===this.ctx?this.done():this.ctx.decodeAudioData(c,function(c){d.dic[a]=c;b&&(d.dic[b]=c);d.done()})};
AudioMixer.prototype.play=function(a){if(null!==this.ctx&&this.dic[a]){var b=arguments.length,c=1<b?arguments[1]:1,d=2<b?arguments[2]:!1,e=3<b?arguments[3]:0;b=4<b?arguments[4]:0;var f=this.dic[a],g=new AudioElement(this.ctx,f,b);d&&(this.stop(),g.source.loopEnd=f.duration,g.source.loop=!0,this.bgm.push(g),this.lastKey=a);g.gainNode.gain.value=c;g.setPan(e);this.lastTime=this.ctx.currentTime-b}};AudioMixer.prototype.setPan=function(a){this.bgm.forEach(function(b){b.setPan(a)})};
AudioMixer.prototype.fade=function(){this.bgm.forEach(function(a){a.fade()})};AudioMixer.prototype.stop=function(){this.bgm.forEach(function(a){a.stop()})};AudioMixer.prototype.getCurrentTime=function(){if(0<this.bgm.length){var a=[];this.bgm.forEach(function(b){b.done||a.push(b)});this.bgm=a}return this.bgm.length?this.ctx.currentTime-this.lastTime:null};AudioMixer.prototype.setCurrentTime=function(a){this.bgm.length&&(this.stop(),this.play(this.lastKey,1,!0,0,a))};AudioMixer.INSTANCE=new AudioMixer;
function AudioElement(a,b,c){var d=this;this.done=!1;this.source=a.createBufferSource();this.gainNode=a.createGain();this.gainNode.connect(a.destination);"function"==typeof a.createStereoPanner?(this.panNode=a.createStereoPanner(),this.panNode.connect(this.gainNode),this.source.connect(this.panNode)):(this.panNode=null,this.source.connect(this.gainNode));this.source.buffer=b;this.source.start(0,c);this.source.onended=function(){d.done=!0}}
AudioElement.prototype.setPan=function(a){this.panNode&&(this.panNode.pan.value=a)};AudioElement.prototype.fade=function(){var a=this,b=this.gainNode.gain,c=b.value,d=function(){0==Math.floor(100*c)?a.stop():(c*=.9,b.value=c,setTimeout(d,600))};d()};AudioElement.prototype.stop=function(){this.done||this.source.stop()};
var Bricks=function(a){var b=this;this.bricks=null;if(a.map){var c=new Image;c.onload=function(){var a=document.createElement("canvas"),e=a.getContext("2d");a.width=c.width;a.height=c.height;e.drawImage(c,0,0);b.bricks=e.getImageData(0,0,c.width,c.height)};c.src=a.map}else this.clear(a);this.fieldMap=a};
Bricks.prototype.clear=function(a){var b=this;(new Promise(function(b){var c=function(){a._mainVisual.image?b(a._mainVisual.image):setTimeout(c,30)};c()})).then(function(c){var d=c.width/a.brickSize;c=c.height/a.brickSize;var e=d*c*4;b.bricks=new ImageData(d,c);b.bricks.data=Array(e)})};
Bricks.prototype.getIndex=function(a){if(!this.bricks)return-1;var b=this.fieldMap.brickSize,c=parseInt(a.x/b);b=parseInt(a.y/b);a._stage&&a._stage.isLoop&&(0>b&&(b+=this.bricks.height),this.bricks.height<b&&(b-=this.bricks.height));return 0>c||this.bricks.width<c||0>b||this.bricks.height<b?-1:4*(b*this.bricks.width+c)};Bricks.prototype.getBrick=function(a){a=this.getIndex(a);return-1==a?0:this.bricks.data[a+2]};
Bricks.prototype.putBrick=function(a,b){this.bricks.data[a+2]=b;this.bricks.data[a+3]=b?255:0};
Bricks.prototype.scanFloor=function(a){if(this.bricks){var b=this.fieldMap.brickSize,c,d=this.getBrick(a),e=0>a.gravity?-1:1;if(0<d){for(c=Math.floor(a.y/b)*b;0<d;)c-=b*e,d=this.getBrick({x:a.x,y:c});c+=b*e}else if(c=Math.floor(a.y/b)*b,0>e){for(;0<c&&!d;)c-=b,d=this.getBrick({x:a.x,y:c});d||(c=-a.height-b)}else{for(;c<a._stage.height&&!d;)c+=b,d=this.getBrick({x:a.x,y:c});d||(c=a._stage.height+a.height+b)}return c}};
Bricks.prototype.getHorizontalAngle=function(a){var b=this.fieldMap.brickSize,c=a.y-2*b,d=Object.assign({},a,{x:a.x-b,y:c});b=Object.assign({},a,{x:a.x+b,y:c});d=this.scanFloor(d);b=this.scanFloor(b);return Math.atan2(b-d,a.width)};
Bricks.prototype.isHit=function(a){if(!this.bricks)return!1;var b=this.getIndex(a);if(-1==b)return!1;var c=this.bricks.data[b+2];0<c&&(a.collidingWallType&Actor.CollidingWallType.EJECT&&a.eject(),a.collidingWallType&Actor.CollidingWallType.CRUSH&&a.fate());c==Bricks.BRICK_TYPE.BRITTLE&&a.collidingWallType&Actor.CollidingWallType.SMASH&&(this.bricks.data[b+2]=0,this.fieldMap._mainVisual.smash(a));return c};
Bricks.prototype.draw=function(a){if(this.bricks){var b=4*this.bricks.width,c=this.bricks.data,d=this.fieldMap.brickSize,e=.9*d,f=d/2,g=this.fieldMap.progress/this.fieldMap.scale-d;a.save();for(var h=0;h<this.bricks.height;h++)for(var k=h*b,l=h*d,p=0;p<b;p++,k+=4){var m=p*d,n=c[k+2];m<g||(n==Bricks.BRICK_TYPE.BRITTLE?(m+=f,n=l+f,a.beginPath(),a.arc(m,n,e/2,0,Math.PI2,!1),a.fill(),a.stroke()):0<n&&(a.fillRect(m,l,e,e),a.strokeRect(m,l,e,e)))}a.restore()}};Bricks.BRICK_TYPE={WALL:255,BRITTLE:254};
Bricks.SHIFT={DOWN:2,LEFT:4,RIGHT:6,UP:8};var Bullet=function(a,b){Actor.call(this,a,b);this.region=new Region(this,2);this.radius=3;this.speed=2;this.anim=new Animator("bullet");this.activityAreaType=Actor.ActivityAreaType.EJECT;this.collidingWallType=Actor.CollidingWallType.EJECT};$jscomp.inherits(Bullet,Actor);Bullet.DirType=Actor.DirType;Bullet.CollidingWallType=Actor.CollidingWallType;Bullet.ActivityAreaType=Actor.ActivityAreaType;Bullet.TypeList=Actor.TypeList;Bullet.Type=Actor.Type;
Bullet.DEG_STEP=Actor.DEG_STEP;Bullet.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Bullet.create=Actor.create;Bullet.prototype.move=function(a){Actor.prototype.move.call(this,a);this.radian+=Bullet.RAD_STEP};Bullet.RAD_STEP=Math.PI/180;var Capsule=function(){Actor.call(this,0,0,-1)};$jscomp.inherits(Capsule,Actor);Capsule.DirType=Actor.DirType;Capsule.CollidingWallType=Actor.CollidingWallType;Capsule.ActivityAreaType=Actor.ActivityAreaType;Capsule.TypeList=Actor.TypeList;Capsule.Type=Actor.Type;
Capsule.DEG_STEP=Actor.DEG_STEP;Capsule.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Capsule.prototype.move=function(a){Actor.prototype.move.call(this,a);this.region.isHit(a.region)&&this.fate(a)};Capsule.prototype.fate=function(a){"SpeedupCapsule"==this.className&&a.speedup();"MissileCapsule"==this.className&&a.powerUpMissile();this.eject()};Capsule.create=function(a,b){b=void 0===b?{}:b;return Object.assign(new Capsule,a,b).init()};
var Chamber=function(a,b,c,d){c=void 0===c?Number.MAX_SAFE_INTEGER:c;d=void 0===d?{}:d;this.type=a;this.cycle=b;this.max=c;this.opt=d;this.reset()};Chamber.prototype.reset=function(){this.tick=0;this.hands=[]};Chamber.prototype.probe=function(){var a=[];this.hands.forEach(function(b){b.isGone||a.push(b)});this.hands=a;this.tick++};
Chamber.prototype.fire=function(a,b){b=void 0===b?null:b;if(this.tick<this.cycle||this.max<=this.hands.length)return null;var c=new this.type(a.x,a.y,this.opt);if(b){var d=0;Product.Instance.stage.isMoving&&(d=a.calcDistance(b)/c.speed*Product.Instance.stage.fg.speed);c.dir=Math.atan2(b.y-a.y,b.x-a.x+d)}this.tick=0;this.hands.push(c);return c};var Controller=function(a){this.keys={};this.press={};this.point={};this.touch=!1;this.init(void 0===a?!1:a);Controller.Instance=this};
Controller.prototype.init=function(a){a||window.addEventListener("contextmenu",function(a){a.preventDefault()});this.initKeys();this.initPointingDevice()};Controller.prototype.initKeys=function(){var a=this;window.addEventListener("keydown",function(b){b.key?a.press[b.key]||(a.keys[b.key]=!0):a.keys["k"+b.keyCode]=!0});window.addEventListener("keyup",function(b){b.key?(delete a.keys[b.key],delete a.press[b.key]):delete a.keys["k"+b.keyCode]})};
Controller.prototype.initPointingDevice=function(){var a=this,b=document.getElementById("canvas"),c=function(){a.touch=!1;a.point=null;a.prev=null;a.move=null;a.delta=null};b.addEventListener("mousedown",function(b){a.touch=!0;a.point=FlexibleView.Instance.convert(b.clientX,b.clientY);a.prev=a.point;a.move=a.point;a.delta={x:0,y:0}});b.addEventListener("mousemove",function(b){a.move=FlexibleView.Instance.convert(b.clientX,b.clientY);a.touch&&(a.point=a.move,a.delta={x:a.point.x-a.prev.x,y:a.point.y-
a.prev.y})});b.addEventListener("mouseup",function(){return c()});b.addEventListener("mouseleave",function(){return c()});b.addEventListener("touchstart",function(b){var c=b.touches[0];a.touch=!0;a.point=FlexibleView.Instance.convert(c.pageX,c.pageY);b.preventDefault()});b.addEventListener("touchmove",function(b){b=b.touches[0];a.touch=!0;a.point=FlexibleView.Instance.convert(b.pageX,b.pageY)});b.addEventListener("touchend",function(){return c()})};
Controller.prototype.decPoint=function(a,b){this.prev.x+=a;this.prev.y+=b};Controller.prototype.isHit=function(a){return this.keys[a]?(delete this.keys[a],this.press[a]=!0):!1};var Enemy=function(a,b,c){Actor.call(this,a,b,void 0===c?0:c);this.radian=Math.PI;this.routine=null;this.routineCnt=this.routineIx=0;this.chamberList=[new Chamber(Bullet,Enemy.TRIGGER_CYCLE)]};$jscomp.inherits(Enemy,Actor);Enemy.DirType=Actor.DirType;Enemy.CollidingWallType=Actor.CollidingWallType;Enemy.ActivityAreaType=Actor.ActivityAreaType;
Enemy.TypeList=Actor.TypeList;Enemy.Type=Actor.Type;Enemy.DEG_STEP=Actor.DEG_STEP;Enemy.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Enemy.prototype.checkInverse=function(){if(this._stage&&this._stage.map){var a=this._stage.map,b=this.hH+a.brickSize/2,c=Object.assign({},this,{y:this.y-b});b=Object.assign({},this,{y:this.y+b});this.isInverse=a.bricks.isHit(c)&&!a.bricks.isHit(b)}};
Enemy.prototype.move=function(a){this.routine&&this.routine[this.routineIx].tick(this,a);var b=Actor.prototype.move.call(this,a);!(a instanceof Enemy)&&this.calcDistance(a)<Enemy.TRIGGER_ALLOWANCE&&(b=[]);return b};Enemy.getActor=function(a){return Enemy.LIST[a%Enemy.LIST.length]};Enemy.assign=function(a,b,c){a=Enemy.LIST[a%Enemy.LIST.length];if(!a)return null;a=Object.assign({},a);a.x=b;a.y=c;return a};Enemy.create=function(a,b){b=void 0===b?{}:b;return Object.assign(new Enemy,a,b).init()};
Enemy.TRIGGER_CYCLE=50;Enemy.TRIGGER_ALLOWANCE=100;Enemy.MAX_TYPE=127;Enemy.LIST=[];var Chain=function(a,b){Enemy.call(this,a,b);this.next=this.prev=null};$jscomp.inherits(Chain,Enemy);Chain.DirType=Enemy.DirType;Chain.CollidingWallType=Enemy.CollidingWallType;Chain.ActivityAreaType=Enemy.ActivityAreaType;Chain.TypeList=Enemy.TypeList;Chain.Type=Enemy.Type;Chain.DEG_STEP=Enemy.DEG_STEP;Chain.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Chain.LIST=Enemy.LIST;Chain.MAX_TYPE=Enemy.MAX_TYPE;
Chain.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Chain.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Chain.create=Enemy.create;Chain.assign=Enemy.assign;Chain.getActor=Enemy.getActor;Chain.prototype.eject=function(){console.log("Chain#eject:"+this.constructor.name);Enemy.prototype.eject.call(this);this.next&&this.next.eject()};Chain.prototype.unshift=function(a){a.next=this;if(a.prev=this.prev)this.prev.next=a;this.prev=a;return this};
Chain.prototype.push=function(a){a.prev=this;if(a.next=this.next)this.next.prev=a;this.next=a;return this};Chain.prototype.remove=function(){this.prev.next=this.next;this.next.prev=this.prev;return this.next};var Field=function(a){Matter.call(this);this.setRect(a.width,a.height);this.setupLandform(a);Field.Instance=this};$jscomp.inherits(Field,Matter);Field.prototype.setupLandform=function(a){this.landform=new Landform(a.canvas)};Field.MAX_ENEMIES=100;Field.ENEMY_CYCLE=10;
var FieldMap=function(){Matter.call(this);this.progressH=0;this._mainVisual=null};$jscomp.inherits(FieldMap,Matter);FieldMap.prototype.reset=function(){this.progressH=0;this.mapVisualList.forEach(function(a){return a.reset()});this.bricks=new Bricks(this)};FieldMap.prototype.scanFloor=function(a){return this.bricks.scanFloor(a)};FieldMap.prototype.getHorizontalAngle=function(a){return this.bricks.getHorizontalAngle(a)};FieldMap.prototype.checkHit=function(a){a.walled=this.bricks.isHit(a)};
FieldMap.prototype.setProgress=function(a){this.mapVisualList.forEach(function(b){return b.setProgress(a)})};FieldMap.prototype.addProgressH=function(a){var b=this._stage;this.progressH+=a;if(b.scroll==Stage.SCROLL.ON){a=-this._mainVisual.image.height+Product.Instance.height;if(0<this.progressH)return this.progressH=0,!1;if(this.progressH<a)return this.progressH=a,!1}return!0};FieldMap.prototype.draw=function(a){this.mapVisualList.forEach(function(b){return b.draw(a)})};
FieldMap.prototype.init=function(){var a=this,b=[];this.mapVisualList.forEach(function(c){c._fieldMap=a;c.isMain=c.seq==a.mainSeq;c.z=1E4*c.seq-1;var d=MapVisual.create(c);c.isMain&&(a._mainVisual=d);b.push(d)});this.mapVisualList=b;this.reset();return this};FieldMap.create=function(a){return"string"==typeof a?(new MapEntity).select(a).then(function(a){return FieldMap.create(a)}):Object.assign(new FieldMap,a).init()};
$jscomp.global.Object.defineProperties(FieldMap.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return-this._mainVisual.x}},y:{configurable:!0,enumerable:!0,get:function(){return-this._mainVisual.y}}});var MapVisual=function(){Matter.call(this);this.blink=this.speed=this.radian=this.repeat=0;this._imgName=this._img=null;this.isMain=!1;this.pattern=this.canvas=null;this.alpha=1;this.blinkDir=-1;this.effectV=this.effectH=0};$jscomp.inherits(MapVisual,Matter);
MapVisual.prototype.reset=function(){this.pattern=this.canvas=null};MapVisual.prototype.setProgress=function(a){var b=this.image.height,c=this._fieldMap._stage;this.x=c.posH+a*Math.cos(this.radian)*this.speed;this.y=(a*Math.sin(this.radian)*this.speed+this._fieldMap.progressH)%b;c&&(c.scroll==Stage.SCROLL.LOOP&&0<this.y&&(this.y-=b),!c.isVertical&&c.scroll==Stage.SCROLL.OFF|c.scroll==Stage.SCROLL.TOP&&0<this.y&&(this.y=0))};
MapVisual.prototype.getPattern=function(a){var b=this.image;null==this.canvas&&(this.canvas=document.createElement("canvas"),this.canvas.width=b.width,this.canvas.height=b.height,this.canvas.getContext("2d").drawImage(b,0,0));if(null==this.pattern){b="repeat";var c=this._fieldMap._stage;this.isMain&&c&&(b=c.scroll,b=b==Stage.SCROLL.OFF||b==Stage.SCROLL.ON?"repeat-x":"repeat");this.pattern=a.createPattern(this.canvas,b)}return this.pattern};
MapVisual.prototype.smash=function(a){var b=this.canvas.getContext("2d"),c=this._fieldMap.brickSize,d=parseInt(a.x/c)*c;a=parseInt(a.y/c)*c;b.clearRect(d,a,c,c);this.pattern=null};
MapVisual.prototype.draw=function(a){var b=this._fieldMap,c=b._mainVisual.image.height;a.save();a.translate(this.x+b.x,this.y+b.y);a.globalAlpha=this.alpha;b._stage&&b._stage._product.effector.effect(a);a.beginPath();a.fillStyle=this.getPattern(a);a.rect(-this.x,-this.y,a.canvas.width,c);a.fill();a.restore();this.blink&&(this.alpha+=this.blinkDir*this.blink,.3>=this.alpha||1<=this.alpha)&&(this.blinkDir*=-1)};
MapVisual.prototype.drawForDebug=function(a){var b=-this.x,c=10*this.seq;a.fillStyle="orange";a.beginPath();a.arc(b,c,5,0,Math.PI2);a.fill();a.fillStyle="pink";a.beginPath();a.arc(b+a.canvas.width,c,5,0,Math.PI2);a.fill()};MapVisual.prototype.init=function(){this.radian=this.deg/180*Math.PI;return this};MapVisual.create=function(a){return Object.assign(new MapVisual,a).init()};
$jscomp.global.Object.defineProperties(MapVisual.prototype,{image:{configurable:!0,enumerable:!0,get:function(){this._img||(this._img=this._fieldMap._mediaset.getImage(this));return this._img}},imageName:{configurable:!0,enumerable:!0,get:function(){this._imgName||(this._imgName=this._fieldMap._mediaset.getImageName(this));return this._imgName}}});
var FlexibleView=function(a,b){a=void 0===a?256:a;b=void 0===b?224:b;this.view=document.getElementById("view");this.canvas=document.getElementById("canvas");this.ctx=this.canvas.getContext("2d");this.scale=1;this.init();this.setSize(a,b);FlexibleView.Instance=this};FlexibleView.prototype.setSize=function(a,b){this.width=a;this.height=b;this.canvas.width=a;this.canvas.height=b;this.resize()};
FlexibleView.prototype.init=function(){var a=this,b=document.querySelector('[data-role="header"]'),c=document.querySelector('[data-role="footer"]');this.headerHeight=b?b.offsetHeight:0;this.footerHeight=c?c.offsetHeight:0;this.margin=this.headerHeight+this.footerHeight;window.addEventListener("resize",function(){a.resize()});window.addEventListener("keydown",function(){view.classList.contains("addicting")||view.classList.add("addicting")});window.addEventListener("mousemove",function(){view.classList.remove("addicting")})};
FlexibleView.prototype.resize=function(){var a=document.body.clientWidth/this.width,b=(window.innerHeight-this.margin)/this.height;this.scale=b<a?b:a;this.view.setAttribute("style",["width:"+this.width+"px","height:"+this.height+"px","transform: scale("+this.scale+")"].join(";"))};FlexibleView.prototype.convert=function(a,b){return{x:a/this.scale,y:(b-this.headerHeight)/this.scale}};FlexibleView.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)};
var Formation=function(a,b){Actor.call(this,a,b);this.count=this.steps=0;this.enemies=[]};$jscomp.inherits(Formation,Actor);Formation.DirType=Actor.DirType;Formation.CollidingWallType=Actor.CollidingWallType;Formation.ActivityAreaType=Actor.ActivityAreaType;Formation.TypeList=Actor.TypeList;Formation.Type=Actor.Type;Formation.DEG_STEP=Actor.DEG_STEP;Formation.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Formation.create=Actor.create;
Formation.prototype.setup=function(a,b){for(var c=0;c<b;c++){var d=new a(this.x,this.y);this.bonus||(this.bonus=this.score=10*d.score);this.enemies.push(d)}return this};Formation.prototype.isDestroyed=function(){var a=this,b=[];this.enemies.forEach(function(c){0!=c.hitPoint&&(b.push(c),a.x=c.x,a.y=c.y)});this.enemies=b;return 0==b.length&&0==this.explosion?(this.explosion=4*Actor.MAX_EXPLOSION,!0):!1};
Formation.prototype.move=function(a){Actor.prototype.move.call(this,a);this.isGone=0==this.enemies.filter(function(a){return!a.isGone}).length;if(this.enemies.length<=this.count){if(!this.isGone&&this.isDestroyed())return a=[SpeedupCapsule,MissileCapsule],[new (a[Math.floor(Math.random()*a.length)])(this)]}else if(0==this.steps++%Formation.STEP)return[this.enemies[this.count++]]};Formation.prototype.drawExplosion=function(a){a.fillStyle="rgba(240, 240, 255, .8)";a.fillText(this.bonus,0,0)};
Formation.STEP=10;var Landform=function(a){this.canvas=a;this.ctx=a.getContext("2d");this.effectH=0;this.next=Landform.NEXT.NONE;this.col=0;this.colDir=1;this.target=null;this.ty=this.tx=0;this.selection="b0";this.brickVal=this.brick=this.which=null;this.touch=!1;this.reverse=new Image;this.reverse.src="/img/reverse.png";this.touch=!1;this.scenarioList=[]};
Landform.prototype.loadStage=function(a){console.log("Landform#loadStage");var b=Field.Instance,c=a.fg.image;this.stage=a;a.mapData&&this.loadMapData(a.mapData);this.width=c.width;this.height=c.height;this.bw=this.width/Landform.BRICK_WIDTH;this.bh=this.height/Landform.BRICK_WIDTH;this.viewX=this.width-1.5*b.hW;this.arrivX=this.width-b.width;this.noticeX=this.arrivX-b.hW;this.reset()};
Landform.prototype.loadMapData=function(a){var b=this,c=new Image;c.onload=function(){var a=document.createElement("canvas"),e=a.getContext("2d");a.width=c.width;a.height=c.height;e.drawImage(c,0,0);b.brick=e.getImageData(0,0,c.width,c.height);b.loadScenario();b.touch=!0};c.src=a};Landform.prototype.loadScenario=function(){};Landform.prototype.reset=function(){this.next=Landform.NEXT.NONE};Landform.prototype.retry=function(){this.next=Landform.NEXT.NONE;Product.Instance.stage&&this.loadMapData(Product.Instance.stage.mapData)};
Landform.prototype.getBrickIndex=function(a){var b=Product.Instance.stage.fg,c=Math.round((b.x+a.x-Landform.BRICK_HALF)/Landform.BRICK_WIDTH);if(0>c||this.bw<c)return-1;a=Math.round((b.y+a.y-Landform.BRICK_HALF)/Landform.BRICK_WIDTH);a%=this.bh;return a*this.bw*4+4*c};Landform.prototype.getBrick=function(a,b){b=void 0===b?Landform.BRICK_LAYER.BRICK:b;if(!this.brick)return null;a=this.getBrickIndex(a);return 0>a?null:this.brick.data[a+b]};
Landform.prototype.getAttr=function(a){return this.getBrick(a,Landform.BRICK_LAYER.ATTR)};Landform.prototype.getActor=function(a){return this.getBrick(a,Landform.BRICK_LAYER.ACTOR)};Landform.prototype.putBrick=function(a,b,c){c=void 0===c?Landform.BRICK_LAYER.BRICK:c;a=this.getBrickIndex(a);0>a||(this.brick.data[a+c]=b,this.brick.data[a+3]=b?255:0)};
$jscomp.global.Object.defineProperties(Landform.prototype,{mapImage:{configurable:!0,enumerable:!0,get:function(){var a=document.createElement("canvas"),b=a.getContext("2d");a.width=this.brick.width;a.height=this.brick.height;b.putImageData(this.brick,0,0);return a.toDataURL("image/png")}}});Landform.BRICK_WIDTH=8;Landform.BRICK_HALF=Landform.BRICK_WIDTH/2;Landform.BRICK_LAYER={ATTR:0,ACTOR:1,BRICK:2};Landform.BRICK_TYPE={WALL:255,BRITTLE:254};Landform.ATTR={NONE:0,REVERSE:1};Landform.COL_MAX=512;
Landform.NEXT={NONE:0,NOTICE:1,ARRIV:2,IDLE:3,PAST:4};
Landform.prototype.effect=function(a){var b=Math.max(Product.Instance.width+a.width,a.maxX);a.effectH&&(a.x-=this.effectH);a.effectV&&this.next==Landform.NEXT.NONE&&(a.y+=Product.Instance.stage.effectV*Product.Instance.stage.fg.speed);(a.x<a.minX||b<a.x)&&a.eject();Product.Instance.stage.scroll==Stage.SCROLL.OFF?(a.y<a.minY||a.maxY<a.y)&&a.eject():Product.Instance.stage.scroll==Stage.SCROLL.ON?(a.y<-this.height||this.height+a.maxY<a.y)&&a.eject():a.gravity&&Landform.BRICK_WIDTH+Landform.BRICK_HALF<
Math.abs(a.dy*a.speed)?a.eject():0>a.y?a.y+=this.height:this.height<a.y&&(a.y-=this.height)};
Landform.prototype.forward=function(a){var b=Product.Instance.stage.map;this.next!=Landform.NEXT.ARRIV&&Product.Instance.stage.scrollV(a);if(this.viewX<=b.x)return this.effectH=0,this.next!=Landform.NEXT.PAST?this.next=Landform.NEXT.PAST:Landform.NEXT.NONE;Product.Instance.stage.forward();if(this.arrivX<=b.x){if(this.next==Landform.NEXT.NOTICE)return this.effectH=0,this.next=Landform.NEXT.ARRIV;if(this.arrivX<b.x)return this.next=Landform.NEXT.IDLE}else if(this.noticeX<=b.x&&this.next!=Landform.NEXT.NOTICE)return this.next=
Landform.NEXT.NOTICE;return Landform.NEXT.NONE};Math.PI2=Math.PI2||2*Math.PI;Math.SQ=Math.SQ||Math.PI/2;Math.trim=Math.trim||function(a){for(;Math.PI<a;)a-=Math.PI2;for(;a<-Math.PI;)a+=Math.PI2;return a};Math.close=Math.close||function(a,b,c){b=Math.trim(a-b);return Math.abs(b)<=c?a:0<b?a-c:a+c};var Integer=function(){};Integer.MIN_VALUE=-2147483648;function Matrix(a){this.mat=a}Matrix.NO_EFFECT=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];
Matrix.rotateX=function(a){return new Matrix([[1,0,0,0],[0,Math.cos(a),-Math.sin(a),0],[0,Math.sin(a),Math.cos(a),0],[0,0,0,1]])};Matrix.rotateY=function(a){return new Matrix([[Math.cos(a),0,Math.sin(a),0],[0,1,0,0],[-Math.sin(a),0,Math.cos(a),0],[0,0,0,1]])};Matrix.rotateZ=function(a){return new Matrix([[Math.cos(a),-Math.sin(a),0,0],[Math.sin(a),Math.cos(a),0,0],[0,0,1,0],[0,0,0,1]])};
Matrix.prototype.multiply=function(a){var b=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],c=a.mat;this.mat.forEach(function(a,e){a.forEach(function(d,g){for(var f=d=0;4>f;f++)d+=a[f]*c[f][g];b[e][g]=d})});return new Matrix(b)};Matrix.prototype.affine=function(a,b,c){var d=this.mat;return{x:d[0][0]*a+d[0][1]*b+d[0][2]*c+d[0][3],y:d[1][0]*a+d[1][1]*b+d[1][2]*c+d[1][3],z:d[2][0]*a+d[2][1]*b+d[2][2]*c+d[2][3]}};var Mediaset=function(){this.audioDic={};this.visualDic={};this._actorDic={}};
Mediaset.prototype.loadAudio=function(){var a=this;this.audioList.forEach(function(b){a.audioDic[b.audioSeq]=b;AudioMixer.INSTANCE.reserve(b.id,b.name)});return this};Mediaset.prototype.loadVisual=function(){var a=this;this.visualList.forEach(function(b){a.visualDic[b.visualSeq]=b;VisualManager.Instance.reserve(b.id,b.name,b.contentType)});return this};Mediaset.prototype.load=function(){return this.loadAudio().loadVisual()};
Mediaset.prototype.checkLoading=function(a){a=void 0===a?null:a;var b=[VisualManager.Instance,AudioMixer.INSTANCE],c=b.reduce(function(a,b){return a.max+b.max}),d=function(){var d=b.reduce(function(a,b){return a.loaded+b.loaded});a&&a(d,c)};return Promise.all([VisualManager.Instance.checkLoading(d),AudioMixer.INSTANCE.checkLoading(d)])};Mediaset.prototype.getAudioById=function(a){var b=null;this.audioList.forEach(function(c){c.id==a&&(b=c)});return b};Mediaset.prototype.getAudio=function(a){return this.audioDic[a]};
Mediaset.prototype.playBgm=function(a){(a=this.getAudio(a))&&AudioMixer.INSTANCE.play(a.id,.99,!0)};Mediaset.prototype.getVisual=function(a){var b=null;this.visualList.forEach(function(c){c.id==a&&(b=c)});return b};Mediaset.prototype.getVisualBySeq=function(a){var b=this.visualDic[a.visualSeq];if(null==b){var c=a.visualSeq.substr(0,12);b=Object.keys(this.visualDic).find(function(a){return a.substr(0,12)==c});if(b=this.visualDic[b])a.visualSeq=b.visualSeq}return b};
Mediaset.prototype.getImage=function(a){a=this.getVisualBySeq(a);return VisualManager.Instance.dic[a.id]};Mediaset.prototype.getImageName=function(a){return this.getVisualBySeq(a).name};Mediaset.prototype.getActor=function(a,b){b=void 0===b?{}:b;return(a=this._actorDic[a])?a.type==Actor.Type.Player?Ship.create(a,Object.assign(b)):a.type==Actor.Type.Item?Capsule.create(a,Object.assign(b)):Enemy.create(a,Object.assign(b)):null};
Mediaset.prototype.init=function(){var a=this;this.actorList.forEach(function(b){a._actorDic[b.seq]=b;a._actorDic[b.id]=b});this.actorList.forEach(function(b){return a._actorDic[b.seqOld]=b});return this};Mediaset.create=function(a){if("string"==typeof a)return(new MediasetEntity).select(a).then(function(a){return Mediaset.create(a)});Mediaset.Instance=Object.assign(new Mediaset,a).init();return Mediaset.Instance};Mediaset.Instance=null;var Visual=function(){};
Visual.TYPE={Player:0,Shot:1,Item:2,Aerial:3,Subaerial:4,Boss:5,Ornament:6,Explosion:7,Background:8,Foreground:9,Other:10};var Missile=function(a,b,c){Actor.call(this,a,b);this.dir=c.dir;this.radius=2;this.speed=3;this.gravity=c.gravity;this.activityAreaType=Actor.ActivityAreaType.EJECT;this.shuttle=3;this.fillStyle="rgba(200, 200, 255, 0.6)"};$jscomp.inherits(Missile,Actor);Missile.DirType=Actor.DirType;Missile.CollidingWallType=Actor.CollidingWallType;Missile.ActivityAreaType=Actor.ActivityAreaType;
Missile.TypeList=Actor.TypeList;Missile.Type=Actor.Type;Missile.DEG_STEP=Actor.DEG_STEP;Missile.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Missile.create=Actor.create;Missile.prototype.reactX=function(a){Actor.prototype.reactX.call(this,a);this.shuttle--;0>this.shuttle&&this.fate()};Missile.prototype.fate=function(){this.eject()};function Gizmo(a,b,c){this.type=a;this.destination=b;this.param=void 0===c?null:c}Gizmo.TYPE={FIXED:0,OWN:1,AIM:2,CHASE:3};
Gizmo.DEST={TO:0,TO_X:1,TO_Y:2,ROTATE:3,ROTATE_L:4,ROTATE_R:5,LEFT:6,RIGHT:7};
Gizmo.prototype.tick=function(a,b){if(this.type==Gizmo.TYPE.FIXED)this.destination==Gizmo.DEST.ROTATE?a.radian=a.dir:a.dir=null;else if(this.type==Gizmo.TYPE.OWN)this.destination==Gizmo.DEST.ROTATE_L?a.dir-=a.step:this.destination==Gizmo.DEST.ROTATE_R?a.dir+=a.step:this.destination==Gizmo.DEST.LEFT?a.dir=Math.PI:this.destination==Gizmo.DEST.RIGHT&&(a.dir=0);else{var c=b.x-a.x,d=b.y-a.y;Math.abs(c)<=a.speed&&(c=0);Math.abs(d)<=a.speed&&(d=0);this.type==Gizmo.TYPE.AIM?this.destination==Gizmo.DEST.TO_X?
a.radian=0>c?Math.PI:0:this.destination==Gizmo.DEST.TO_Y?a.radian=0>c?-Math.SQ:Math.SQ:this.destination==Gizmo.DEST.ROTATE&&(b=a.calcDistance(b),a.speed<b&&(a.radian=Math.close(a.radian,Math.atan2(d,c),this.param?this.param:Math.PI/30),a.radian=Math.trim(a.radian))):this.type==Gizmo.TYPE.CHASE&&(this.destination==Gizmo.DEST.TO?a.dir=Math.atan2(d,c):this.destination==Gizmo.DEST.TO_X&&c?a.dir=Math.atan2(0,c):this.destination==Gizmo.DEST.TO_Y&&d?a.dir=Math.atan2(d,0):this.destination==Gizmo.DEST.ROTATE&&
(a.dir=Math.close(a.dir,Math.atan2(d,c),this.param?this.param:Math.PI/60),a.radian=a.dir))}};function Movement(a){var b=parseInt(a);this.cond=a;this.count=b==a?b:null;this.list=[]}Movement.COND={X:"x",Y:"y"};Movement.prototype.add=function(a,b,c){this.list.push(new Gizmo(a,b,c));return this};
Movement.prototype.isValid=function(a,b){if(this.cond){if(this.count){if(a.routineCnt++<this.count)return!0;a.routineCnt=0;return!1}var c=b.x-a.x;b=b.y-a.y;return this.cond==Movement.COND.X&&Math.abs(c)<=a.speed||this.cond==Movement.COND.Y&&Math.abs(b)<=a.speed?!1:!0}};Movement.prototype.tick=function(a,b){this.list.forEach(function(c){c.tick(a,b)});this.isValid(a,b)||(a.routineIx++,a.routine.length<=a.routineIx&&(a.routineIx=0))};
var Product=function(){Matter.call(this);this.maxShip=7;this.maxHibernate=60;this.debugMode=!1;this.stageNum=this.hiscore=this.score=this.shipRemain=0;this.stage=null;this.effector=new StageEffector};$jscomp.inherits(Product,Matter);Product.prototype.calcPan=function(a){var b=this.width/2;return(a.x+this.stage.map._mainVisual.x-b)/b};
Product.prototype.startGame=function(){this.increase();this.loosingRate=Product.MAX_LOOSING_RATE;this.score=0;this.shipRemain=this.maxShip;this.stageNum=0;this.effector.reset();this.nextStage()};Product.prototype.increase=function(){(new ProductEntity).increase(this.id).then(function(a){console.log("Product#increase:"+a.ok)})};
Product.prototype.nextStage=function(){console.log("Product#nextStage:"+this.stageNum);var a=!this.stage,b=this.stageList[this.stageNum],c=a?[]:this.stage.removeMapVisual();this.stage=Stage.create(b,this);this.stage.performersList=c;this.stage.start(a);this.stageNum++;this.stageList.length<=this.stageNum&&(this.stageNum=0)};Product.prototype.selectStage=function(a){var b=this;this.stageList.forEach(function(c){c.id==a&&(b.stage=StageEditor.create(c,b))});this.stage.setupVisualList()};
Product.prototype.move=function(){var a=this;if(this.stage&&!Transition.Instance.waitForDrawing&&(this.stage.move(),this.effector.move(),!this.isGameOver)){this.stage.phase==Stage.PHASE.NEXT_STAGE&&this.nextStage();Product.MIN_LOOSING_RATE<this.loosingRate&&(this.loosingRate-=this.loosingRate/1E4);var b=this.stage.performersList.filter(function(a){return a instanceof Ship}),c=0<b.length?b[0]:new Actor,d=[],e=[],f=[],g=0;this.stage.performersList.forEach(function(h){if(!h.isGone){h instanceof Bullet?
b.forEach(function(a){return h.isHit(a)}):h instanceof Enemy?e.push(h):(h instanceof Shot||h instanceof Missile)&&d.push(h);var k=h.move(c);k instanceof Array&&k.forEach(function(b){b._stage=a.stage;f.push(b)});h.spawn&&h.spawn.length&&(h.spawn.forEach(function(b){b._stage=a.stage;f.push(b)}),h.spawn=[]);a.stage.effect(h);f.push(h);h.explosion&&h.score&&(g+=h.score,h.score=0)}});this.stage.effectMap(c);e.forEach(function(c){c.triggered=0==parseInt(Math.random()*a.loosingRate/10);b.forEach(function(a){return c.isHit(a)});
d.forEach(function(a){return c.isHit(a)})});this.stage.phase==Stage.PHASE.BOSS&&0==e.length&&(console.log("Defeated the boss."),this.stage.phase=Stage.PHASE.NORMAL,this.stage.scroll=this.stage.roll);this.stage.performersList=f;this.score+=g;this.stage.phase==Stage.PHASE.INIT||this.isGameOver||0!=b.length&&!b.every(function(a){return a.isGone})||(console.log("Product#move crash."),this.crashBgm==Product.CrashHandling.Bgm.Stop&&AudioMixer.INSTANCE.stop(),0>=--this.stage.hibernate&&0<--this.shipRemain&&
this.stage.retry())}};Product.prototype.draw=function(a){if(this.stage){a.save();a.translate(this.stage.fg.x,this.stage.fg.y);this.stage.draw(a);a.restore();var b=Controller.Instance;b&&b.isHit("d")&&(this.debugMode=!this.debugMode);this.debugMode&&this.drawForDebug(a)}};
Product.prototype.drawForDebug=function(a){var b=20,c=this.stage.performersList.filter(function(a){return!(a instanceof MapVisual)}),d=[],e=this.stage.map._mainVisual;c.forEach(function(a){!(10<=d.length)&&a instanceof Enemy&&d.push(a.className?a.className:a.constructor.name)});a.save();a.strokeStyle="white";a.strokeText("phase:"+this.stage.phase+"/scroll:"+this.stage.scroll+"/progress:"+parseInt(this.stage.progress),2,b+=20);a.strokeText("actors:"+c.length+(0<c.length?"|"+d.join(","):""),2,b+=20);
a.strokeText("map:"+parseInt(-e.x)+"/"+e.y,2,b+=20);var f=this.stage.performersList.filter(function(a){return a instanceof Ship});c=this.stage.performersList.find(function(a){return a instanceof Ship});a.strokeText("shipList:"+f.length,2,b+=20);c&&(f=parseInt(c.x+e.x),e=parseInt(c.y+e.y),a.strokeText("ship:"+f+"/"+e,2,b+=20));a.restore();if(a=Controller.Instance)a.isHit("n")?this.stage.phase=Stage.PHASE.NEXT_STAGE:a.isHit("s")&&this.shipRemain++};
Product.prototype.registerScore=function(){var a={product:{id:this.id},score:this.score,name:""};(new ScoreEntity).save(a).then(function(a){})};Product.prototype.init=function(){var a=this;this.setRect(this.width,this.height);this.stageList=this.stageList.map(function(b){return Stage.create(b,a)});0<this.scoreList.length&&(this.hiscore=this.scoreList[0].score);return this};
Product.load=function(a,b,c){return(new ProductEntity).select(a).then(function(a){a._mediaset=Mediaset.create(a.mediaset).load();a.mediaset={id:a._mediaset.id};return a._mediaset.checkLoading(b).then(function(){Product.Instance=Object.assign(new c,a);return Product.Instance.init()})})};Product.create=function(a,b){return Product.load(a,b,Product)};$jscomp.global.Object.defineProperties(Product.prototype,{isGameOver:{configurable:!0,enumerable:!0,get:function(){return 0>=this.shipRemain}}});
Product.Instance=null;Product.MIN_LOOSING_RATE=1;Product.MAX_LOOSING_RATE=2E4;Product.CrashHandling={Bgm:{Keep:0,Stop:1,Fade:2}};var Region=function(a,b,c){b=void 0===b?Region.DefaultSize:b;c=void 0===c?Region.Type.CIRCLE:c;this._matter=a;this._matter.regionSize||(this._matter.regionSize=b);this._matter.regionType||(this._matter.regionType=c)};
Region.prototype.isHit=function(a){var b=this._matter.regionSize;if(this._matter.regionType==Region.Type.CIRCLE&&a._matter.regionType==Region.Type.CIRCLE){var c=this._matter.x-a._matter.x,d=this._matter.y-a._matter.y;return Math.sqrt(c*c+d*d)<b+a._matter.regionSize}console.log("*Not implement*")};
Region.prototype.draw=function(a){var b=this._matter.regionType,c=this._matter.regionSize;a.save();a.strokeStyle="rgba(80, 255, 80, 0.6)";b==Region.Type.CIRCLE?(a.beginPath(),a.arc(0,0,c,0,Math.PI2,!1),a.stroke()):b==Region.Type.RECTANGLE&&(b=c/2,a.strokeRect(-c,-c,b,b));a.restore()};Region.DefaultSize=4;Region.Type={CIRCLE:0,RECTANGLE:1};var Scenario=function(){this._actor=null;this.hasFocus=!1};
Scenario.prototype.setPos=function(a){this.v=a.x;this.h=a.y;this._actor&&(this._actor.x=a.x,this._actor.y=a.y)};Scenario.prototype.includes=function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)<this._stage.map.brickSize/2};Scenario.prototype.isHit=function(a){var b=this.left+this.width,c=this.top+this.height;return this.left<=a.x&&a.x<=b&&this.top<=a.y&&a.y<=c};
Scenario.prototype.getText=function(){var a=[],b=this.op,c=this.name?":"+this.name:"";b+="("+this.x+","+this.y+")";a.push(b+c);this.type==Scenario.Type.Actor&&(this._actor.belongings&&a.push(this._actor.belongings.className),this.groupId&&a.push("group:"+this.groupId));return a};
Scenario.prototype.drawBalloon=function(a,b){a.font="bold "+Scenario.Balloon.TextHeight+"px serif";var c=this.getText(),d=c.reduce(function(a,b){return a.length<b.length?b:a});d=a.measureText(d).width+8;var e=24*c.length,f=b.x-d/2,g=b.y-e-Scenario.Balloon.Margin,h=b.limit.right-d,k=b.limit.top;f<b.limit.left?f=b.limit.left:h<f&&(f=h);g<k&&(g=k);a.fillStyle="white";a.strokeStyle="black";a.fillRect(f,g,d,e);a.strokeRect(f,g,d,e);a.fillStyle="black";a.textBaseline="top";g+=4;c.forEach(function(b){a.fillText(b,
f+4,g);g+=Scenario.Balloon.TextHeight})};
Scenario.prototype.draw=function(a){var b=this.width,c=this.height,d=this.x,e=this.y;this.hasFocus&&(a.strokeStyle="rgba(0, 0, 0, .5)",a.strokeRect(d,e,b,c),a.strokeStyle="rgba(255, 255, 255, .5)",a.strokeRect(d+1,e+1,b-2,c-2));this.type==Scenario.Type.Mode?(a.fillStyle="rgba(255, 100, 100, .5)",a.fillRect(d+2,e+2,b-4,c-4)):this.type==Scenario.Type.Effect?(a.fillStyle="rgba(100, 255, 100, .5)",a.fillRect(d+2,e+2,b-4,c-4)):this.type==Scenario.Type.Audio&&(a.fillStyle="rgba(100, 100, 255, .5)",a.fillRect(d+
2,e+2,b-4,c-4))};Scenario.prototype.getActor=function(a){return this._stage._product._mediaset.getActor(a,{x:this.x,y:this.y,_stage:this._stage})};Scenario.prototype.addBelongings=function(a,b){b=void 0===b?this._actor:b;a&&"0"!=a&&(b.belongings=this.getActor(a))};Scenario.prototype.assignActor=function(){var a=this.getActor(this.number);this.addBelongings(this.belongings,a);return a};
Scenario.prototype.calcRegion=function(){var a=this._stage,b=a.map.brickSize,c=b/2;a.isVertical?(this.x=this.h,this.y=8==a.orientation?a.height-this.v:this.v,this.left=this.x,this.top=this.y-c,this.width=a._product.width,this.height=b):(this.x=this.v,this.y=this.h,this.left=this.x-c,this.top=this.y,this.width=b,this.height=a._product.height)};
Scenario.prototype.init=function(){var a=this._stage;if(this.cursor){var b=this.cursor;a.isVertical?(this.h=b.x,this.v=8==a.orientation?a.height-b.y:b.y):(this.h=b.y,this.v=b.x)}this.calcRegion();null==this.groupId&&(this.groupId="");this.type==Scenario.Type.Actor&&(this._actor=this.assignActor(),this.name=this._actor.className);"Apl"==this.op&&(a=this._stage._product._mediaset.getAudio(this.number))&&(this.name=a.name);return this};
Scenario.create=function(a,b){b=void 0===b?null:b;a.type=Scenario.TypeMap[a.op];return"Frm"==a.op?Object.assign(new ScenarioGroup,a,{_stage:b}).init():a.type==Scenario.Type.Actor?Object.assign(new ScenarioActor,a,{_stage:b}).init():Object.assign(new Scenario,a,{_stage:b}).init()};var ScenarioActor=function(){Scenario.call(this)};$jscomp.inherits(ScenarioActor,Scenario);ScenarioActor.create=Scenario.create;
ScenarioActor.prototype.isHit=function(a){var b=this.x,c=this.y,d=this._actor.width/2,e=this._actor.height/2;return b-d<=a.x&&a.x<=b+d&&c-e<=a.y&&a.y<=c+e};
ScenarioActor.prototype.draw=function(a){var b=this._stage.map.brickSize,c=b/2;if(this._actor){b=this.x-this._actor.hW;var d=this.y-this._actor.hH;this._actor.type==Actor.Type.Subaerial&&this._actor.checkInverse();this._actor.draw(a);this._actor.belongings&&(a.strokeStyle="rgba(255, 80, 80, 0.9)",a.strokeRect(b,d,this._actor.width,this._actor.height));a.fillStyle="Spw"==this.op?"#ffa500":"#ff6347";a.beginPath();a.arc(this.x,this.y,c/2,0,Math.PI2);a.fill();this.hasFocus&&(a.fillStyle="rgba(255, 255, 255, 0.3)",
a.fillRect(b,d,this._actor.width,this._actor.height),a.strokeStyle="rgba(255, 255, 255, 0.6)",a.strokeRect(b,d,this._actor.width,this._actor.height))}else a.strokeStyle="rgba(255, 0, 0, 0.9)",a.strokeRect(this.x-c,this.y-c,b,b)};var ScenarioGroup=function(){Scenario.call(this)};$jscomp.inherits(ScenarioGroup,Scenario);ScenarioGroup.create=Scenario.create;ScenarioGroup.prototype.isHit=function(a){var b=this.x-a.x;a=this.y-a.y;return 4>Math.sqrt(b*b+a*a)};
ScenarioGroup.prototype.draw=function(a){a.save();a.translate(this.x,this.y);a.beginPath();a.arc(0,0,4,0,Math.PI2);a.fillStyle="rgba(80, 255, 80, 0.5)";a.fill();a.restore()};ScenarioGroup.prototype.assign=function(){return ActorGroup.create(this)};Scenario.Balloon={TextHeight:16,Margin:4,Padding:4};Scenario.Type={Actor:0,Mode:1,Effect:2,Audio:3};Scenario.TypeList=[["Spw","Rev"],["Ent","Ckp","Bos","Stp","Nxt"],["Efi","Efo"],["Apa","Are","Afa","Apl"]];Scenario.TypeMap={};
Scenario.TypeList.forEach(function(a,b){return a.forEach(function(a){return Scenario.TypeMap[a]=b})});var Ship=function(a,b){Actor.call(this,void 0===a?0:a,void 0===b?0:b);this.activityAreaType=Actor.ActivityAreaType.RESTRICTION;this.effectH=!0;this.reset()};$jscomp.inherits(Ship,Actor);Ship.DirType=Actor.DirType;Ship.CollidingWallType=Actor.CollidingWallType;Ship.ActivityAreaType=Actor.ActivityAreaType;Ship.TypeList=Actor.TypeList;Ship.Type=Actor.Type;Ship.DEG_STEP=Actor.DEG_STEP;
Ship.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Ship.prototype.reset=function(){this.speed=Ship.MIN_SPEED;this.triggered=!1;this.chamberList=[new Chamber(Shot,4,Ship.MAX_SHOTS)];this.chamberList.forEach(function(a){return a.reset()});this.missileLevel=0};Ship.prototype.speedup=function(){this.speed*=1.25;Ship.MAX_SPEED<this.speed&&(this.speed=Ship.MAX_SPEED)};
Ship.prototype.powerUpMissile=function(){this.missileLevel++;1==this.missileLevel?this.chamberList.push(new Chamber(Missile,16,2,{gravity:.05,dir:0})):2==this.missileLevel?this.chamberList.push(new Chamber(Missile,16,2,{gravity:-.05,dir:0})):3==this.missileLevel&&(this.chamberList.push(new Chamber(Missile,16,2,{gravity:.05,dir:Math.PI})),this.chamberList.push(new Chamber(Missile,16,2,{gravity:-.05,dir:Math.PI})))};
Ship.prototype.inkey=function(a){var b=!1,c=0;if(a.ArrowLeft||a.Left||a.k37)c=1,b=!0;else if(a.ArrowRight||a.Right||a.k39)c=-1,b=!0;if(a.ArrowUp||a.Up||a.k38)c=2-.5*c,b=!0;else if(a.ArrowDown||a.Down||a.k40)c*=.5,b=!0;b&&(this.dir=(c+1)*Math.SQ);if(a.Control||a.Shift||a.k16||a.k17)this.triggered=!0};
Ship.prototype.move=function(){this.dir=null;this.aim(Controller.Instance.point);this.inkey(Controller.Instance.keys);Controller.Instance.touch&&(this.triggered=!0);var a=Actor.prototype.move.call(this);if(!this.isGone)if(this.walled)this.fate();else return a};
Ship.prototype.init=function(){console.log("Ship#init");Actor.prototype.init.call(this);if(0<this.actorVisualList.length){var a=this.actorVisualList[0];console.log("Ship#init seq:"+a.visualSeq+"visual:"+a.visual.id);this.anim=new Animator("prototype.ship",Animator.TYPE.V,1,2*Ship.PATTERNS+1)}return this};Ship.create=function(a,b){b=void 0===b?{}:b;return Object.assign(new Ship,a,b).init()};Ship.MIN_SPEED=1.5;Ship.MAX_SPEED=5;Ship.MAX_SHOTS=7;Ship.PATTERNS=2;
var Shot=function(a,b){Actor.call(this,a,b);this.dir=0;this.radius=2;this.speed=6;this.size=2;this.activityAreaType=Actor.ActivityAreaType.EJECT;this.collidingWallType=Actor.CollidingWallType.SMASH_CRUSH;this.fillStyle="rgba(255, 255, 0, 0.7)";a=Product.Instance.calcPan(this);AudioMixer.INSTANCE.play("sfx-fire",.4,!1,a)};$jscomp.inherits(Shot,Actor);Shot.DirType=Actor.DirType;Shot.CollidingWallType=Actor.CollidingWallType;Shot.ActivityAreaType=Actor.ActivityAreaType;Shot.TypeList=Actor.TypeList;
Shot.Type=Actor.Type;Shot.DEG_STEP=Actor.DEG_STEP;Shot.MAX_EXPLOSION=Actor.MAX_EXPLOSION;Shot.create=Actor.create;Shot.prototype.fate=function(){this.eject()};var Stage=function(){this.foreground=null;this.viewDic={};this.lastScan=null;this.performersList=[]};Stage.prototype.setupVisualList=function(){var a=this;this.map.mapVisualList.forEach(function(b){return a.performersList.push(b)})};
Stage.prototype.start=function(a){var b=this;console.log("Stage#start :"+a);if(a)this._product._mediaset.playBgm(this.startAudioSeq),Transition.Instance.play(this.startTransition,this.startSpeed);else{var c=this.margin;this.performersList.forEach(function(a){a.x-=c.left;a._stage=b});this._product._mediaset.playBgm(this.sequelAudioSeq)}this.setupVisualList()};
Stage.prototype.retry=function(){console.log("Stage#retry!");this.reset(Stage.PHASE.NORMAL);this.performersList.push(this.checkPoint.retrieve());Transition.Instance.play(this.startTransition,this.startSpeed);Product.Instance.crashBgm!=Product.CrashHandling.Bgm.Keep&&this._product._mediaset.playBgm(this.startAudioSeq)};
Stage.prototype.scrollV=function(){var a=this.performersList.find(function(a){return a instanceof Ship});this.effectV=0;if(a&&this.scroll!=Stage.SCROLL.OFF){var b=this._product.hH-a.y;a=this.fg;if(this.scroll==Stage.SCROLL.TOP)b=5*a.speed;else if(this.scroll==Stage.SCROLL.BOTTOM)b=5*-a.speed;else if(Math.abs(b)<a.speed)return;b/=3;var c=a.y-b,d=a.image.height-this._product.height;if(this.scroll!=Stage.SCROLL.ON||!(0>c||d<c))if(this.scroll==Stage.SCROLL.TOP&&0>c)this.scroll=Stage.SCROLL.OFF;else{if(this.scroll==
Stage.SCROLL.BOTTOM&&(console.log("nextY:"+c+"/"+a.image.height),d<c)){this.scroll=Stage.SCROLL.OFF;return}this.effectV=b}}};Stage.prototype.effect=function(a){var b=this.map._mainVisual;if(!(a instanceof MapVisual)){if(this.isMoving){if(this.isLoop){var c=b.y+a.y;0>c&&(a.y+=this.height);this.height<c&&(a.y-=this.height)}a.effectH&&(a.x-=Math.cos(b.radian)*b.speed);a.effectV&&(a.y-=Math.sin(b.radian)*b.speed)}!this._product.effector.isBrickVisible&&a instanceof Ship||this.map.checkHit(a)}};
Stage.prototype.effectMap=function(a){var b=this.map._mainVisual,c=b.image.height;b=(a.y+b.y+c)%c;c=this._product.hH/2;var d=this._product.height-c;this.scroll&(Stage.SCROLL.ON|Stage.SCROLL.LOOP)&&(b<c&&this.map.addProgressH(a.speed)&&(a.y+=a.speed),d<b&&this.map.addProgressH(-a.speed)&&(a.y-=a.speed))};
Stage.prototype.scanEvent=function(){var a=this,b=[],c=parseInt(-this.map._mainVisual.x);if(c==this.lastScan)return b;var d=c+this._product.width;this._eventList=this._eventList.filter(function(e){if(d<e.x)return!0;if(e.x<c)return!1;e.isFront=c<e.x;var f=a.executeEvent(e);if(f)return f instanceof Actor&&b.push(f),!1;if(!("Spw"==e.op&&e.x<=d||"Rev"==e.op&&e.x<=c))return!0;f=e.assignActor();if(!(f instanceof Ship))try{f=new (eval(f.className))(e.x,e.y),f.belongings=e._belongings,f._stage=a}catch(g){}"Rev"==
e.op&&(f.dir+=Math.PI);a._groupMap[e.groupId]&&a._groupMap[e.groupId].add(f);f instanceof Ship&&(a.phase=Stage.PHASE.NORMAL);b.push(f);return!1});this.lastScan=c;return b};
Stage.prototype.executeEvent=function(a){var b=a.op;return"Ent"==b?(b=this.performersList.find(function(a){return a instanceof Ship}),this.phase=Stage.PHASE.NORMAL,this.checkPoint.enter({x:a.x,y:104}),b?!0:this.checkPoint.retrieve()):"Ckp"!=b||a.isFront?"Bos"==b?(this.phase=Stage.PHASE.BOSS,!0):"Stp"==b?(this.scroll=Stage.SCROLL.STOP,!0):"Nxt"==b?(this.phase=Stage.PHASE.NEXT_STAGE,!0):"Efi"==b||"Efo"==b?(this._product.effector.start(b),!0):"Afa"==b?(AudioMixer.INSTANCE.fade(),!0):"Apl"==b?(this._product._mediaset.playBgm(a.number),
!0):"Frm"==b?(b=a.assign(),this._groupMap[a.groupId]=b):!1:(this.checkPoint.update(),!0)};Stage.prototype.notice=function(){if(this.scroll==Stage.SCROLL.ON||this.scroll==Stage.SCROLL.LOOP){var a=this.fg;this.scroll=a.y<a.image.height/2?Stage.SCROLL.TOP:Stage.SCROLL.BOTTOM}};
Stage.prototype.removeMapVisual=function(){var a=this;this.performersList.forEach(function(b){b.x+=a.map._mainVisual.x;b.y+=a.map._mainVisual.y});return this.performersList=this.performersList.filter(function(a){return!(a instanceof MapVisual)})};Stage.prototype.calclatePositions=function(){};
Stage.prototype.move=function(){var a=this;this.calclatePositions();this.scanEvent().forEach(function(b){return a.performersList.push(b)});this.performersList.sort(function(a,b){return a.z-b.z});if(this.scroll!=Stage.SCROLL.STOP){var b=this.map._mainVisual,c=this.length;this.scrollV();this.map.setProgress(this.progress++);c<-b.x&&(console.log("Stage#move over:"+-b.x+"/max:"+c),this.performersList.forEach(function(a){return a.x+=b.x}),this.progress=this.startProgress,this.map.setProgress(this.progress))}};
Stage.prototype.draw=function(a){Transition.Instance.draw();this.performersList.forEach(function(b){return b.draw(a)})};Stage.prototype.createFieldMap=function(){return FieldMap.create(this.map)};
Stage.prototype.reset=function(a){var b=this;a=void 0===a?Stage.PHASE.INIT:a;console.log("Stage#reset:"+a);this.phase=a;this.hibernate=this._product.maxHibernate;this.scroll=this.roll;this.effectV=this.effectH=0;this.map.reset();this.map.setProgress(this.progress);this._eventList=this.scenarioList.map(function(a){return Scenario.create(a,b)});this._groupMap={};this.performersList=this.performersList.filter(function(a){return a instanceof MapVisual});this._product.effector.reset()};
Stage.prototype.initGroupDict=function(){var a={};this.scenarioList.forEach(function(b){b.count=0;"Frm"==b.op&&(a[b.groupId]=b)});this.scenarioList.forEach(function(b){b.groupId&&"Frm"!=b.op&&a[b.groupId].count++})};Stage.prototype.init=function(){this.map._stage=this;this.map._mediaset=this._product._mediaset;this.map=this.createFieldMap();this.initGroupDict();this.progress=this.startProgress;this.reset();this.checkPoint=new CheckPoint(this);return this};
Stage.create=function(a,b){return Object.assign(new (2==a.orientation?Stage:4==a.orientation?Stage:6==a.orientation?StageGoToTheRight:StageGoUp),a,{_product:b}).init()};
$jscomp.global.Object.defineProperties(Stage.prototype,{isVertical:{configurable:!0,enumerable:!0,get:function(){return 2==this.orientation||8==this.orientation}},isMoving:{configurable:!0,enumerable:!0,get:function(){return this.scroll!=Stage.SCROLL.STOP}},fg:{configurable:!0,enumerable:!0,get:function(){this.foreground||(this.foreground=this.map._mainVisual);return this.foreground}},length:{configurable:!0,enumerable:!0,get:function(){return this.map._mainVisual.image.width*this.repeat}},width:{configurable:!0,
enumerable:!0,get:function(){return this.map._mainVisual.image.width}},height:{configurable:!0,enumerable:!0,get:function(){return this.map._mainVisual.image.height}},isLoop:{configurable:!0,enumerable:!0,get:function(){return this.scroll==Stage.SCROLL.LOOP}},margin:{configurable:!0,enumerable:!0,get:function(){return this.isVertical?{left:0,top:0}:{left:this._product.hW*this.posV,top:this.roll==Stage.SCROLL.OFF||this.roll==Stage.SCROLL.ON?this._product.height:0}}},startProgress:{configurable:!0,
enumerable:!0,get:function(){return-this.margin.left/this.map._mainVisual.speed}}});var StageGoUp=function(){Stage.call(this);console.log("StageGoUp#constructor")};$jscomp.inherits(StageGoUp,Stage);StageGoUp.create=Stage.create;var StageGoToTheRight=function(){Stage.call(this);console.log("StageGoToTheRight#constructor")};$jscomp.inherits(StageGoToTheRight,Stage);StageGoToTheRight.create=Stage.create;Stage.SCROLL={OFF:0,ON:1,LOOP:2,TOP:4,BOTTOM:8,STOP:16};Stage.PHASE={INIT:0,NORMAL:1,BOSS:2,NEXT_STAGE:3};
var CheckPoint=function(a){this._stage=a;this.dy=this.dx=0;this.update()};CheckPoint.prototype.enter=function(a){this.update();this.dx=a.x-this.x;this.dy=a.y-this.y};CheckPoint.prototype.update=function(){this.progress=this._stage.progress;this.x=-this._stage.map._mainVisual.x;this.y=100;console.log("CheckPoint#update progress:"+this.progress)};
CheckPoint.prototype.retrieve=function(){console.log("CheckPoint#retrieve*************");var a=new Ship(this.x+this.dx,this.y+this.dy);this._stage.progress=this.progress;this._stage.map.setProgress(this.progress);a._stage=this._stage;return a};var StageEffector=function(){this.reset()};StageEffector.prototype.reset=function(){this.op=null;this.progress=0;this.isBrickVisible=this.isVisible=!0};
StageEffector.prototype.start=function(a){if("Efi"!=a||!this.isVisible){if("Efo"==a){if(!this.isVisible)return;this.isBrickVisible=!1}this.op=a;this.progress=0}};StageEffector.prototype.move=function(){this.op&&(StageEffector.MaxProgress<=this.progress?this.isBrickVisible=this.isVisible="Efi"==this.op:this.progress++)};
StageEffector.prototype.effect=function(a){this.op&&("Efi"==this.op?a.filter="brightness("+this.progress/StageEffector.MaxProgress+")":"Efo"==this.op&&(a.filter="brightness("+(StageEffector.MaxProgress-this.progress)/StageEffector.MaxProgress+")"))};
StageEffector.prototype.draw=function(a){var b=this.progress/StageEffector.MaxProgress;a.save();a.fillStyle="rgba(255, 0, 255, "+b+")";a.beginPath();a.arc(this.x,100,this.progress,0,Math.PI2);a.fill();a.restore();this.progress++;StageEffector.MaxProgress<this.progress&&(this.progress=0)};StageEffector.MaxProgress=200;var Transition=function(){this.type=Transition.Type.Off};
Transition.prototype.reset=function(){var a=document.getElementById("canvas");this.transition=document.getElementById("transition");this.ctx=this.transition.getContext("2d");this.transition.width=a.width;this.transition.height=a.height;this.waitForDrawing=!1;this.top=this.left=this.y=this.x=this.progress=0};Transition.prototype.play=function(a,b){this.reset();this.type=a;this.speed=b;this.type==Transition.Type.Spiral&&(this.playSpiral(8),this.waitForDrawing=!0)};
Transition.prototype.playSpiral=function(a){this.direction=Transition.Direction.Right;this.right=a-1;this.bottom=a-1;this.pattern=document.createElement("canvas");this.pattern.width=a;this.pattern.height=a;a=this.pattern.getContext("2d");a.fillStyle="black";a.fillRect(0,0,this.pattern.width,this.pattern.width)};
Transition.prototype.draw=function(){this.type!=Transition.Type.Off&&(this.ctx.save(),this.ctx.clearRect(0,0,this.transition.width,this.transition.height),this.type==Transition.Type.Spiral&&this.drawSpiral(),this.ctx.restore())};
Transition.prototype.drawSpiral=function(){for(var a=this.pattern.getContext("2d"),b=0;b<this.speed;b++)a.clearRect(this.x,this.y,1,1),this.direction==Transition.Direction.Right?(this.x++,this.right<=this.x&&(this.right--,this.direction=Transition.Direction.Down)):this.direction==Transition.Direction.Down?(this.y++,this.bottom<=this.y&&(this.bottom--,this.direction=Transition.Direction.Left)):this.direction==Transition.Direction.Left?(this.x--,this.x<=this.left&&(this.left++,this.direction=Transition.Direction.Up)):
this.direction==Transition.Direction.Up&&(this.y--,this.y<=this.top&&(this.top++,this.direction=Transition.Direction.Right));this.bottom<this.top&&this.right<this.left?(this.type=Transition.Type.Off,this.waitForDrawing=!1):(this.ctx.fillStyle=this.ctx.createPattern(this.pattern,"repeat"),this.ctx.fillRect(0,0,this.transition.width,this.transition.height))};Transition.Type={Off:0,BlackIn:1,WhiteIn:2,Spiral:3,Iris:4};Transition.Direction={Right:0,Down:1,Left:2,Up:3};Transition.Instance=new Transition;
var VisualManager=function(){Repository.call(this)};$jscomp.inherits(VisualManager,Repository);VisualManager.prototype.makeName=function(a){return"/visual/src/"+a};VisualManager.prototype.load=function(a,b,c){var d=this;if(c.startsWith("image")){var e=new Image;this.max++;e.onload=function(){d.onload(a,b,e)};e.src=this.makeName(a)}else Repository.prototype.load.call(this,a,b,c)};VisualManager.Instance=new VisualManager;
var Battery_bk=function(a,b){Enemy.call(this,a,b);this.speed=0;this.hitPoint=1;this.score=10;this.anim=[new Animator("enemy.battery"),new Animator("enemy.batteryBase",Animator.TYPE.NONE)];this.routine=[(new Movement).add(Gizmo.TYPE.AIM,Gizmo.DEST.ROTATE).add(Gizmo.TYPE.FIXED,Gizmo.DEST.TO)];this.activityAreaType=Actor.ActivityAreaType.EJECT;this.checkInverse()};$jscomp.inherits(Battery_bk,Enemy);Battery_bk.DirType=Enemy.DirType;Battery_bk.CollidingWallType=Enemy.CollidingWallType;
Battery_bk.ActivityAreaType=Enemy.ActivityAreaType;Battery_bk.TypeList=Enemy.TypeList;Battery_bk.Type=Enemy.Type;Battery_bk.DEG_STEP=Enemy.DEG_STEP;Battery_bk.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Battery_bk.LIST=Enemy.LIST;Battery_bk.MAX_TYPE=Enemy.MAX_TYPE;Battery_bk.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Battery_bk.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Battery_bk.create=Enemy.create;Battery_bk.assign=Enemy.assign;Battery_bk.getActor=Enemy.getActor;
Battery_bk.prototype.drawNormal=function(a){this.isInverse?this.radian<-Math.SQ?this.radian=Math.PI:0>this.radian&&(this.radian=0):Math.SQ<this.radian?this.radian=Math.PI:0<this.radian&&(this.radian=0);Enemy.prototype.drawNormal.call(this,a)};
var Charger=function(a,b){Enemy.call(this,a,b);this.speed=2.5;this.hitPoint=1;this.score=10;this.activityAreaType=Actor.ActivityAreaType.EJECT;this.anim=new Animator("enemy.charger");this.routine=[(new Movement(Movement.COND.Y)).add(Gizmo.TYPE.AIM,Gizmo.DEST.TO_Y).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO_Y),(new Movement(10)).add(Gizmo.TYPE.AIM,Gizmo.DEST.TO_X).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO_X),(new Movement(1E3)).add(Gizmo.TYPE.OWN,Gizmo.DEST.TO)]};$jscomp.inherits(Charger,Enemy);Charger.DirType=Enemy.DirType;
Charger.CollidingWallType=Enemy.CollidingWallType;Charger.ActivityAreaType=Enemy.ActivityAreaType;Charger.TypeList=Enemy.TypeList;Charger.Type=Enemy.Type;Charger.DEG_STEP=Enemy.DEG_STEP;Charger.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Charger.LIST=Enemy.LIST;Charger.MAX_TYPE=Enemy.MAX_TYPE;Charger.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Charger.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Charger.create=Enemy.create;Charger.assign=Enemy.assign;Charger.getActor=Enemy.getActor;
var Crab=function(a,b){Enemy.call(this,a,b);this.hasBounds=!1;this.gravity=.3;this.reaction=.4;this.speed=2;this.hitPoint=1;this.score=90;this.activityAreaType=Actor.ActivityAreaType.EJECT;this.anim=new Animator("enemy.crab",Animator.TYPE.X|Animator.TYPE.ROTATION,8,1);this.routine=[(new Movement(Movement.COND.X)).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO_X),(new Movement(Crab.WALK)).add(Gizmo.TYPE.OWN,Gizmo.DEST.RIGHT),(new Movement(Movement.COND.X)).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO_X),(new Movement(Crab.WALK)).add(Gizmo.TYPE.CHASE,
Gizmo.DEST.LEFT)]};$jscomp.inherits(Crab,Enemy);Crab.DirType=Enemy.DirType;Crab.CollidingWallType=Enemy.CollidingWallType;Crab.ActivityAreaType=Enemy.ActivityAreaType;Crab.TypeList=Enemy.TypeList;Crab.Type=Enemy.Type;Crab.DEG_STEP=Enemy.DEG_STEP;Crab.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Crab.LIST=Enemy.LIST;Crab.MAX_TYPE=Enemy.MAX_TYPE;Crab.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Crab.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Crab.create=Enemy.create;Crab.assign=Enemy.assign;Crab.getActor=Enemy.getActor;
Crab.WALK=20;var DragonBody=function(a,b){Enemy.call(this,a,b);this.region=new Region(this,16);this.hasBounds=!1;this.hitPoint=Number.MAX_SAFE_INTEGER;this.score=0;this.anim=new Animator("enemy.dragonBody")};$jscomp.inherits(DragonBody,Enemy);DragonBody.DirType=Enemy.DirType;DragonBody.CollidingWallType=Enemy.CollidingWallType;DragonBody.ActivityAreaType=Enemy.ActivityAreaType;DragonBody.TypeList=Enemy.TypeList;DragonBody.Type=Enemy.Type;DragonBody.DEG_STEP=Enemy.DEG_STEP;
DragonBody.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;DragonBody.LIST=Enemy.LIST;DragonBody.MAX_TYPE=Enemy.MAX_TYPE;DragonBody.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;DragonBody.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;DragonBody.create=Enemy.create;DragonBody.assign=Enemy.assign;DragonBody.getActor=Enemy.getActor;$jscomp.global.Object.defineProperties(DragonBody.prototype,{triggered:{configurable:!0,enumerable:!0,get:function(){return!1}}});
var DragonHead=function(a,b){Enemy.call(this,a,b);this.region=new Region(this,16);this.x=0<this.x?this.x+50:this.x-50;this.hasBounds=!1;this.speed=.9;this.hitPoint=200;this.score=1E4;this.radian=Math.PI;this.appears=!1;this.anim=new Animator("enemy.dragonHead");this.locus=[];this.body=[];for(a=0;a<DragonHead.CNT_OF_BODY*DragonHead.STP_OF_BODY;a++)this.locus.push({x:this.x,y:this.y,radian:this.radian}),0==a%DragonHead.STP_OF_BODY&&(b=new DragonBody(this.x,this.y),this.body.push(b));this.chamberList=
[new Chamber(TitanShot,80,1)]};$jscomp.inherits(DragonHead,Enemy);DragonHead.DirType=Enemy.DirType;DragonHead.CollidingWallType=Enemy.CollidingWallType;DragonHead.ActivityAreaType=Enemy.ActivityAreaType;DragonHead.TypeList=Enemy.TypeList;DragonHead.Type=Enemy.Type;DragonHead.DEG_STEP=Enemy.DEG_STEP;DragonHead.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;DragonHead.LIST=Enemy.LIST;DragonHead.MAX_TYPE=Enemy.MAX_TYPE;DragonHead.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;DragonHead.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;
DragonHead.create=Enemy.create;DragonHead.assign=Enemy.assign;DragonHead.getActor=Enemy.getActor;DragonHead.prototype.eject=function(){Enemy.prototype.eject.call(this);this.body.forEach(function(a){a.hitPoint=0;a.explosion=Actor.MAX_EXPLOSION})};
DragonHead.prototype.move=function(a){var b=this,c=Math.trim(this.radian+.9*this.closeGap(a));this.radian=this.dir=c;Enemy.prototype.move.call(this,a);this.chamberList.forEach(function(a){a.probe()});for(a=0;a<DragonHead.CNT_OF_BODY;a++){c=this.body[a];var d=this.locus[(a+1)*DragonHead.STP_OF_BODY-1];c.x=d.x;c.y=d.y;c.radian=d.radian}this.locus.unshift({x:this.x,y:this.y,radian:this.radian});this.locus.pop();if(this.appears){var e=[];this.chamberList.forEach(function(a){if(a=a.fire(b))a.dir=b.dir,
a.radian=b.dir,e.push(a)});return e}this.appears=!0;return this.body};DragonHead.CNT_OF_BODY=10;DragonHead.STP_OF_BODY=32;var Hanker_bk=function(a,b){Enemy.call(this,a,b);this.speed=.7;this.hitPoint=2;this.score=50;this.anim=new Animator("enemy.hanker");this.routine=[(new Movement).add(Gizmo.TYPE.AIM,Gizmo.DEST.ROTATE).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO)]};$jscomp.inherits(Hanker_bk,Enemy);Hanker_bk.DirType=Enemy.DirType;Hanker_bk.CollidingWallType=Enemy.CollidingWallType;
Hanker_bk.ActivityAreaType=Enemy.ActivityAreaType;Hanker_bk.TypeList=Enemy.TypeList;Hanker_bk.Type=Enemy.Type;Hanker_bk.DEG_STEP=Enemy.DEG_STEP;Hanker_bk.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Hanker_bk.LIST=Enemy.LIST;Hanker_bk.MAX_TYPE=Enemy.MAX_TYPE;Hanker_bk.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Hanker_bk.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Hanker_bk.create=Enemy.create;Hanker_bk.assign=Enemy.assign;Hanker_bk.getActor=Enemy.getActor;
var Hatch=function(a,b){Enemy.call(this,a,b);this.region=new Region(this,12);this.speed=0;this.hitPoint=10;this.score=200;this.children=this.count=0;this.activityAreaType=Actor.ActivityAreaType.EJECT;this.anim=new Animator("enemy.hatch",Animator.TYPE.Y,1,2);this.checkInverse()};$jscomp.inherits(Hatch,Enemy);Hatch.DirType=Enemy.DirType;Hatch.CollidingWallType=Enemy.CollidingWallType;Hatch.ActivityAreaType=Enemy.ActivityAreaType;Hatch.TypeList=Enemy.TypeList;Hatch.Type=Enemy.Type;Hatch.DEG_STEP=Enemy.DEG_STEP;
Hatch.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Hatch.LIST=Enemy.LIST;Hatch.MAX_TYPE=Enemy.MAX_TYPE;Hatch.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Hatch.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Hatch.create=Enemy.create;Hatch.assign=Enemy.assign;Hatch.getActor=Enemy.getActor;Hatch.prototype.move=function(a){Enemy.prototype.move.call(this,a);if(!(this.count++<Hatch.IDLE||0!=this.count%Hatch.INTERVAL||Hatch.CHILDREN<=this.children++||0<this.explosion))return[new Charger(this.x,this.y)]};Hatch.IDLE=80;
Hatch.INTERVAL=12;Hatch.CHILDREN=20;var Tentacle=function(a,b){Chain.call(this,a,b);this.hasBounds=!1;this.speed=.1;this.hitPoint=16;this.appears=!1;this.anim=new Animator("enemy.tentacle");this.routine=[(new Movement).add(Gizmo.TYPE.CHASE,Gizmo.DEST.TO).add(Gizmo.TYPE.AIM,Gizmo.DEST.ROTATE,Tentacle.DEG_STEP)];this.push(new TentacleHead(0));for(a=0;a<Tentacle.MAX_JOINT;a++)b=Tentacle.MAX_JOINT-a,this.push(new TentacleJoint(b*b));this.score=150};$jscomp.inherits(Tentacle,Chain);Tentacle.DirType=Chain.DirType;
Tentacle.CollidingWallType=Chain.CollidingWallType;Tentacle.ActivityAreaType=Chain.ActivityAreaType;Tentacle.TypeList=Chain.TypeList;Tentacle.Type=Chain.Type;Tentacle.MAX_EXPLOSION=Chain.MAX_EXPLOSION;Tentacle.LIST=Chain.LIST;Tentacle.MAX_TYPE=Chain.MAX_TYPE;Tentacle.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;Tentacle.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;Tentacle.create=Chain.create;Tentacle.assign=Chain.assign;Tentacle.getActor=Chain.getActor;
Tentacle.prototype.eject=function(){for(var a=this.next;a;)a.eject(),a=a.next;this.isGone=!0;this.x=-this.width};Tentacle.prototype.calcRadian=function(){return this.radian};Tentacle.prototype.calcRelative=function(){return this.radian};
Tentacle.prototype.move=function(a){this.radius=this.hitPoint/2+8;this.scale=this.radius/Tentacle.MAX_RADIUS;this.region=new Region(this,this.radius);Chain.prototype.move.call(this,a);if(!this.appears){this.appears=!0;a=[];for(var b=this.next;b;)a.push(b),b=b.next;return a}};Tentacle.MAX_JOINT=8;Tentacle.MAX_RADIUS=16;Tentacle.DEG_STEP=Math.PI/900;var TentacleJoint=function(a){Chain.call(this,0,0);this.hasBounds=!1;this.radius=4;this.radian=0;this.speed=a;this.anim=new Animator("enemy.tentacleJoint")};
$jscomp.inherits(TentacleJoint,Chain);TentacleJoint.DirType=Chain.DirType;TentacleJoint.CollidingWallType=Chain.CollidingWallType;TentacleJoint.ActivityAreaType=Chain.ActivityAreaType;TentacleJoint.TypeList=Chain.TypeList;TentacleJoint.Type=Chain.Type;TentacleJoint.MAX_EXPLOSION=Chain.MAX_EXPLOSION;TentacleJoint.LIST=Chain.LIST;TentacleJoint.MAX_TYPE=Chain.MAX_TYPE;TentacleJoint.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;TentacleJoint.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;TentacleJoint.create=Chain.create;
TentacleJoint.assign=Chain.assign;TentacleJoint.getActor=Chain.getActor;TentacleJoint.prototype.calcRadian=function(){return Math.trim(this.prev.calcRadian()+this.radian)};TentacleJoint.prototype.calcRelative=function(){return Math.trim(this.radian-this.prev.calcRadian())};
TentacleJoint.prototype.rotate=function(a){var b=this.calcRadian();this.radian=Math.close(b,Math.atan2(a.y-this.y,a.x-this.x),TentacleJoint.DEG_STEP*this.speed);this.radian=this.calcRelative();this.radian<-TentacleJoint.MAX_RAD&&(this.radian=-TentacleJoint.MAX_RAD);TentacleJoint.MAX_RAD<this.radian&&(this.radian=TentacleJoint.MAX_RAD)};TentacleJoint.prototype.move=function(a){var b=this.prev,c=b.calcRadian(),d=b.radius+this.radius;this.x=b.x+Math.cos(c)*d;this.y=b.y+Math.sin(c)*d;return this.rotate(a)};
TentacleJoint.prototype.fate=function(){};TentacleJoint.DEG_STEP=Math.PI/18E3;TentacleJoint.MAX_RAD=Math.PI/6;var TentacleBullet=function(a,b){Bullet.call(this,a,b);this.region=new Region(this,1);this.radius=2;this.speed=.5;this.anim=[];this.fillStyle="rgba(255, 200, 200, 0.7)"};$jscomp.inherits(TentacleBullet,Bullet);TentacleBullet.DirType=Bullet.DirType;TentacleBullet.CollidingWallType=Bullet.CollidingWallType;TentacleBullet.ActivityAreaType=Bullet.ActivityAreaType;TentacleBullet.TypeList=Bullet.TypeList;
TentacleBullet.Type=Bullet.Type;TentacleBullet.DEG_STEP=Bullet.DEG_STEP;TentacleBullet.MAX_EXPLOSION=Bullet.MAX_EXPLOSION;TentacleBullet.create=Bullet.create;TentacleBullet.RAD_STEP=Bullet.RAD_STEP;var TentacleHead=function(a){TentacleJoint.call(this,a);this.anim=new Animator("enemy.tentacleHead");this.chamberList=[new Chamber(TentacleBullet,TentacleHead.TRIGGER_CYCLE)]};$jscomp.inherits(TentacleHead,TentacleJoint);TentacleHead.DirType=TentacleJoint.DirType;TentacleHead.CollidingWallType=TentacleJoint.CollidingWallType;
TentacleHead.ActivityAreaType=TentacleJoint.ActivityAreaType;TentacleHead.TypeList=TentacleJoint.TypeList;TentacleHead.Type=TentacleJoint.Type;TentacleHead.MAX_EXPLOSION=TentacleJoint.MAX_EXPLOSION;TentacleHead.LIST=TentacleJoint.LIST;TentacleHead.MAX_TYPE=TentacleJoint.MAX_TYPE;TentacleHead.TRIGGER_ALLOWANCE=TentacleJoint.TRIGGER_ALLOWANCE;TentacleHead.create=TentacleJoint.create;TentacleHead.assign=TentacleJoint.assign;TentacleHead.getActor=TentacleJoint.getActor;TentacleHead.MAX_RAD=TentacleJoint.MAX_RAD;
TentacleHead.prototype.rotate=function(a){this.radian=Math.close(this.radian,Math.atan2(a.y-this.y,a.x-this.x),TentacleHead.DEG_STEP);return this.trigger(a,!0)};TentacleHead.TRIGGER_CYCLE=120;TentacleHead.DEG_STEP=Math.PI/100;var MissileCapsule=function(a){Capsule.call(this,a);this.anim=new Animator("capsule.missileCapsule",Animator.TYPE.Y)};$jscomp.inherits(MissileCapsule,Capsule);MissileCapsule.DirType=Capsule.DirType;MissileCapsule.CollidingWallType=Capsule.CollidingWallType;
MissileCapsule.ActivityAreaType=Capsule.ActivityAreaType;MissileCapsule.TypeList=Capsule.TypeList;MissileCapsule.Type=Capsule.Type;MissileCapsule.DEG_STEP=Capsule.DEG_STEP;MissileCapsule.MAX_EXPLOSION=Capsule.MAX_EXPLOSION;MissileCapsule.create=Capsule.create;MissileCapsule.prototype.fate=function(a){a.powerUpMissile();this.eject()};var SpeedupCapsule=function(a){Capsule.call(this,a);this.anim=new Animator("capsule.speedupCapsule",Animator.TYPE.Y)};$jscomp.inherits(SpeedupCapsule,Capsule);
SpeedupCapsule.DirType=Capsule.DirType;SpeedupCapsule.CollidingWallType=Capsule.CollidingWallType;SpeedupCapsule.ActivityAreaType=Capsule.ActivityAreaType;SpeedupCapsule.TypeList=Capsule.TypeList;SpeedupCapsule.Type=Capsule.Type;SpeedupCapsule.DEG_STEP=Capsule.DEG_STEP;SpeedupCapsule.MAX_EXPLOSION=Capsule.MAX_EXPLOSION;SpeedupCapsule.create=Capsule.create;SpeedupCapsule.prototype.fate=function(a){a.speedup();this.eject()};
var Molten=function(a,b){Enemy.call(this,a,b);this.region=new Region(this,14);this.hasBounds=!1;this.dir=0;this.speed=.4;this.hitPoint=Number.MAX_SAFE_INTEGER;this.cycle=0;this.phase=Molten.PHASE.TARGET;this.rock=[];this.appears=!1;this.effectH=!0;this.anim=new Animator("boss.molten");this.routine=[(new Movement).add(Gizmo.TYPE.CHASE,Gizmo.DEST.ROTATE)]};$jscomp.inherits(Molten,Enemy);Molten.DirType=Enemy.DirType;Molten.CollidingWallType=Enemy.CollidingWallType;Molten.ActivityAreaType=Enemy.ActivityAreaType;
Molten.TypeList=Enemy.TypeList;Molten.Type=Enemy.Type;Molten.DEG_STEP=Enemy.DEG_STEP;Molten.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Molten.LIST=Enemy.LIST;Molten.MAX_TYPE=Enemy.MAX_TYPE;Molten.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Molten.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Molten.create=Enemy.create;Molten.assign=Enemy.assign;Molten.getActor=Enemy.getActor;
Molten.prototype.move=function(a){Enemy.prototype.move.call(this,a);Molten.MAX_CYCLE<this.cycle++&&(this.cycle=0,this.phase++,this.phase%=Molten.PHASE.length);if(this.appears)return this.checkDestroy(a),[];this.appears=!0;a=new MoltenRock(this,this.x,this.y);this.rock=[a];return[a]};Molten.prototype.checkDestroy=function(a){var b=[];this.rock.forEach(function(a){a.isGone||b.push(a)});0==b.length&&(this.hitPoint=0,this.fate(a));this.rock=b};Molten.MAX_CYCLE=700;Molten.PHASE={OWN:0,TARGET:1,length:2};
var MoltenRock=function(a,b,c){Enemy.call(this,b,c);this.hasBounds=!1;this.parent=a;this.dir=0;this.speed=.6;this.hitPoint=5;this.score=10;this.effectH=!0;this.anim=new Animator("boss.moltenRock");this.routine=[(new Movement).add(Gizmo.TYPE.CHASE,Gizmo.DEST.ROTATE)]};$jscomp.inherits(MoltenRock,Enemy);MoltenRock.DirType=Enemy.DirType;MoltenRock.CollidingWallType=Enemy.CollidingWallType;MoltenRock.ActivityAreaType=Enemy.ActivityAreaType;MoltenRock.TypeList=Enemy.TypeList;MoltenRock.Type=Enemy.Type;
MoltenRock.DEG_STEP=Enemy.DEG_STEP;MoltenRock.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;MoltenRock.LIST=Enemy.LIST;MoltenRock.MAX_TYPE=Enemy.MAX_TYPE;MoltenRock.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;MoltenRock.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;MoltenRock.create=Enemy.create;MoltenRock.assign=Enemy.assign;MoltenRock.getActor=Enemy.getActor;
MoltenRock.prototype.move=function(a){var b=this.parent;b.phase==Molten.PHASE.OWN?Enemy.prototype.move.call(this,b):(Enemy.prototype.move.call(this,a),this.spawn=[]);if(this.absorbed&&this.hitPoint){a=Math.trim(this.dir+Math.SQ);for(var c=0;3>c;c++){var d=new MoltenRock(b,this.x,this.y);d.dir=a;d.speed=1.2*this.speed;d.hitPoint=this.hitPoint;this.spawn.push(d);b.rock.push(d);a=Math.trim(a+Math.SQ)}}this.absorbed=!1};
var Motion=function(a,b,c,d){this.type=a;this.key=b;this.speed=c;this.h=d;this.y=this.x=this.v=0;this.triggerMax=this.triggerMin=Number.NaN;this.filling=this.reserve=null;this.batter=0};Motion.prototype.rotateV=function(a){this.v=a;return this};Motion.prototype.offsetX=function(a){this.x=a;return this};Motion.prototype.offsetY=function(a){this.y=a;return this};
Motion.prototype.shot=function(a,b,c){this.reserve={type:a,id:b};isFinite(c)?(this.triggerMin=c,this.triggerMax=c+this.speed):(this.triggerMin=c.min,this.triggerMax=c.max);return this};Motion.prototype.reset=function(){this.mot=VisualManager.Instance.dic[this.key];this.max=this.mot.length-1;this.ix=0;this.dir=1;return this};
Motion.prototype.next=function(){var a=this.ix+this.speed*this.dir;if(this.max<=a){if(this.type!=Motion.TYPE.REWIND)return null;this.ix=this.max;this.dir*=-1;return[this.mot[this.ix]]}if(0>a)return null;for(var b=[];this.ix!=a;)this.ix+=this.dir,b.push(this.mot[this.ix]);this.checkTrigger();return b};Motion.prototype.checkTrigger=function(){this.filling||(0<this.batter?this.batter=0:this.triggerMin<=this.ix&&this.ix<=this.triggerMax&&(this.filling=this.reserve,this.batter=1))};
Motion.prototype.fire=function(){if(this.filling){var a=this.filling;this.filling=null;return a}};Motion.TYPE={NORMAL:0,ONLY_ONE:1,REWIND:2};var MotionRoutine=function(a){this.routine=a;this.ix=0;this.max=this.routine.length-1;this.loop=0;this.current=this.routine[this.ix]};MotionRoutine.prototype.reset=function(){this.loop=this.ix=0;this.current=this.routine[this.ix].reset()};
MotionRoutine.prototype.next=function(a){var b=this.current.ix,c=this.current.next();null==c&&(this.ix++,this.max<this.ix&&(this.ix=0,this.loop++),this.current=this.routine[this.ix].reset(),0<this.loop&&this.current.type==Motion.TYPE.ONLY_ONE&&(this.ix++,this.current=this.routine[this.ix].reset()),c=this.current.next());var d=this.current.ix<b?-1:1;b=this.current.fire();a.rotationH=this.current.h;a.rotationV=this.current.v;a.offsetX=this.current.x;a.offsetY=this.current.y;a.calcRotationMatrix();c.forEach(function(b){a.shift(b,
d);a.calculate()});return b};var Skeleton=function(a){this.data=a;this.map={};this.offsetY=this.offsetX=0;this.rotationH=Math.PI/4;this.rotationV=Math.PI/8;this.rotationMatrix=new Matrix(Matrix.NO_EFFECT);this.init()};Skeleton.prototype.init=function(){var a=Object.assign(new Bone,this.data.root);this.data.root=a;this.prepare(a);this.calcRotationMatrix()};
Skeleton.prototype.prepare=function(a){var b=this,c=[];a.prepare();a.joint.forEach(function(b){b.parent=a;c.push(Object.assign(new Bone,b))});a.joint=c;a.joint.forEach(function(a){b.prepare(a)});a.skeleton=this;this.map[a.name]=a};Skeleton.prototype.calcRotationMatrix=function(){var a=Matrix.rotateY(this.rotationH);this.rotationMatrix=Matrix.rotateX(this.rotationV).multiply(a)};Skeleton.prototype.rotateH=function(a){this.rotationH+=Math.PI/720*a;this.rotationH=Math.trim(this.rotationH);this.calcRotationMatrix()};
Skeleton.prototype.rotateV=function(a){this.rotationV+=Math.PI/720*a;this.rotationV=Math.trim(this.rotationV);this.calcRotationMatrix()};Skeleton.prototype.shift=function(a,b){var c=this;a.forEach(function(a){var d=a.r,f=c.map[a.name],g=Matrix.rotateX(d.x),h=Matrix.rotateY(d.y);d=Matrix.rotateZ(d.z);f.motionMatrix=d.multiply(h).multiply(g);a.p&&(a=a.p,g=f.pt,f.translateMatrix=new Matrix([[1,0,0,c.offsetX+g.x+a.x*b],[0,1,0,c.offsetY+g.y+a.y*b],[0,0,1,g.z+a.z*b],[0,0,0,1]]))})};
Skeleton.prototype.calculate=function(a){this.data.root.calculate(a)};Skeleton.prototype.draw=function(a){this.data.root.draw(a)};var Bone=function(){this.pt={x:0,y:0,z:0}};
Bone.prototype.prepare=function(){var a=this.translate,b=Matrix.rotateX(this.axis.x),c=Matrix.rotateY(this.axis.y);b=Matrix.rotateZ(this.axis.z).multiply(c).multiply(b);this.translateMatrix=new Matrix([[1,0,0,a.x],[0,1,0,a.y],[0,0,1,a.z],[0,0,0,1]]);if(this.parent){var d=this.parent;a=Matrix.rotateX(-d.axis.x);c=Matrix.rotateY(-d.axis.y);d=Matrix.rotateZ(-d.axis.z);this.axisMatrix=a.multiply(c).multiply(d).multiply(b)}else this.axisMatrix=b;this.motionMatrix=new Matrix(Matrix.NO_EFFECT)};
Bone.prototype.getAccum=function(){if(this.parent){var a=this.axisMatrix.multiply(this.motionMatrix).multiply(this.translateMatrix);return this.parent.getAccum().multiply(a)}return this.translateMatrix.multiply(this.motionMatrix)};Bone.prototype.calculate=function(a){this.pt=this.getAccum().affine(0,0,0);a||this.joint.forEach(function(a){a.calculate(!1)})};
Bone.prototype.drawLine=function(a){var b=this.parent.pt,c=this.pt,d=this.skeleton.rotationMatrix;b=d.affine(b.x,b.y,b.z);c=d.affine(c.x,c.y,c.z);d=c.x;var e=-c.y,f=b.x;b=-b.y;var g=d-f,h=e-b;this.cx=f+g/2;this.cy=b+h/2;this.cz=c.z;this.radian=Math.atan2(h,g);a.beginPath();a.moveTo(f,b);a.lineTo(d,e);a.stroke()};Bone.prototype.draw=function(a){this.calculate();this.parent&&this.drawLine(a);this.joint.forEach(function(b){b.draw(a)})};
var Titan=function(a,b){Enemy.call(this,a,b);this.scale=7;this.hitPoint=Number.MAX_SAFE_INTEGER;this.motionRoutine=Titan.ROUTINE;this.motionRoutine.reset();a=Object.assign({},VisualManager.Instance.dic["asf.json"]);this.skeleton=new Skeleton(a);this.setupBone()};$jscomp.inherits(Titan,Enemy);Titan.DirType=Enemy.DirType;Titan.CollidingWallType=Enemy.CollidingWallType;Titan.ActivityAreaType=Enemy.ActivityAreaType;Titan.TypeList=Enemy.TypeList;Titan.Type=Enemy.Type;Titan.DEG_STEP=Enemy.DEG_STEP;
Titan.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;Titan.LIST=Enemy.LIST;Titan.MAX_TYPE=Enemy.MAX_TYPE;Titan.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;Titan.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;Titan.create=Enemy.create;Titan.assign=Enemy.assign;Titan.getActor=Enemy.getActor;Titan.prototype.setupBone=function(){var a=this,b={};Object.keys(this.skeleton.map).forEach(function(c){if("root"!=c){var d=new TitanBone(c,a.x,a.y);c==Titan.CORE&&(d.hitPoint=Titan.HIT_POINT);b[c]=d}});this.boneMap=b;this.appears=!1};
Titan.prototype.eject=function(){var a=this;Enemy.prototype.eject.call(this);Object.keys(this.boneMap).forEach(function(b){b=a.boneMap[b];b.hitPoint=0;b.explosion=2*Actor.MAX_EXPLOSION})};
Titan.prototype.move=function(a){var b=this,c=[],d=this.motionRoutine.next(this.skeleton);Enemy.prototype.move.call(this,a);if(!this.appears)return Object.keys(this.boneMap).forEach(function(a){c.push(b.boneMap[a])}),this.appears=!0,c.reverse();var e=this.skeleton.map,f=!1;d&&d.id.forEach(function(a){a=b.boneMap[a];var e=new d.type(a.x,a.y);e.dir=a.radian;c.push(e)});Object.keys(this.boneMap).forEach(function(a){var c=e[a],d=c.cy*b.scale+b.y;a=b.boneMap[a];a.x=c.cx*b.scale+b.x;a.y=d;a.z=c.cz;a.radian=
c.radian;0==a.hitPoint&&(f=!0)});f&&this.eject();return c};Titan.prototype.drawInfo=function(a){var b=this.motionRoutine.current,c=this.boneMap[Titan.CORE];a.save();a.translate(this.x,this.y);a.strokeStyle="rgba(255, 255, 255, 0.8)";a.strokeText("ix:"+b.ix,0,0);a.strokeText("hp:"+c.hitPoint,0,10);a.restore()};Titan.prototype.drawNormal=function(a){a.save();a.translate(this.x,this.y);this.skeleton&&(a.scale(this.scale,this.scale),a.strokeStyle="rgba(203, 152, 135, 0.2)",this.skeleton.draw(a));a.restore()};
Titan.prototype.isHit=function(a){return!1};Titan.HIT_POINT=292;Titan.CORE="lowerback";var TitanBone=function(a,b,c){Enemy.call(this,b,c);this.id=a;this.hasBounds=!1;this.hitPoint=Number.MAX_SAFE_INTEGER;this.filling=null;this.anim=new Animator("boss.titan."+a)};$jscomp.inherits(TitanBone,Enemy);TitanBone.DirType=Enemy.DirType;TitanBone.CollidingWallType=Enemy.CollidingWallType;TitanBone.ActivityAreaType=Enemy.ActivityAreaType;TitanBone.TypeList=Enemy.TypeList;TitanBone.Type=Enemy.Type;
TitanBone.DEG_STEP=Enemy.DEG_STEP;TitanBone.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;TitanBone.LIST=Enemy.LIST;TitanBone.MAX_TYPE=Enemy.MAX_TYPE;TitanBone.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;TitanBone.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;TitanBone.create=Enemy.create;TitanBone.assign=Enemy.assign;TitanBone.getActor=Enemy.getActor;TitanBone.prototype.drawNormal=function(a){Enemy.prototype.drawNormal.call(this,a)};
$jscomp.global.Object.defineProperties(TitanBone.prototype,{triggered:{configurable:!0,enumerable:!0,get:function(){return!1}}});var TitanBall=function(a,b){Enemy.call(this,a,b);this.hasBounds=!1;this.speed=1.5+4*Math.random();this.gravity=.03;this.hitPoint=4;this.anim=new Animator("boss.titan.titan.ball")};$jscomp.inherits(TitanBall,Enemy);TitanBall.DirType=Enemy.DirType;TitanBall.CollidingWallType=Enemy.CollidingWallType;TitanBall.ActivityAreaType=Enemy.ActivityAreaType;TitanBall.TypeList=Enemy.TypeList;
TitanBall.Type=Enemy.Type;TitanBall.DEG_STEP=Enemy.DEG_STEP;TitanBall.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;TitanBall.LIST=Enemy.LIST;TitanBall.MAX_TYPE=Enemy.MAX_TYPE;TitanBall.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;TitanBall.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;TitanBall.create=Enemy.create;TitanBall.assign=Enemy.assign;TitanBall.getActor=Enemy.getActor;TitanBall.prototype.reactY=function(a){Enemy.prototype.reactY.call(this,a);this.fate(this)};
$jscomp.global.Object.defineProperties(TitanBall.prototype,{triggered:{configurable:!0,enumerable:!0,get:function(){return!1}}});var TitanBullet=function(a,b){Enemy.call(this,a,b);this.radian=this.dir=-Math.PI+Math.SQ/2;this.speed=4;this.hitPoint=Number.MAX_SAFE_INTEGER;this.anim=new Animator("boss.titan.titan.bullet")};$jscomp.inherits(TitanBullet,Enemy);TitanBullet.DirType=Enemy.DirType;TitanBullet.CollidingWallType=Enemy.CollidingWallType;TitanBullet.ActivityAreaType=Enemy.ActivityAreaType;
TitanBullet.TypeList=Enemy.TypeList;TitanBullet.Type=Enemy.Type;TitanBullet.DEG_STEP=Enemy.DEG_STEP;TitanBullet.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;TitanBullet.LIST=Enemy.LIST;TitanBullet.MAX_TYPE=Enemy.MAX_TYPE;TitanBullet.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;TitanBullet.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;TitanBullet.create=Enemy.create;TitanBullet.assign=Enemy.assign;TitanBullet.getActor=Enemy.getActor;
$jscomp.global.Object.defineProperties(TitanBullet.prototype,{triggered:{configurable:!0,enumerable:!0,get:function(){return!1}}});var TitanShot=function(a,b){Enemy.call(this,a,b);this.radian=this.dir=Math.PI;this.speed=7;this.hitPoint=Number.MAX_SAFE_INTEGER;this.anim=new Animator("boss.titan.titan.shot")};$jscomp.inherits(TitanShot,Enemy);TitanShot.DirType=Enemy.DirType;TitanShot.CollidingWallType=Enemy.CollidingWallType;TitanShot.ActivityAreaType=Enemy.ActivityAreaType;TitanShot.TypeList=Enemy.TypeList;
TitanShot.Type=Enemy.Type;TitanShot.DEG_STEP=Enemy.DEG_STEP;TitanShot.MAX_EXPLOSION=Enemy.MAX_EXPLOSION;TitanShot.LIST=Enemy.LIST;TitanShot.MAX_TYPE=Enemy.MAX_TYPE;TitanShot.TRIGGER_ALLOWANCE=Enemy.TRIGGER_ALLOWANCE;TitanShot.TRIGGER_CYCLE=Enemy.TRIGGER_CYCLE;TitanShot.create=Enemy.create;TitanShot.assign=Enemy.assign;TitanShot.getActor=Enemy.getActor;
Titan.ROUTINE=new MotionRoutine([(new Motion(Motion.TYPE.ONLY_ONE,"111_7.amc.json",2,Math.PI/4)).offsetX(0).offsetY(0),(new Motion(Motion.TYPE.NORMAL,"79_96.amc.json",1,.4*-Math.PI)).shot(TitanShot,["lradius","lwrist","lhand","lthumb","lfingers"],200),(new Motion(Motion.TYPE.REWIND,"133_01.amc.json",2,Math.PI)).shot(TitanBullet,["thorax","upperneck"],{min:200,max:550}),(new Motion(Motion.TYPE.NORMAL,"79_91.amc.json",1,.4*-Math.PI)).shot(TitanBall,["rhumerus","rradius","rwrist","rhand"],{min:175,max:200}),
(new Motion(Motion.TYPE.NORMAL,"86_01b.amc.json",2,Math.PI)).shot(Bullet,["lfingers","rfingers"],{min:0,max:1E3})]);
var Winding=function(a,b){Chain.call(this,a,b);this.region=new Region(this,12);this.dir=-Math.PI;this.step=Math.SQ/100;this.radius=Winding.RADIUS;this.speed=.5;this.hitPoint=100;this.hasBounds=!1;this.ratio=Winding.RATIO_MAX;this.delta=-1;this.uncoil=!1;this.anim=new Animator("boss.winding");this.routine=[(new Movement(200)).add(Gizmo.TYPE.CHASE,Gizmo.DEST.ROTATE,Math.PI/180),(new Movement(20)).add(Gizmo.TYPE.OWN,Gizmo.DEST.ROTATE_R)];this.chamberList=[new Chamber(Slur,Winding.TRIGGER_CYCLE)];this.init()};
$jscomp.inherits(Winding,Chain);Winding.DirType=Chain.DirType;Winding.CollidingWallType=Chain.CollidingWallType;Winding.ActivityAreaType=Chain.ActivityAreaType;Winding.TypeList=Chain.TypeList;Winding.Type=Chain.Type;Winding.DEG_STEP=Chain.DEG_STEP;Winding.MAX_EXPLOSION=Chain.MAX_EXPLOSION;Winding.LIST=Chain.LIST;Winding.MAX_TYPE=Chain.MAX_TYPE;Winding.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;Winding.create=Chain.create;Winding.assign=Chain.assign;Winding.getActor=Chain.getActor;
Winding.prototype.init=function(){this.appears=!1;for(var a=0;a<Winding.MAX_JOINT;a++)this.push(new WindingChild(this.x,this.y))};
Winding.prototype.move=function(a){var b=Chain.prototype.move.call(this,a),c=Math.trim(this.dir-Math.SQ/2);this.rad=Math.trim(this.dir+Math.SQ);if(this.appears){for(var d=this.next;d;)c+=Winding.RADIAN_STEP*this.ratio/100,d.radian=Math.trim(c),d=d.next;this.uncoil&&(this.ratio+=this.delta,1>=this.ratio?this.delta*=-1:Winding.RATIO_MAX<=this.ratio&&(this.uncoil=!1,this.delta*=-1,b=this.trigger(a,!0),b.forEach(function(b){b.aim(a);b.dir=Math.trim(b.dir+Math.PI)})));return b}this.appears=!0;for(c=this.next;c;)b.push(c),
c=c.next;return b};Winding.prototype.fate=function(a){Chain.prototype.fate.call(this,a);this.uncoil=!0};Winding.RADIUS=16;Winding.RADIAN_STEP=Math.SQ;Winding.RATIO_MAX=50;Winding.MAX_JOINT=20;Winding.TRIGGER_CYCLE=20;var WindingChild=function(a,b){Chain.call(this,a,b);this.hasBounds=!1;this.radius=WindingChild.RADIUS;this.anim=new Animator("boss.winding.joint")};$jscomp.inherits(WindingChild,Chain);WindingChild.DirType=Chain.DirType;WindingChild.CollidingWallType=Chain.CollidingWallType;
WindingChild.ActivityAreaType=Chain.ActivityAreaType;WindingChild.TypeList=Chain.TypeList;WindingChild.Type=Chain.Type;WindingChild.DEG_STEP=Chain.DEG_STEP;WindingChild.MAX_EXPLOSION=Chain.MAX_EXPLOSION;WindingChild.LIST=Chain.LIST;WindingChild.MAX_TYPE=Chain.MAX_TYPE;WindingChild.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;WindingChild.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;WindingChild.create=Chain.create;WindingChild.assign=Chain.assign;WindingChild.getActor=Chain.getActor;
WindingChild.prototype.move=function(a){a=this.prev;var b=this.radius+a.radius;this.x=a.x+Math.cos(this.radian)*b;this.y=a.y+Math.sin(this.radian)*b};WindingChild.prototype.fate=function(){};WindingChild.RADIUS=4;var Cascade=function(a,b){Chain.call(this,a,b);this.anim=new Animator("material.cascade");this.radian=Math.SQ;this.radius=Cascade.RADIUS;this.appears=!1;for(var c=0;c<Cascade.MAX_JOINT;c++)this.push(new CascadeChild(a,b,3*(Cascade.MAX_JOINT-c)))};$jscomp.inherits(Cascade,Chain);
Cascade.DirType=Chain.DirType;Cascade.CollidingWallType=Chain.CollidingWallType;Cascade.ActivityAreaType=Chain.ActivityAreaType;Cascade.TypeList=Chain.TypeList;Cascade.Type=Chain.Type;Cascade.DEG_STEP=Chain.DEG_STEP;Cascade.MAX_EXPLOSION=Chain.MAX_EXPLOSION;Cascade.LIST=Chain.LIST;Cascade.MAX_TYPE=Chain.MAX_TYPE;Cascade.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;Cascade.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;Cascade.create=Chain.create;Cascade.assign=Chain.assign;Cascade.getActor=Chain.getActor;
Cascade.prototype.move=function(a){Chain.prototype.move.call(this,a);if(!this.appears){this.appears=!0;a=[];for(var b=this.next;b;)a.push(b),b=b.next;return a}};Cascade.prototype.fate=function(){};Cascade.RADIUS=4;Cascade.MAX_JOINT=12;var CascadeChild=function(a,b,c){Chain.call(this,a,b);this.weight=c;this.radian=.9*Math.SQ;this.radius=Cascade.RADIUS;this.step=0};$jscomp.inherits(CascadeChild,Chain);CascadeChild.DirType=Chain.DirType;CascadeChild.CollidingWallType=Chain.CollidingWallType;
CascadeChild.ActivityAreaType=Chain.ActivityAreaType;CascadeChild.TypeList=Chain.TypeList;CascadeChild.Type=Chain.Type;CascadeChild.DEG_STEP=Chain.DEG_STEP;CascadeChild.MAX_EXPLOSION=Chain.MAX_EXPLOSION;CascadeChild.LIST=Chain.LIST;CascadeChild.MAX_TYPE=Chain.MAX_TYPE;CascadeChild.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;CascadeChild.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;CascadeChild.create=Chain.create;CascadeChild.assign=Chain.assign;CascadeChild.getActor=Chain.getActor;
CascadeChild.prototype.addRadian=function(a){return this.radian=Math.trim(this.radian+a)};CascadeChild.prototype.move=function(a){a=this.prev;var b=Math.trim(Math.SQ-this.radian)/(300+10*this.weight);this.step+=b;0==parseInt(1E3*b)&&(this.step*=.98);b=Math.trim(this.radian+this.step);var c=this.radius+a.radius;0>b&&(b=0);this.radian=b;this.x=a.x+Math.cos(b)*c;this.y=a.y+Math.sin(b)*c};
CascadeChild.prototype.draw=function(a){a.save();a.fillStyle="rgba(60, 200, 0, 0.8)";a.translate(this.x,this.y);a.beginPath();a.arc(0,0,this.radius,0,Math.PI2,!1);a.fill();a.restore()};CascadeChild.prototype.fate=function(a){a=Math.PI/200;this.step-=a;for(var b=this.next;b;)b.step-=.8*a,b=b.next};
var Rewinder=function(a,b){Chain.call(this,a,b);this.step=Math.SQ/100;this.radius=Rewinder.RADIUS;this.speed=1.1;this.hitPoint=Number.MAX_SAFE_INTEGER;this.hasBounds=!1;this.ratio=Rewinder.RATIO_MAX;this.delta=-.55;this.anim=new Animator("material.cascade");this.routine=[(new Movement).add(Gizmo.TYPE.AIM,Gizmo.DEST.ROTATE).add(Gizmo.TYPE.FIXED,Gizmo.DEST.TO)];this.appears=!1;for(var c=0;c<Rewinder.MAX_JOINT;c++)this.push(new RewinderChild(a,b))};$jscomp.inherits(Rewinder,Chain);Rewinder.DirType=Chain.DirType;
Rewinder.CollidingWallType=Chain.CollidingWallType;Rewinder.ActivityAreaType=Chain.ActivityAreaType;Rewinder.TypeList=Chain.TypeList;Rewinder.Type=Chain.Type;Rewinder.DEG_STEP=Chain.DEG_STEP;Rewinder.MAX_EXPLOSION=Chain.MAX_EXPLOSION;Rewinder.LIST=Chain.LIST;Rewinder.MAX_TYPE=Chain.MAX_TYPE;Rewinder.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;Rewinder.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;Rewinder.create=Chain.create;Rewinder.assign=Chain.assign;Rewinder.getActor=Chain.getActor;
Rewinder.prototype.move=function(a){var b=[],c=Math.trim(this.radian+Math.SQ/2);Chain.prototype.move.call(this,a);if(this.appears){for(a=this.next;a;)c-=Rewinder.RADIAN_STEP*this.ratio/100,a.radian=Math.trim(c),a=a.next;this.ratio+=this.delta;1>=this.ratio?this.delta*=-1:Rewinder.RATIO_MAX<=this.ratio&&(this.delta*=-1);return b}this.appears=!0;for(c=this.next;c;)b.push(c),c=c.next;return b};Rewinder.prototype.fate=function(){};Rewinder.RADIUS=4;Rewinder.RADIAN_STEP=Math.SQ;Rewinder.RATIO_MAX=100;
Rewinder.MAX_JOINT=16;var RewinderChild=function(a,b){Chain.call(this,a,b);this.radian=0;this.hasBounds=!1;this.radius=RewinderChild.RADIUS;this.anim=new Animator("boss.winding.joint")};$jscomp.inherits(RewinderChild,Chain);RewinderChild.DirType=Chain.DirType;RewinderChild.CollidingWallType=Chain.CollidingWallType;RewinderChild.ActivityAreaType=Chain.ActivityAreaType;RewinderChild.TypeList=Chain.TypeList;RewinderChild.Type=Chain.Type;RewinderChild.DEG_STEP=Chain.DEG_STEP;
RewinderChild.MAX_EXPLOSION=Chain.MAX_EXPLOSION;RewinderChild.LIST=Chain.LIST;RewinderChild.MAX_TYPE=Chain.MAX_TYPE;RewinderChild.TRIGGER_ALLOWANCE=Chain.TRIGGER_ALLOWANCE;RewinderChild.TRIGGER_CYCLE=Chain.TRIGGER_CYCLE;RewinderChild.create=Chain.create;RewinderChild.assign=Chain.assign;RewinderChild.getActor=Chain.getActor;RewinderChild.prototype.move=function(a){a=this.prev;var b=this.radius+a.radius;this.x=a.x+Math.cos(this.radian)*b;this.y=a.y+Math.sin(this.radian)*b};
RewinderChild.prototype.fate=function(){};RewinderChild.RADIUS=4;
